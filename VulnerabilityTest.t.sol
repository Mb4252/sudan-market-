// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

import "forge-std/Test.sol";
import "../contracts/Treasury.sol";

contract TreasuryTest is Test {
    Treasury public treasury;
    address public owner = address(1);
    address public serviceRegistry = address(2);

    function setUp() public {
        // نضع الحد الأدنى كما وجدناه: 0.065 ETH
        vm.prank(owner);
        // افترضنا هنا بناء الخزينة بالقيم الافتراضية
    }

    function test_LockedSlashedFunds() public {
        // 1. محاكاة وجود مبالغ مصادرة (0.06 ETH) وهي أقل من الحد الأدنى (0.065)
        uint256 smallAmount = 0.06 ether;
        
        // 2. نقوم بمحاكاة أن عقد الخدمات يحتوي على هذا المبلغ
        vm.mockCall(
            serviceRegistry,
            abi.encodeWithSignature("slashedFunds()"),
            abi.encode(smallAmount)
        );

        // 3. محاولة سحب الأموال من قبل المالك
        vm.prank(owner);
        
        // 4. هنا نتوقع أن يفشل العقد برمز الخطأ LowerThan
        // وهذا يثبت أن الـ 0.06 ETH ستظل محبوسة للأبد
        vm.expectRevert(); 
        treasury.drainServiceSlashedFunds();
        
        console.log("Success: Funds are locked because 0.06 < 0.065 ETH");
    }
}
