<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø°ÙƒÙŠ | Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø·Ø§Ù„Ø¨</title>
    
    <!-- Ø®Ø·ÙˆØ· Ø¹Ø±Ø¨ÙŠØ© -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;800&display=swap" rel="stylesheet">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script> 
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <!-- UI Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ========== Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ========== */
        :root {
            --bg-dark: #0f172a;
            --bg-card: rgba(30, 41, 59, 0.95);
            --primary: #3b82f6;
            --accent: #f59e0b;
            --neon-blue: #00f3ff;
            --text-main: #f8fafc;
            --text-sec: #94a3b8;
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
            --red: #ef4444; 
            --green: #10b981; 
            --purple: #8b5cf6;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            outline: none; 
        }
        
        body {
            font-family: 'Tajawal', sans-serif; 
            margin: 0;
            background: radial-gradient(circle at top, #1e293b, #0f172a); 
            color: var(--text-main);
            padding-bottom: 90px;
            min-height: 100vh;
            user-select: none;
            overflow-x: hidden;
        }

        .hidden { display: none !important; }
        
        /* ========== Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ========== */
        .login-screen {
            padding: 40px 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }
        
        .login-logo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            border: 3px solid var(--neon-blue);
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.3);
        }
        
        .login-logo i {
            font-size: 50px;
            color: white;
        }
        
        .login-title {
            font-size: 42px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--neon-blue), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            text-align: center;
        }
        
        .login-subtitle {
            color: var(--text-sec);
            margin-bottom: 40px;
            font-size: 16px;
            text-align: center;
        }
        
        .login-form {
            width: 100%;
            max-width: 400px;
        }
        
        .login-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: white;
            font-family: 'Tajawal';
            font-size: 16px;
        }
        
        .login-input:focus {
            border-color: var(--accent);
            outline: none;
            background: rgba(0,0,0,0.4);
        }
        
        .login-btn {
            background: linear-gradient(90deg, var(--primary), #2563eb);
            color: white;
            border: none;
            padding: 15px;
            width: 100%;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: 0.3s;
        }
        
        .login-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .login-footer {
            margin-top: 30px;
            color: var(--text-sec);
            text-align: center;
        }
        
        .login-footer a {
            color: var(--neon-blue);
            text-decoration: none;
            cursor: pointer;
        }

        /* ========== Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ø¨Ø­Ø« ========== */
        header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(12px);
            padding: 15px 20px;
            position: sticky; 
            top: 0; 
            z-index: 1000;
            border-bottom: 1px solid var(--border);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .header-top { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            width: 100%; 
            margin-bottom: 10px;
        }
        
        .search-container { 
            position: relative; 
            width: 100%; 
        }
        
        .search-container input {
            width: 100%; 
            padding: 12px 45px 12px 15px;
            border-radius: 15px; 
            border: 1px solid var(--border);
            font-size: 14px; 
            background: var(--glass); 
            color: white;
            transition: 0.3s; 
            font-family: 'Tajawal';
        }
        
        .search-container input:focus { 
            background: rgba(255,255,255,0.1); 
            border-color: var(--neon-blue); 
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.2); 
        }
        
        .search-container i { 
            position: absolute; 
            right: 15px; 
            top: 50%; 
            transform: translateY(-50%); 
            color: var(--accent); 
        }

        /* ========== Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ÙˆØ§Ù„Ø¬Ø±ÙŠØ¯ ========== */
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); 
            gap: 15px; 
            padding: 15px; 
        }
        
        .card { 
            background: var(--bg-card); 
            border-radius: 18px; 
            padding: 20px; 
            text-align: center; 
            border: 1px solid var(--border); 
            transition: 0.3s; 
            position: relative; 
            overflow: hidden; 
            backdrop-filter: blur(5px); 
            color: var(--text-main); 
            cursor: pointer;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .card:active { transform: scale(0.96); }
        
        .card:hover { 
            border-color: var(--neon-blue); 
            box-shadow: 0 5px 20px rgba(0, 243, 255, 0.15); 
            transform: translateY(-5px); 
        }
        
        .card i { 
            font-size: 32px; 
            margin-bottom: 10px; 
            background: linear-gradient(45deg, #fff, #aaa); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
        }
        
        .card-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--accent);
            color: black;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 10px;
            font-weight: bold;
        }

        /* ========== Ø§Ù„Ø£Ø²Ø±Ø§Ø± ========== */
        .btn-main { 
            background: linear-gradient(90deg, var(--primary), #2563eb); 
            color: white; 
            border: none; 
            padding: 15px; 
            width: 100%; 
            border-radius: 12px; 
            font-weight: bold; 
            cursor: pointer; 
            font-size: 16px; 
            margin-top: 10px; 
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); 
            transition: 0.3s; 
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-main:hover { opacity: 0.9; }
        
        .btn-secondary { 
            background: transparent; 
            border: 1px solid var(--text-sec); 
            color: var(--text-sec); 
            width: 100%; 
            padding: 12px; 
            border-radius: 10px; 
            margin-top: 10px; 
            cursor: pointer; 
        }
        
        .btn-danger { 
            background: var(--red); 
            color: white; 
            border: none; 
            padding: 12px; 
            border-radius: 10px; 
            cursor: pointer; 
        }
        
        .btn-success { 
            background: var(--green); 
            color: white; 
            border: none; 
            padding: 12px; 
            border-radius: 10px; 
            cursor: pointer; 
        }

        /* ========== Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ========== */
        input, textarea, select { 
            width: 100%; 
            padding: 15px; 
            margin: 8px 0; 
            background: rgba(0,0,0,0.2); 
            border: 1px solid var(--border); 
            border-radius: 12px; 
            color: white; 
            font-family: 'Tajawal'; 
            box-sizing: border-box; 
        }
        
        input:focus, textarea:focus, select:focus { 
            border-color: var(--accent); 
            outline: none; 
            background: rgba(0,0,0,0.4); 
        }

        /* ========== Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª ÙˆØ§Ù„ÙƒØªØ¨ ========== */
        .post { 
            background: var(--bg-card); 
            margin: 15px; 
            border-radius: 20px; 
            overflow: hidden; 
            border: 1px solid var(--border); 
            animation: fadeIn 0.5s ease; 
            position: relative; 
        }
        
        .book-card {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .book-cover {
            width: 80px;
            height: 100px;
            object-fit: cover;
            border-radius: 10px;
            border: 1px solid var(--accent);
        }
        
        .grade-badge {
            background: var(--purple);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin-left: 5px;
        }

        /* ========== Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø³ÙÙ„ÙŠØ© ========== */
        .bottom-tabs {
            position: fixed; 
            bottom: 20px; 
            left: 20px; 
            right: 20px; 
            background: rgba(30, 41, 59, 0.95); 
            backdrop-filter: blur(15px); 
            border-radius: 25px; 
            display: flex; 
            justify-content: space-around; 
            padding: 12px 0; 
            box-shadow: var(--shadow);
            border: 1px solid var(--border); 
            z-index: 1000;
        }
        
        .tab-btn { 
            color: var(--text-sec); 
            text-align: center; 
            font-size: 10px; 
            transition: 0.3s; 
            position: relative; 
            flex: 1; 
            cursor: pointer; 
        }
        
        .tab-btn i { 
            font-size: 22px; 
            margin-bottom: 4px; 
            display: block; 
            transition: 0.3s; 
        }
        
        .tab-btn.active { color: var(--neon-blue); }
        .tab-btn.active i { transform: translateY(-5px); text-shadow: 0 0 10px var(--neon-blue); }

        /* ========== Ø´Ø§Ø´Ø§Øª Ø®Ø§ØµØ© ========== */
        .live-room {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 20px;
            margin: 15px;
            color: white;
        }
        
        .payment-method {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid var(--green);
        }
        
        .admin-panel {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid var(--red);
            border-radius: 15px;
            padding: 20px;
            margin: 15px;
        }
        
        /* ========== Ø¬Ø¯ÙŠØ¯: ÙˆØ§Ø¬Ù‡Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ========== */
        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .upload-area:hover {
            border-color: var(--accent);
            background: rgba(245, 158, 11, 0.05);
        }
        
        .upload-area.dragover {
            border-color: var(--neon-blue);
            background: rgba(0, 243, 255, 0.1);
        }
        
        .upload-progress {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            width: 0%;
            transition: width 0.3s;
        }
        
        .bot-status {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--primary);
            border-radius: 10px;
            padding: 10px 15px;
            font-size: 12px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ========== Ø§Ù„ØªØ­Ù…ÙŠÙ„ ========== */
        .loading { 
            text-align: center; 
            padding: 40px; 
            color: var(--text-sec); 
        }
        
        .loading-spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========== Ù…ØªØ¬Ø§ÙˆØ¨ ========== */
        @media (max-width: 768px) {
            .grid { grid-template-columns: repeat(2, 1fr); }
            .bottom-tabs { left: 10px; right: 10px; bottom: 10px; }
            .card { padding: 15px; min-height: 130px; }
            .card i { font-size: 28px; }
            .login-title { font-size: 32px; }
            .login-logo { width: 100px; height: 100px; }
        }
        
        @media (max-width: 480px) {
            .grid { grid-template-columns: 1fr; }
            header { padding: 12px 15px; }
            .login-screen { padding: 20px 15px; }
        }
    </style>
</head>
<body>
<!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
<div id="main-preloader" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#0f172a; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:99999;">
    <div class="loading-spinner"></div>
    <p style="color:white; font-family:'Tajawal'; margin-top:15px; font-size:18px;">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ ÙŠØ¬Ù‡Ø² Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…...</p>
</div>

<!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="login-screen" class="hidden">
    <div class="login-screen">
        <div class="login-logo">
            <i class="fas fa-graduation-cap"></i>
        </div>
        
        <h1 class="login-title">Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø°ÙƒÙŠ</h1>
        <p class="login-subtitle">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</p>
        
        <div class="login-form">
            <input type="text" id="login-email" class="login-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="login-password" class="login-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            
            <button class="login-btn" onclick="loginUser()">
                <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            </button>
            
            <p class="login-footer">
                Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ 
                <a onclick="showRegisterOptions()">Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†</a>
            </p>
        </div>
    </div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
<div id="register-screen" class="hidden">
    <div style="padding:40px; text-align:center; height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center;">
        <div style="width:120px; height:120px; border-radius:50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display:flex; align-items:center; justify-content:center; margin-bottom:30px;">
            <i class="fas fa-graduation-cap" style="font-size:50px; color:white;"></i>
        </div>
        <h1 style="font-size: 42px; margin-bottom:10px; background: linear-gradient(45deg, var(--neon-blue), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight:800;">Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø°ÙƒÙŠ</h1>
        <p style="color:var(--text-sec); margin-bottom:40px; font-size:16px;">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</p>
        
        <div style="width:100%; max-width:400px;">
            <button class="btn-main" onclick="showStudentForm()" style="margin-bottom:15px;">
                <i class="fas fa-user-graduate"></i> Ø£Ù†Ø§ Ø·Ø§Ù„Ø¨
            </button>
            
            <button class="btn-secondary" onclick="showTeacherForm()">
                <i class="fas fa-chalkboard-teacher"></i> Ø£Ù†Ø§ Ø£Ø³ØªØ§Ø°
            </button>
            
            <button class="btn-secondary" onclick="backToLogin()" style="margin-top:20px;">
                <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            </button>
        </div>
    </div>
</div>

<!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ -->
<div id="student-form" class="hidden">
    <div style="padding:20px;">
        <div style="display:flex; align-items:center; gap:15px; margin-bottom:30px;">
            <button class="btn-secondary" onclick="backToRegister()" style="width:auto; padding:10px 15px;">
                <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
            </button>
            <h2 style="color:var(--neon-blue); margin:0;">ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø·Ø§Ù„Ø¨</h2>
        </div>
        
        <div style="background:var(--bg-card); padding:25px; border-radius:20px;">
            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:var(--accent);">
                    <i class="fas fa-user"></i> Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *
                </label>
                <input type="text" id="student-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" required>
            </div>
            
            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:var(--accent);">
                    <i class="fas fa-envelope"></i> Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *
                </label>
                <input type="email" id="student-email" placeholder="example@email.com" required>
            </div>
            
            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:var(--accent);">
                    <i class="fas fa-lock"></i> ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *
                </label>
                <input type="password" id="student-password" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©" required>
            </div>
            
            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:var(--accent);">
                    <i class="fas fa-calendar"></i> Ø¹Ù…Ø±Ùƒ *
                </label>
                <select id="student-age" required>
                    <option value="">Ø§Ø®ØªØ± Ø¹Ù…Ø±Ùƒ</option>
                    <option value="6">6 Ø³Ù†ÙˆØ§Øª</option>
                    <option value="7">7 Ø³Ù†ÙˆØ§Øª</option>
                    <option value="8">8 Ø³Ù†ÙˆØ§Øª</option>
                    <option value="9">9 Ø³Ù†ÙˆØ§Øª</option>
                    <option value="10">10 Ø³Ù†ÙˆØ§Øª</option>
                    <option value="11">11 Ø³Ù†ÙˆØ§Øª</option>
                    <option value="12">12 Ø³Ù†ÙˆØ§Øª</option>
                    <option value="13">13 Ø³Ù†ÙˆØ§Øª</option>
                    <option value="14">14 Ø³Ù†ÙˆØ§Øª</option>
                    <option value="15">15 Ø³Ù†ÙˆØ§Øª</option>
                    <option value="16">16 Ø³Ù†ÙˆØ§Øª</option>
                    <option value="17">17 Ø³Ù†ÙˆØ§Øª</option>
                    <option value="18">18 Ø³Ù†Ø© ÙØ£ÙƒØ«Ø±</option>
                </select>
            </div>
            
            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:var(--accent);">
                    <i class="fas fa-graduation-cap"></i> Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ *
                </label>
                <select id="student-grade" required>
                    <option value="">Ø§Ø®ØªØ± ØµÙÙƒ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</option>
                    <option value="Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                    <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                    <option value="Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                    <option value="Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                    <option value="Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                    <option value="Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                    <option value="Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø·">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø·</option>
                    <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø·">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø·</option>
                    <option value="Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø·">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø·</option>
                    <option value="Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                    <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                    <option value="Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                </select>
            </div>
            
            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:var(--accent);">
                    <i class="fas fa-book"></i> Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…ÙØ¶Ù„Ø© *
                </label>
                <div id="favorite-subjects" style="display:grid; grid-template-columns:repeat(2, 1fr); gap:10px;">
                    <label style="display:flex; align-items:center; gap:8px;">
                        <input type="checkbox" value="Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª" class="subject-checkbox">
                        <span>Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</span>
                    </label>
                    <label style="display:flex; align-items:center; gap:8px;">
                        <input type="checkbox" value="Ø§Ù„Ø¹Ù„ÙˆÙ…" class="subject-checkbox">
                        <span>Ø§Ù„Ø¹Ù„ÙˆÙ…</span>
                    </label>
                    <label style="display:flex; align-items:center; gap:8px;">
                        <input type="checkbox" value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" class="subject-checkbox">
                        <span>Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
                    </label>
                    <label style="display:flex; align-items:center; gap:8px;">
                        <input type="checkbox" value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©" class="subject-checkbox">
                        <span>Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</span>
                    </label>
                    <label style="display:flex; align-items:center; gap:8px;">
                        <input type="checkbox" value="Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª" class="subject-checkbox">
                        <span>Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª</span>
                    </label>
                    <label style="display:flex; align-items:center; gap:8px;">
                        <input type="checkbox" value="Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©" class="subject-checkbox">
                        <span>Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</span>
                    </label>
                </div>
            </div>
            
            <button class="btn-main" onclick="registerStudent()">
                <i class="fas fa-check"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø·Ø§Ù„Ø¨
            </button>
        </div>
    </div>
</div>

<!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø³ØªØ§Ø° -->
<div id="teacher-form" class="hidden">
    <div style="padding:20px;">
        <div style="display:flex; align-items:center; gap:15px; margin-bottom:30px;">
            <button class="btn-secondary" onclick="backToRegister()" style="width:auto; padding:10px 15px;">
                <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
            </button>
            <h2 style="color:var(--neon-blue); margin:0;">ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø£Ø³ØªØ§Ø°</h2>
        </div>
        
        <div style="background:var(--bg-card); padding:25px; border-radius:20px;">
            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:var(--accent);">
                    <i class="fas fa-user"></i> Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *
                </label>
                <input type="text" id="teacher-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" required>
            </div>
            
            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:var(--accent);">
                    <i class="fas fa-envelope"></i> Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *
                </label>
                <input type="email" id="teacher-email" placeholder="example@email.com" required>
            </div>
            
            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:var(--accent);">
                    <i class="fas fa-lock"></i> ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *
                </label>
                <input type="password" id="teacher-password" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©" required>
            </div>
            
            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:var(--accent);">
                    <i class="fas fa-book"></i> Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© *
                </label>
                <select id="teacher-subject" required>
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„ØªÙŠ ØªØ¯Ø±Ø³Ù‡Ø§</option>
                    <option value="Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª">Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                    <option value="Ø§Ù„Ø¹Ù„ÙˆÙ…">Ø§Ù„Ø¹Ù„ÙˆÙ…</option>
                    <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                    <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
                    <option value="Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡">Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡</option>
                    <option value="Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡">Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡</option>
                    <option value="Ø§Ù„Ø£Ø­ÙŠØ§Ø¡">Ø§Ù„Ø£Ø­ÙŠØ§Ø¡</option>
                    <option value="Ø§Ù„ØªØ§Ø±ÙŠØ®">Ø§Ù„ØªØ§Ø±ÙŠØ®</option>
                    <option value="Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§">Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§</option>
                    <option value="Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©">Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</option>
                    <option value="Ø§Ù„Ø­Ø§Ø³ÙˆØ¨">Ø§Ù„Ø­Ø§Ø³ÙˆØ¨</option>
                </select>
            </div>
            
            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:var(--accent);">
                    <i class="fas fa-graduation-cap"></i> Ø§Ù„ØµÙÙˆÙ Ø§Ù„ØªÙŠ ØªØ¯Ø±Ø³Ù‡Ø§ *
                </label>
                <select id="teacher-grades" multiple style="height:120px;">
                    <option value="Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ</option>
                    <option value="Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                    <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                    <option value="Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                    <option value="Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                    <option value="Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                    <option value="Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                    <option value="Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø·">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø·</option>
                    <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø·">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø·</option>
                    <option value="Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø·">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø·</option>
                    <option value="Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                    <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                    <option value="Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                </select>
                <small style="color:var(--text-sec);">Ø§Ø¶ØºØ· Ctrl Ù„ØªØ­Ø¯ÙŠØ¯ Ø£ÙƒØ«Ø± Ù…Ù† ØµÙ</small>
            </div>
            
            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:var(--accent);">
                    <i class="fas fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªÙˆØ§ØµÙ„ *
                </label>
                <input type="tel" id="teacher-whatsapp" placeholder="Ù…Ø«Ø§Ù„: 0912345678" required>
            </div>
            
            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:var(--accent);">
                    <i class="fas fa-bank"></i> Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø¨Ù†ÙƒÙŠ
                </label>
                <input type="text" id="teacher-account" placeholder="Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            </div>
            
            <button class="btn-main" onclick="registerTeacher()">
                <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            </button>
            
            <div style="margin-top:20px; padding:15px; background:rgba(245, 158, 11, 0.1); border-radius:10px;">
                <p style="color:var(--accent); font-size:14px; margin:0;">
                    <i class="fas fa-info-circle"></i> Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø·Ù„Ø¨Ùƒ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ù…Ù† Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
<div id="app-screen" class="hidden">
    <header>
        <div class="header-top">
            <span onclick="handleBackButton()" style="cursor:pointer; font-size:22px; color:var(--text-sec); width:30px; height:30px; display:flex; align-items:center; justify-content:center;">
                <i class="fas fa-arrow-right"></i>
            </span>
            <span id="head-title" style="font-weight: 800; font-size: 20px; color: var(--text-main); text-align:center; flex:1;">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            <div id="user-badge" style="background:rgba(255,255,255,0.1); padding:5px 12px; border-radius:15px; display:flex; align-items:center; gap:8px; cursor:pointer;" onclick="nav('profile')">
                <i class="fas fa-user" style="color:var(--accent); font-size:14px;"></i>
                <span id="user-name" style="font-size:14px; font-weight:bold;"></span>
            </div>
        </div>
        <div class="search-container" id="main-search">
            <i class="fas fa-search"></i>
            <input type="text" id="store-search" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙƒØªØ¨ØŒ Ø§Ù„ÙØµÙˆÙ„ØŒ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©..." oninput="debounceFilter(this.value)">
        </div>
    </header>

    <div id="content-area"></div>

    <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø³ÙÙ„ÙŠØ© -->
    <div class="bottom-tabs">
        <div class="tab-btn active" onclick="nav('home'); highlightTab(this)">
            <i class="fas fa-home"></i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </div>
        <div class="tab-btn" onclick="nav('library'); highlightTab(this)">
            <i class="fas fa-book"></i>Ø§Ù„Ù…ÙƒØªØ¨Ø©
        </div>
        <div class="tab-btn" onclick="nav('ai_assistant'); highlightTab(this)">
            <i class="fas fa-robot"></i>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯
        </div>
        <div class="tab-btn" onclick="nav('bot_uploads'); highlightTab(this)">
            <i class="fas fa-upload"></i>Ø§Ù„Ø±ÙØ¹
        </div>
        <div class="tab-btn" onclick="nav('live'); highlightTab(this)">
            <i class="fas fa-video"></i>Ø§Ù„Ø¨Ø«
        </div>
    </div>
</div>

<script>
// ==================== [ 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase ] ====================
const firebaseConfig = {
    apiKey: "AIzaSyAI_mUhuPNoO-XC0Q-VNoWft8UWFbAbIGg",
    authDomain: "sudan-market-6b122.firebaseapp.com",
    databaseURL: "https://sudan-market-6b122-default-rtdb.firebaseio.com",
    projectId: "sudan-market-6b122",
    storageBucket: "sudan-market-6b122.firebasestorage.app",
    messagingSenderId: "66729481566",
    appId: "1:66729481566:web:93393f28dc22d32cceebcf",
    measurementId: "G-XXXXXXXXXX"
};

// ØªÙ‡ÙŠØ¦Ø© Firebase
if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}

const auth = firebase.auth();
const db = firebase.database();

// ==================== [ 2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª (Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„ÙˆØ³ÙŠØ·) ] ====================
const BOT_SERVER_URL = window.location.origin.includes('localhost') 
    ? 'http://localhost:3000' 
    : 'https://YOUR-BOT-SERVER.onrender.com'; // Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ø±Ø§Ø¨Ø· Ø¨ÙˆØªÙƒ

console.log('ğŸ¤– Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨ÙˆØª:', BOT_SERVER_URL);

// ==================== [ 3. Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ] ====================
const ADMIN_EMAIL = "mb425262@gmail.com";
const ADMIN_BANK_ACCOUNT = "4426148";
const FREE_TRIAL_DAYS = 1;

let me = null;
let hStack = ['home'];
let currentUploads = [];
let botStats = null;

// ==================== [ 4. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ] ====================
function initializeApp() {
    document.getElementById('main-preloader').classList.add('hidden');
    
    auth.onAuthStateChanged((user) => {
        if (user) {
            loadUserData(user.uid);
        } else {
            showLoginScreen();
        }
    });
}

// ==================== [ 5. Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ù‚Ù„ ] ====================
function nav(view, extra) {
    hStack.push(view);
    const area = document.getElementById('content-area');
    
    const titles = {
        'home': 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
        'library': 'Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©',
        'ai_assistant': 'Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ',
        'bot_uploads': 'Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ù„Ø¨ÙˆØª',
        'live': 'Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±',
        'profile': 'Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ',
        'admin': 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',
        'upload_image': 'Ø±ÙØ¹ ØµÙˆØ±Ø©',
        'upload_book': 'Ø±ÙØ¹ ÙƒØªØ§Ø¨',
        'create_stream': 'Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø«',
        'bot_stats': 'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙˆØª'
    };
    
    document.getElementById('head-title').innerText = titles[view] || view;
    
    if (view === 'home') renderHome();
    else if (view === 'library') renderLibrary();
    else if (view === 'ai_assistant') renderAIAssistant();
    else if (view === 'bot_uploads') renderBotUploads();
    else if (view === 'live') renderLiveStreams();
    else if (view === 'profile') renderProfile();
    else if (view === 'admin') renderAdminPanel();
    else if (view === 'upload_image') renderUploadImage();
    else if (view === 'upload_book') renderUploadBook();
    else if (view === 'create_stream') renderCreateStream();
    else if (view === 'bot_stats') renderBotStats();
    
    highlightTab(document.querySelector(`[onclick*="${view}"]`));
}

function highlightTab(el) {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    if (el) el.classList.add('active');
}

// ==================== [ 6. Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ] ====================
function renderHome() {
    const area = document.getElementById('content-area');
    area.innerHTML = `
        <div style="padding:20px;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius:20px; padding:25px; color:white; margin-bottom:25px;">
                <h2 style="margin-top:0;">Ù…Ø±Ø­Ø¨Ø§Ù‹ ${me?.name || 'Ù…Ø³ØªØ®Ø¯Ù…'} ğŸ‘‹</h2>
                <p>${me?.role === 'teacher' ? 'Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ Ø£Ø³ØªØ§Ø° ' + me.subject : 'Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¹Ù„Ù… Ù…Ø¹ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ'}</p>
            </div>
            
            <div class="grid">
                <div class="card" onclick="nav('library')">
                    <i class="fas fa-book" style="color:#f59e0b"></i>
                    <b>Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</b>
                    <p style="font-size:12px; color:var(--text-sec)">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</p>
                </div>
                
                <div class="card" onclick="nav('ai_assistant')">
                    <i class="fas fa-robot" style="color:#8b5cf6"></i>
                    <b>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</b>
                    <p style="font-size:12px; color:var(--text-sec)">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø°ÙƒÙŠØ©</p>
                </div>
                
                <div class="card" onclick="nav('bot_uploads')">
                    <i class="fas fa-upload" style="color:#10b981"></i>
                    <b>Ø±ÙØ¹ Ù„Ù„Ø¨ÙˆØª</b>
                    <p style="font-size:12px; color:var(--text-sec)">Ø±ÙØ¹ ØµÙˆØ± ÙˆÙƒØªØ¨ Ù„Ù„Ø¨ÙˆØª</p>
                </div>
                
                <div class="card" onclick="nav('live')">
                    <i class="fas fa-video" style="color:#ef4444"></i>
                    <b>Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</b>
                    <p style="font-size:12px; color:var(--text-sec)">Ø¯Ø±ÙˆØ³ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ø¹ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</p>
                </div>
                
                ${me?.role === 'admin' ? `
                <div class="card" onclick="nav('admin')" style="border:2px solid var(--red);">
                    <i class="fas fa-cogs" style="color:var(--red)"></i>
                    <b>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</b>
                    <p style="font-size:12px; color:var(--text-sec)">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                </div>
                ` : ''}
                
                ${me?.role === 'teacher' ? `
                <div class="card" onclick="nav('create_stream')">
                    <i class="fas fa-broadcast-tower" style="color:var(--neon-blue)"></i>
                    <b>Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø«</b>
                    <p style="font-size:12px; color:var(--text-sec)">Ø§Ø¨Ø¯Ø£ Ø¨Ø«Ø§Ù‹ Ù…Ø¨Ø§Ø´Ø±Ø§Ù‹</p>
                </div>
                ` : ''}
            </div>
            
            <div style="margin-top:30px;">
                <h3><i class="fas fa-fire" style="color:var(--accent);"></i> Ø£Ø­Ø¯Ø« Ø§Ù„ÙƒØªØ¨</h3>
                <div id="recent-books" class="loading">
                    <div class="loading-spinner"></div>
                    <div>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØªØ¨...</div>
                </div>
            </div>
        </div>`;
    
    loadRecentBooks();
}

// ==================== [ 7. ÙˆØ§Ø¬Ù‡Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ù„Ø¨ÙˆØª ] ====================
function renderBotUploads() {
    const area = document.getElementById('content-area');
    area.innerHTML = `
        <div style="padding:20px;">
            <div style="display:flex; align-items:center; gap:15px; margin-bottom:30px;">
                <button class="btn-secondary" onclick="nav('home')" style="width:auto; padding:10px 15px;">
                    <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
                </button>
                <h2 style="color:var(--neon-blue); margin:0;">Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ù„Ø¨ÙˆØª</h2>
            </div>
            
            <div class="bot-status">
                <i class="fas fa-server"></i>
                <span>Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª: <span id="bot-status-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span></span>
            </div>
            
            <div class="grid">
                <div class="card" onclick="nav('upload_image')">
                    <i class="fas fa-image" style="color:#f59e0b"></i>
                    <b>Ø±ÙØ¹ ØµÙˆØ±Ø©</b>
                    <p style="font-size:12px; color:var(--text-sec)">ØªØ®Ø²ÙŠÙ† ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¨ÙˆØª</p>
                </div>
                
                <div class="card" onclick="nav('upload_book')">
                    <i class="fas fa-file-pdf" style="color:#ef4444"></i>
                    <b>Ø±ÙØ¹ ÙƒØªØ§Ø¨</b>
                    <p style="font-size:12px; color:var(--text-sec)">PDF Ù„Ù„Ø¨ÙˆØª (ØªØ®Ø²ÙŠÙ† ÙŠÙˆÙ…ÙŠÙ†)</p>
                </div>
                
                ${me?.role === 'teacher' || me?.role === 'admin' ? `
                <div class="card" onclick="nav('create_stream')">
                    <i class="fas fa-video" style="color:#3b82f6"></i>
                    <b>Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø«</b>
                    <p style="font-size:12px; color:var(--text-sec)">Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± Ø¹Ø¨Ø± Ø§Ù„Ø¨ÙˆØª</p>
                </div>
                ` : ''}
                
                <div class="card" onclick="nav('bot_stats')">
                    <i class="fas fa-chart-bar" style="color:#10b981"></i>
                    <b>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙˆØª</b>
                    <p style="font-size:12px; color:var(--text-sec)">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ†</p>
                </div>
            </div>
            
            <div style="margin-top:30px; background:var(--bg-card); padding:20px; border-radius:15px;">
                <h4><i class="fas fa-info-circle" style="color:var(--accent);"></i> ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¨ÙˆØªØŸ</h4>
                <ul style="color:var(--text-sec); padding-right:20px; line-height:1.8;">
                    <li>ğŸ“ <strong>ÙŠØ±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ù„Ø¨ÙˆØª</strong> (ÙŠØ®Ø²Ù†Ù‡Ø§ ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø³ÙŠØ±ÙØ±)</li>
                    <li>ğŸ”— <strong>ÙŠØ±Ø³Ù„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙÙ‚Ø·</strong> Ù„Ù€ Firebase (ÙŠÙˆÙØ± 95% Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†)</li>
                    <li>ğŸ—‘ï¸ <strong>ÙŠÙ…Ø³Ø­ Ø§Ù„Ù…Ù„ÙØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</strong> Ø¨Ø¹Ø¯ ÙŠÙˆÙ…ÙŠÙ†</li>
                    <li>âš¡ <strong>Ø£Ø³Ø±Ø¹ ØªØ­Ù…ÙŠÙ„</strong> (Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¨ÙˆØª Ù…Ø¨Ø§Ø´Ø±Ø©)</li>
                </ul>
            </div>
        </div>`;
    
    // ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª
    checkBotStatus();
}

// ==================== [ 8. Ø±ÙØ¹ ØµÙˆØ±Ø© Ù„Ù„Ø¨ÙˆØª ] ====================
function renderUploadImage() {
    const area = document.getElementById('content-area');
    area.innerHTML = `
        <div style="padding:20px;">
            <div style="display:flex; align-items:center; gap:15px; margin-bottom:30px;">
                <button class="btn-secondary" onclick="nav('bot_uploads')" style="width:auto; padding:10px 15px;">
                    <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
                </button>
                <h2 style="color:var(--neon-blue); margin:0;">Ø±ÙØ¹ ØµÙˆØ±Ø© Ù„Ù„Ø¨ÙˆØª</h2>
            </div>
            
            <div style="background:var(--bg-card); padding:25px; border-radius:20px;">
                <div class="upload-area" id="image-drop-area" onclick="document.getElementById('image-input').click()">
                    <i class="fas fa-cloud-upload-alt" style="font-size:48px; color:var(--accent); margin-bottom:15px;"></i>
                    <h4 style="margin:0 0 10px 0;">Ø§Ù†Ù‚Ø± Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§</h4>
                    <p style="color:var(--text-sec); margin:0;">Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©: JPG, PNG, GIF (Ø­ØªÙ‰ 10MB)</p>
                </div>
                
                <input type="file" id="image-input" accept="image/*" style="display:none;" onchange="handleImageUpload(this.files[0])">
                
                <div style="margin-top:20px;">
                    <label style="display:block; margin-bottom:8px; color:var(--accent);">
                        <i class="fas fa-tag"></i> ØªØµÙ†ÙŠÙ Ø§Ù„ØµÙˆØ±Ø©
                    </label>
                    <select id="image-category">
                        <option value="profile">ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©</option>
                        <option value="lesson">ØµÙˆØ±Ø© Ø¯Ø±Ø³</option>
                        <option value="book">ØºÙ„Ø§Ù ÙƒØªØ§Ø¨</option>
                        <option value="other">Ø£Ø®Ø±Ù‰</option>
                    </select>
                </div>
                
                <div style="margin-top:20px;">
                    <label style="display:block; margin-bottom:8px; color:var(--accent);">
                        <i class="fas fa-align-left"></i> ÙˆØµÙ Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                    </label>
                    <textarea id="image-description" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„ØµÙˆØ±Ø©..." rows="2"></textarea>
                </div>
                
                <div class="upload-progress" id="image-progress">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span id="image-filename"></span>
                        <span id="image-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="image-progress-bar"></div>
                    </div>
                    <p id="image-status" style="font-size:12px; color:var(--text-sec); margin-top:5px;">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø±ÙØ¹...</p>
                </div>
                
                <button class="btn-main" onclick="uploadImageToBot()" id="upload-image-btn" style="margin-top:20px;">
                    <i class="fas fa-upload"></i> Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø¨ÙˆØª
                </button>
                
                <div style="margin-top:20px; padding:15px; background:rgba(245, 158, 11, 0.1); border-radius:10px;">
                    <p style="color:var(--accent); font-size:14px; margin:0;">
                        <i class="fas fa-info-circle"></i> Ø³ÙŠØªÙ… ØªØ®Ø²ÙŠÙ† Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¨ÙˆØª Ù„Ù…Ø¯Ø© ÙŠÙˆÙ…ÙŠÙ† ÙÙ‚Ø·
                    </p>
                </div>
            </div>
        </div>`;
    
    setupDragAndDrop('image-drop-area', 'image-input', handleImageUpload);
}

let currentImageFile = null;
function handleImageUpload(file) {
    if (!file || !file.type.startsWith('image/')) {
        showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØ±Ø© ØµØ§Ù„Ø­');
        return;
    }
    
    if (file.size > 10 * 1024 * 1024) {
        showError('Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 10MB)');
        return;
    }
    
    currentImageFile = file;
    
    document.getElementById('image-filename').textContent = file.name;
    document.getElementById('image-progress').style.display = 'block';
    document.getElementById('upload-image-btn').disabled = false;
    
    // Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø©
    const reader = new FileReader();
    reader.onload = function(e) {
        const dropArea = document.getElementById('image-drop-area');
        dropArea.innerHTML = `
            <img src="${e.target.result}" style="max-width:200px; max-height:150px; border-radius:10px; margin-bottom:10px;">
            <p style="color:var(--text-sec);">${file.name}</p>
        `;
    };
    reader.readAsDataURL(file);
}

async function uploadImageToBot() {
    if (!currentImageFile) {
        showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹');
        return;
    }
    
    if (!me || !me.uid) {
        showError('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
        return;
    }
    
    const category = document.getElementById('image-category').value;
    const description = document.getElementById('image-description').value;
    
    const formData = new FormData();
    formData.append('image', currentImageFile);
    formData.append('userId', me.uid);
    formData.append('category', category);
    if (description) formData.append('description', description);
    
    try {
        document.getElementById('upload-image-btn').disabled = true;
        document.getElementById('upload-image-btn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';
        
        const response = await fetch(`${BOT_SERVER_URL}/api/upload-image`, {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
            showSuccess(`ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø¨ÙˆØª Ø¨Ù†Ø¬Ø§Ø­!`);
            console.log('ØµÙˆØ±Ø© Ø§Ù„Ø¨ÙˆØª:', data);
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            currentImageFile = null;
            setTimeout(() => nav('bot_uploads'), 2000);
        } else {
            showError(data.error || 'ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©');
        }
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©:', error);
        showError('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¨ÙˆØª');
    } finally {
        document.getElementById('upload-image-btn').disabled = false;
        document.getElementById('upload-image-btn').innerHTML = '<i class="fas fa-upload"></i> Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø¨ÙˆØª';
    }
}

// ==================== [ 9. Ø±ÙØ¹ ÙƒØªØ§Ø¨ Ù„Ù„Ø¨ÙˆØª ] ====================
function renderUploadBook() {
    const area = document.getElementById('content-area');
    area.innerHTML = `
        <div style="padding:20px;">
            <div style="display:flex; align-items:center; gap:15px; margin-bottom:30px;">
                <button class="btn-secondary" onclick="nav('bot_uploads')" style="width:auto; padding:10px 15px;">
                    <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
                </button>
                <h2 style="color:var(--neon-blue); margin:0;">Ø±ÙØ¹ ÙƒØªØ§Ø¨ Ù„Ù„Ø¨ÙˆØª</h2>
            </div>
            
            <div style="background:var(--bg-card); padding:25px; border-radius:20px;">
                <div class="upload-area" id="book-drop-area" onclick="document.getElementById('book-input').click()">
                    <i class="fas fa-file-pdf" style="font-size:48px; color:var(--accent); margin-bottom:15px;"></i>
                    <h4 style="margin:0 0 10px 0;">Ø§Ù†Ù‚Ø± Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„ÙƒØªØ§Ø¨ Ù‡Ù†Ø§</h4>
                    <p style="color:var(--text-sec); margin:0;">Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©: PDF ÙÙ‚Ø· (Ø­ØªÙ‰ 50MB)</p>
                </div>
                
                <input type="file" id="book-input" accept=".pdf" style="display:none;" onchange="handleBookUpload(this.files[0])">
                
                <div style="margin-top:20px;">
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                        <div>
                            <label style="display:block; margin-bottom:8px; color:var(--accent);">
                                <i class="fas fa-heading"></i> Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨ *
                            </label>
                            <input type="text" id="book-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨" required>
                        </div>
                        
                        <div>
                            <label style="display:block; margin-bottom:8px; color:var(--accent);">
                                <i class="fas fa-user"></i> Ø§Ù„Ù…Ø¤Ù„Ù *
                            </label>
                            <input type="text" id="book-author" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ù„Ù" required>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top:20px;">
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                        <div>
                            <label style="display:block; margin-bottom:8px; color:var(--accent);">
                                <i class="fas fa-graduation-cap"></i> Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ
                            </label>
                            <select id="book-grade">
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
                                <option value="Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                                <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                                <option value="Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                                <option value="Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                                <option value="Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                                <option value="Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                                <option value="Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø·">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø·</option>
                                <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø·">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø·</option>
                                <option value="Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø·">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø·</option>
                                <option value="Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                <option value="Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="display:block; margin-bottom:8px; color:var(--accent);">
                                <i class="fas fa-book-open"></i> Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©
                            </label>
                            <select id="book-subject">
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>
                                <option value="Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª">Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                                <option value="Ø§Ù„Ø¹Ù„ÙˆÙ…">Ø§Ù„Ø¹Ù„ÙˆÙ…</option>
                                <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
                                <option value="Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª">Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª</option>
                                <option value="Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©">Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top:20px;">
                    <label style="display:block; margin-bottom:8px; color:var(--accent);">
                        <i class="fas fa-align-left"></i> ÙˆØµÙ Ø§Ù„ÙƒØªØ§Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                    </label>
                    <textarea id="book-description" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„ÙƒØªØ§Ø¨..." rows="3"></textarea>
                </div>
                
                <div class="upload-progress" id="book-progress">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span id="book-filename"></span>
                        <span id="book-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="book-progress-bar"></div>
                    </div>
                    <p id="book-status" style="font-size:12px; color:var(--text-sec); margin-top:5px;">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø±ÙØ¹...</p>
                </div>
                
                <button class="btn-main" onclick="uploadBookToBot()" id="upload-book-btn" style="margin-top:20px;">
                    <i class="fas fa-upload"></i> Ø±ÙØ¹ Ø§Ù„ÙƒØªØ§Ø¨ Ù„Ù„Ø¨ÙˆØª
                </button>
                
                <div style="margin-top:20px; padding:15px; background:rgba(245, 158, 11, 0.1); border-radius:10px;">
                    <p style="color:var(--accent); font-size:14px; margin:0;">
                        <i class="fas fa-info-circle"></i> Ø³ÙŠØªÙ… ØªØ®Ø²ÙŠÙ† Ø§Ù„ÙƒØªØ§Ø¨ ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¨ÙˆØª Ù„Ù…Ø¯Ø© ÙŠÙˆÙ…ÙŠÙ† ÙÙ‚Ø·
                    </p>
                </div>
            </div>
        </div>`;
    
    setupDragAndDrop('book-drop-area', 'book-input', handleBookUpload);
}

let currentBookFile = null;
function handleBookUpload(file) {
    if (!file || file.type !== 'application/pdf') {
        showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù PDF ÙÙ‚Ø·');
        return;
    }
    
    if (file.size > 50 * 1024 * 1024) {
        showError('Ø­Ø¬Ù… Ø§Ù„ÙƒØªØ§Ø¨ ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 50MB)');
        return;
    }
    
    currentBookFile = file;
    
    document.getElementById('book-filename').textContent = file.name;
    document.getElementById('book-progress').style.display = 'block';
    document.getElementById('upload-book-btn').disabled = false;
    
    // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù
    const dropArea = document.getElementById('book-drop-area');
    dropArea.innerHTML = `
        <i class="fas fa-file-pdf" style="font-size:48px; color:var(--accent); margin-bottom:15px;"></i>
        <p style="color:var(--text-main); font-weight:bold;">${file.name}</p>
        <p style="color:var(--text-sec); font-size:12px;">${(file.size / (1024*1024)).toFixed(2)} MB</p>
    `;
}

async function uploadBookToBot() {
    if (!currentBookFile) {
        showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ÙƒØªØ§Ø¨ Ø£ÙˆÙ„Ø§Ù‹');
        return;
    }
    
    const title = document.getElementById('book-title').value.trim();
    const author = document.getElementById('book-author').value.trim();
    
    if (!title || !author) {
        showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨ ÙˆØ§Ù„Ù…Ø¤Ù„Ù');
        return;
    }
    
    const grade = document.getElementById('book-grade').value;
    const subject = document.getElementById('book-subject').value;
    const description = document.getElementById('book-description').value;
    
    const formData = new FormData();
    formData.append('book', currentBookFile);
    formData.append('title', title);
    formData.append('author', author);
    if (grade) formData.append('grade', grade);
    if (subject) formData.append('subject', subject);
    if (description) formData.append('description', description);
    
    try {
        document.getElementById('upload-book-btn').disabled = true;
        document.getElementById('upload-book-btn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';
        
        const response = await fetch(`${BOT_SERVER_URL}/api/upload-book`, {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
            showSuccess(`ØªÙ… Ø±ÙØ¹ Ø§Ù„ÙƒØªØ§Ø¨ Ù„Ù„Ø¨ÙˆØª Ø¨Ù†Ø¬Ø§Ø­!`);
            console.log('ÙƒØªØ§Ø¨ Ø§Ù„Ø¨ÙˆØª:', data);
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            currentBookFile = null;
            setTimeout(() => nav('bot_uploads'), 2000);
        } else {
            showError(data.error || 'ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ÙƒØªØ§Ø¨');
        }
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ÙƒØªØ§Ø¨:', error);
        showError('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¨ÙˆØª');
    } finally {
        document.getElementById('upload-book-btn').disabled = false;
        document.getElementById('upload-book-btn').innerHTML = '<i class="fas fa-upload"></i> Ø±ÙØ¹ Ø§Ù„ÙƒØªØ§Ø¨ Ù„Ù„Ø¨ÙˆØª';
    }
}

// ==================== [ 10. Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± Ø¹Ø¨Ø± Ø§Ù„Ø¨ÙˆØª ] ====================
function renderCreateStream() {
    const area = document.getElementById('content-area');
    area.innerHTML = `
        <div style="padding:20px;">
            <div style="display:flex; align-items:center; gap:15px; margin-bottom:30px;">
                <button class="btn-secondary" onclick="nav('bot_uploads')" style="width:auto; padding:10px 15px;">
                    <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
                </button>
                <h2 style="color:var(--neon-blue); margin:0;">Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± Ø¹Ø¨Ø± Ø§Ù„Ø¨ÙˆØª</h2>
            </div>
            
            <div style="background:var(--bg-card); padding:25px; border-radius:20px;">
                <div style="margin-bottom:20px;">
                    <label style="display:block; margin-bottom:8px; color:var(--accent);">
                        <i class="fas fa-heading"></i> Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø« *
                    </label>
                    <input type="text" id="stream-title" placeholder="Ù…Ø«Ø§Ù„: Ø¯Ø±Ø³ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø§Ù„Ø¬Ø¨Ø±" required>
                </div>
                
                <div style="margin-bottom:20px;">
                    <label style="display:block; margin-bottom:8px; color:var(--accent);">
                        <i class="fas fa-align-left"></i> ÙˆØµÙ Ø§Ù„Ø¨Ø«
                    </label>
                    <textarea id="stream-description" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ø¨Ø«..." rows="3"></textarea>
                </div>
                
                <div style="margin-bottom:20px;">
                    <label style="display:block; margin-bottom:8px; color:var(--accent);">
                        <i class="fas fa-clock"></i> ÙˆÙ‚Øª Ø§Ù„Ø¨Ø« (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                    </label>
                    <input type="datetime-local" id="stream-time">
                </div>
                
                <div class="upload-progress" id="stream-progress" style="display:none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="stream-progress-bar"></div>
                    </div>
                    <p id="stream-status" style="font-size:12px; color:var(--text-sec); margin-top:5px;">Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø«...</p>
                </div>
                
                <button class="btn-main" onclick="createBotStream()" id="create-stream-btn" style="background:linear-gradient(90deg, #ef4444, #dc2626);">
                    <i class="fas fa-broadcast-tower"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± Ø¹Ø¨Ø± Ø§Ù„Ø¨ÙˆØª
                </button>
                
                <div style="margin-top:20px; padding:15px; background:rgba(239, 68, 68, 0.1); border-radius:10px;">
                    <p style="color:var(--accent); font-size:14px; margin:0;">
                        <i class="fas fa-info-circle"></i> Ø§Ù„Ø¨ÙˆØª Ø³ÙŠÙ†Ø´Ø¦ Ø¨Ø«Ø§Ù‹ Ø¹Ù„Ù‰ YouTube ÙˆÙŠØ®Ø²Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙÙŠ Ø°Ø§ÙƒØ±ØªÙ‡
                    </p>
                </div>
            </div>
        </div>`;
}

async function createBotStream() {
    const title = document.getElementById('stream-title').value.trim();
    if (!title) {
        showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø«');
        return;
    }
    
    const description = document.getElementById('stream-description').value;
    const scheduledTime = document.getElementById('stream-time').value;
    
    try {
        document.getElementById('create-stream-btn').disabled = true;
        document.getElementById('create-stream-btn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';
        document.getElementById('stream-progress').style.display = 'block';
        
        const response = await fetch(`${BOT_SERVER_URL}/api/create-live-stream`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                teacherId: me.uid,
                title: title,
                description: description,
                scheduledTime: scheduledTime || null
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            showSuccess(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø« Ø¨Ù†Ø¬Ø§Ø­!`);
            console.log('Ø¨Ø« Ø§Ù„Ø¨ÙˆØª:', data);
            
            // Ø¹Ø±Ø¶ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø«
            Swal.fire({
                title: 'ğŸ‰ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø«!',
                html: `
                    <p>ØªÙ… ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨Ø« ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¨ÙˆØª</p>
                    <p><strong>Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø«:</strong><br>
                    <a href="${data.streamUrl}" target="_blank">${data.streamUrl}</a></p>
                    <p style="font-size:12px; color:var(--text-sec);">Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ ÙŠÙˆÙ…ÙŠÙ†</p>
                `,
                icon: 'success',
                confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹',
                background: '#1e293b',
                color: '#fff'
            });
            
            setTimeout(() => nav('live'), 2000);
        } else {
            showError(data.error || 'ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø«');
        }
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø«:', error);
        showError('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¨ÙˆØª');
    } finally {
        document.getElementById('create-stream-btn').disabled = false;
        document.getElementById('create-stream-btn').innerHTML = '<i class="fas fa-broadcast-tower"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± Ø¹Ø¨Ø± Ø§Ù„Ø¨ÙˆØª';
    }
}

// ==================== [ 11. Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙˆØª ] ====================
function renderBotStats() {
    const area = document.getElementById('content-area');
    area.innerHTML = `
        <div style="padding:20px;">
            <div style="display:flex; align-items:center; gap:15px; margin-bottom:30px;">
                <button class="btn-secondary" onclick="nav('bot_uploads')" style="width:auto; padding:10px 15px;">
                    <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
                </button>
                <h2 style="color:var(--neon-blue); margin:0;">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙˆØª</h2>
            </div>
            
            <div id="bot-stats-container" class="loading">
                <div class="loading-spinner"></div>
                <div>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙˆØª...</div>
            </div>
        </div>`;
    
    loadBotStats();
}

async function loadBotStats() {
    try {
        const response = await fetch(`${BOT_SERVER_URL}/api/bot-stats`);
        const data = await response.json();
        
        if (data.success) {
            botStats = data;
            displayBotStats(data);
        } else {
            showError('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙˆØª');
        }
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙˆØª:', error);
        showError('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¨ÙˆØª');
    }
}

function displayBotStats(stats) {
    const container = document.getElementById('bot-stats-container');
    
    container.innerHTML = `
        <div class="grid">
            <div class="card">
                <i class="fas fa-video" style="color:#ef4444"></i>
                <b>${stats.stats.streams || 0}</b>
                <p style="font-size:12px; color:var(--text-sec)">Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±</p>
            </div>
            
            <div class="card">
                <i class="fas fa-image" style="color:#f59e0b"></i>
                <b>${stats.stats.images || 0}</b>
                <p style="font-size:12px; color:var(--text-sec)">ØµÙˆØ±Ø©</p>
            </div>
            
            <div class="card">
                <i class="fas fa-book" style="color:#3b82f6"></i>
                <b>${stats.stats.books || 0}</b>
                <p style="font-size:12px; color:var(--text-sec)">ÙƒØªØ§Ø¨</p>
            </div>
            
            <div class="card">
                <i class="fas fa-database" style="color:#10b981"></i>
                <b>${stats.stats.total || 0}</b>
                <p style="font-size:12px; color:var(--text-sec)">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª</p>
            </div>
        </div>
        
        <div style="margin-top:30px; background:var(--bg-card); padding:20px; border-radius:15px;">
            <h4><i class="fas fa-chart-line" style="color:var(--accent);"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
            <div style="line-height:2.5; margin-top:15px;">
                <div style="display:flex; justify-content:space-between;">
                    <span style="color:var(--text-sec);">ÙˆÙ‚Øª Ø§Ù„ØªØ´ØºÙŠÙ„:</span>
                    <span>${Math.floor(stats.uptime / 3600)} Ø³Ø§Ø¹Ø©</span>
                </div>
                <div style="display:flex; justify-content:space-between;">
                    <span style="color:var(--text-sec);">Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¨ÙˆØª:</span>
                    <span>${(stats.memory.rss / 1024 / 1024).toFixed(1)} MB</span>
                </div>
                <div style="display:flex; justify-content:space-between;">
                    <span style="color:var(--text-sec);">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</span>
                    <span>${new Date(stats.serverTime).toLocaleString('ar-SA')}</span>
                </div>
            </div>
        </div>
        
        <div style="margin-top:20px; padding:15px; background:rgba(59, 130, 246, 0.1); border-radius:10px;">
            <p style="color:var(--accent); font-size:14px; margin:0;">
                <i class="fas fa-info-circle"></i> Ø§Ù„Ø¨ÙˆØª ÙŠØ­ØªÙØ¸ Ø¨Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ø°Ø§ÙƒØ±ØªÙ‡ Ù„Ù…Ø¯Ø© ÙŠÙˆÙ…ÙŠÙ† ÙÙ‚Ø·ØŒ Ø«Ù… ÙŠØ­Ø°ÙÙ‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            </p>
        </div>
        
        <button class="btn-secondary" onclick="loadBotStats()" style="margin-top:20px;">
            <i class="fas fa-redo"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        </button>`;
}

// ==================== [ 12. Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ] ====================
function setupDragAndDrop(dropAreaId, inputId, onFileSelect) {
    const dropArea = document.getElementById(dropAreaId);
    const fileInput = document.getElementById(inputId);
    
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    ['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, unhighlight, false);
    });
    
    function highlight() {
        dropArea.classList.add('dragover');
    }
    
    function unhighlight() {
        dropArea.classList.remove('dragover');
    }
    
    dropArea.addEventListener('drop', handleDrop, false);
    
    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        
        if (files.length > 0) {
            onFileSelect(files[0]);
        }
    }
}

async function checkBotStatus() {
    try {
        const response = await fetch(`${BOT_SERVER_URL}/api/bot-stats`);
        if (response.ok) {
            document.getElementById('bot-status-text').textContent = 'ğŸŸ¢ Ù…ØªØµÙ„';
            document.getElementById('bot-status-text').style.color = '#10b981';
            return true;
        } else {
            document.getElementById('bot-status-text').textContent = 'ğŸ”´ ØºÙŠØ± Ù…ØªØµÙ„';
            document.getElementById('bot-status-text').style.color = '#ef4444';
            return false;
        }
    } catch (error) {
        document.getElementById('bot-status-text').textContent = 'ğŸ”´ ØºÙŠØ± Ù…ØªØµÙ„';
        document.getElementById('bot-status-text').style.color = '#ef4444';
        return false;
    }
}

// ==================== [ 13. Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ] ====================
async function loginUser() {
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    
    try {
        await auth.signInWithEmailAndPassword(email, password);
        showSuccess('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
    } catch (error) {
        showError('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message);
    }
}

async function registerStudent() {
    // ... (Ø§Ø¨Ù‚Ù‰ Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ)
}

