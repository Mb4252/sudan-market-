<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÙˆÙ‚ Ø§Ù„Ø³ÙˆØ¯Ø§Ù† Ø§Ù„Ø´Ø§Ù…Ù„ ğŸ‡¸ğŸ‡©</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root { 
            --navy: #131921; 
            --orange: #febd69; 
            --bg: #f3f3f3; 
            --whatsapp: #25D366; 
            --maps: #4285F4;
            --white: #ffffff;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: var(--bg); color: #333; line-height: 1.6; }
        
        header { 
            background: var(--navy); padding: 15px; color: white; 
            position: sticky; top: 0; z-index: 1000; text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .search-area { background: var(--navy); padding: 10px 15px; }
        .search-box { 
            display: flex; background: white; border-radius: 8px; overflow: hidden; 
            border: 2px solid var(--orange); transition: 0.3s;
        }
        .search-box input { flex: 1; border: none; padding: 12px; outline: none; font-size: 16px; }

        .nav-tools { 
            display: none; justify-content: space-between; padding: 12px 20px; 
            background: #232f3e; color: white; align-items: center;
        }

        .slider { width: 100%; height: 200px; position: relative; overflow: hidden; background: #000; }
        .slide { position: absolute; width: 100%; height: 100%; opacity: 0; transition: opacity 0.8s ease-in-out; }
        .slide.active { opacity: 1; }
        .slide img { width: 100%; height: 100%; object-fit: cover; }

        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 15px; }
        @media (min-width: 768px) { .grid { grid-template-columns: repeat(4, 1fr); } }

        .cat-card { 
            background: var(--white); border-radius: 12px; text-align: center; 
            box-shadow: var(--shadow); cursor: pointer; overflow: hidden; 
            transition: 0.2s; border: 1px solid #eee;
        }
        .cat-card:active { transform: scale(0.95); }
        .cat-card img { width: 100%; height: 110px; object-fit: cover; }
        .cat-card span { display: block; padding: 10px; font-weight: bold; font-size: 14px; }

        .post-card { 
            background: white; border-radius: 15px; overflow: hidden; 
            margin-bottom: 25px; box-shadow: var(--shadow); border: 1px solid #e0e0e0;
        }
        .post-card img { width: 100%; max-height: 400px; object-fit: cover; }
        .post-content { padding: 18px; }
        
        .btn-wa, .btn-gps { 
            display: block; color: white; text-align: center; padding: 14px; 
            text-decoration: none; border-radius: 10px; font-weight: bold; 
            margin-bottom: 10px; transition: 0.3s;
        }
        .btn-wa { background: var(--whatsapp); }
        .btn-gps { background: var(--maps); }

        .post-form { 
            background: white; padding: 20px; border-radius: 15px; 
            margin: 15px; box-shadow: var(--shadow); border: 2px solid var(--orange);
        }
        input, textarea { 
            width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; 
            border-radius: 8px; box-sizing: border-box;
        }

        .comments-section { background: #f9f9f9; padding: 12px; border-radius: 10px; margin-top: 15px; border-top: 1px solid #eee; }
        .comment-item { 
            background: white; padding: 10px; border-radius: 8px; margin-bottom: 8px; 
            border-right: 4px solid var(--orange); font-size: 13px;
        }
    </style>
</head>
<body>

<header><b>ğŸ‡¸ğŸ‡© Ø³ÙˆÙ‚ Ø§Ù„Ø³ÙˆØ¯Ø§Ù† Ø§Ù„Ø´Ø§Ù…Ù„ Ø§Ù„Ù…Ø·ÙˆØ±</b></header>

<div class="search-area">
    <div class="search-box">
        <input type="text" id="gSearch" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚..." oninput="doSearch()">
    </div>
</div>

<div class="nav-tools" id="navBar">
    <div onclick="goBack()" style="cursor:pointer;">ğŸ”™ Ø±Ø¬ÙˆØ¹</div>
    <div id="titleShow" style="font-weight:bold; color:var(--orange);"></div>
    <div onclick="resetHome()" style="cursor:pointer;">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
</div>

<div id="sliderArea" class="slider">
    <div class="slide active"><img src="https://images.pexels.com/photos/5632371/pexels-photo-5632371.jpeg?auto=compress&cs=tinysrgb&w=800"></div>
    <div class="slide"><img src="https://images.pexels.com/photos/1884581/pexels-photo-1884581.jpeg?auto=compress&cs=tinysrgb&w=800"></div>
    <div class="slide"><img src="https://images.pexels.com/photos/3944405/pexels-photo-3944405.jpeg?auto=compress&cs=tinysrgb&w=800"></div>
</div>

<div id="home" class="grid">
    <div class="cat-card" onclick="goSub('Ù…ÙˆØ¨Ø§ÙŠÙ„Ø§Øª')"><img src="https://images.pexels.com/photos/404280/pexels-photo-404280.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸ“± Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„Ø§Øª</span></div>
    <div class="cat-card" onclick="goSub('Ø³ÙŠØ§Ø±Ø§Øª')"><img src="https://images.pexels.com/photos/210019/pexels-photo-210019.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸš— Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</span></div>
    <div class="cat-card" onclick="goSub('Ø§Ù„Ù…ØºØ§Ù„Ù‚')"><img src="https://images.pexels.com/photos/2219024/pexels-photo-2219024.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸ—ï¸ Ø§Ù„Ù…ØºØ§Ù„Ù‚ ÙˆØ§Ù„Ø¨Ù†Ø§Ø¡</span></div>
    <div class="cat-card" onclick="goSub('ÙƒÙ‡Ø±Ø¨Ø§Ø¡')"><img src="https://images.pexels.com/photos/257736/pexels-photo-257736.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸ’¡ Ø£Ø¬Ù‡Ø²Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</span></div>
    <div class="cat-card" onclick="goSub('Ø¹Ù‚Ø§Ø±Ø§Øª')"><img src="https://images.pexels.com/photos/106399/pexels-photo-106399.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸ  Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</span></div>
    <div class="cat-card" onclick="goSub('Ø£Ø«Ø§Ø«')"><img src="https://images.pexels.com/photos/1350789/pexels-photo-1350789.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸ›‹ï¸ Ø£Ø«Ø§Ø« ÙˆÙ…Ù†Ø²Ù„</span></div>
    <div class="cat-card" onclick="goSub('Ù…Ù„Ø§Ø¨Ø³')"><img src="https://images.pexels.com/photos/996329/pexels-photo-996329.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸ‘• Ù…Ù„Ø§Ø¨Ø³ ÙˆØ£Ø­Ø°ÙŠØ©</span></div>
    <div class="cat-card" onclick="goSub('Ø·Ø§Ù‚Ø©')"><img src="https://images.pexels.com/photos/356036/pexels-photo-356036.jpeg?auto=compress&cs=tinysrgb&w=400"><span>â˜€ï¸ Ø·Ø§Ù‚Ø© Ø´Ù…Ø³ÙŠØ©</span></div>
</div>

<div id="sub" class="grid" style="display:none;"></div>

<div id="final" style="display:none; padding-bottom: 50px;">
    <div class="post-form">
        <h3 id="formAction">Ù†Ø´Ø± ÙÙŠ Ù‚Ø³Ù…: <span id="targetCat" style="color:var(--orange)"></span></h3>
        <input type="text" id="pUser" placeholder="Ø§Ø³Ù…Ùƒ">
        <input type="text" id="pTitle" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
        <input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
        <textarea id="pDesc" placeholder="Ø§Ù„ÙˆØµÙ..."></textarea>
        <input type="password" id="pPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„Ø­Ø°Ù">
        <input type="number" id="pPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨">
        <button onclick="getGPS()" style="width:100%; padding:12px; background:#f0f0f0; border:1px solid #ccc; margin:5px 0; border-radius:8px; cursor:pointer;">ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
        <input type="hidden" id="pLat"> <input type="hidden" id="pLng">
        <button onclick="document.getElementById('fInp').click()" id="uploadBtnUI" style="width:100%; padding:15px; border-radius:8px; background:#444; color:white; font-weight:bold; cursor:pointer;">ğŸ“¸ Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</button>
        <input type="file" id="fInp" style="display:none" accept="image/*" onchange="processImage(this)">
        <input type="hidden" id="pImg">
        <button onclick="sendPost()" style="width:100%; background:var(--orange); border:none; padding:15px; font-weight:bold; border-radius:10px; margin-top:10px; cursor:pointer;">Ù†Ø´Ø± Ø§Ù„Ø¢Ù† âœ…</button>
    </div>
    <div id="feed" style="padding:15px;"></div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://sudan-market-6b122-default-rtdb.firebaseio.com" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let sIdx = 0;
    setInterval(() => {
        let slides = document.querySelectorAll('.slide');
        if(slides.length) {
            slides.forEach(s => s.classList.remove('active'));
            sIdx = (sIdx + 1) % slides.length;
            slides[sIdx].classList.add('active');
        }
    }, 3000);

    const tree = {
        "Ù…ÙˆØ¨Ø§ÙŠÙ„Ø§Øª": [{n: "Ø¢ÙŠÙÙˆÙ†", img: "https://images.pexels.com/photos/805922/pexels-photo-805922.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬", img: "https://images.pexels.com/photos/47261/pexels-photo-47261.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ù‡ÙˆÙ†Ø±", img: "https://images.pexels.com/photos/1474132/pexels-photo-1474132.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "Ø³ÙŠØ§Ø±Ø§Øª": [{n: "ØªÙˆÙŠÙˆØªØ§", img: "https://images.pexels.com/photos/3311574/pexels-photo-3311574.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ", img: "https://images.pexels.com/photos/11051515/pexels-photo-11051515.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "Ø§Ù„Ù…ØºØ§Ù„Ù‚": [{n: "Ø£Ø³Ù…Ù†Øª", img: "https://images.pexels.com/photos/2219024/pexels-photo-2219024.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø³ÙŠØ®", img: "https://images.pexels.com/photos/162539/pexels-photo-162539.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "ÙƒÙ‡Ø±Ø¨Ø§Ø¡": [{n: "Ù…ÙƒÙŠÙØ§Øª", img: "https://images.pexels.com/photos/1454806/pexels-photo-1454806.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "Ø¹Ù‚Ø§Ø±Ø§Øª": [{n: "Ø¨ÙŠÙˆØª", img: "https://images.pexels.com/photos/106399/pexels-photo-106399.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "Ø£Ø«Ø§Ø«": [{n: "Ø£Ø·Ù‚Ù… Ø¬Ù„ÙˆØ³", img: "https://images.pexels.com/photos/1350789/pexels-photo-1350789.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "Ù…Ù„Ø§Ø¨Ø³": [{n: "ØªÙŠØ§Ø¨", img: "https://images.pexels.com/photos/996329/pexels-photo-996329.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "Ø·Ø§Ù‚Ø©": [{n: "Ø£Ù„ÙˆØ§Ø­", img: "https://images.pexels.com/photos/356036/pexels-photo-356036.jpeg?auto=compress&cs=tinysrgb&w=400"}]
    };

    let page = 'home', curS = '';

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± ÙƒÙ…Ø§ ÙƒØ§Ù†Øª ÙÙŠ ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ
    function processImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById('pImg').value = e.target.result;
                document.getElementById('uploadBtnUI').innerText = "âœ… Ø§Ù„ØµÙˆØ±Ø© Ø¬Ø§Ù‡Ø²Ø©";
                document.getElementById('uploadBtnUI').style.background = "#25D366";
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function getGPS() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(p => {
                document.getElementById('pLat').value = p.coords.latitude;
                document.getElementById('pLng').value = p.coords.longitude;
                Swal.fire('ØªÙ…!', 'ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }, () => {
                Swal.fire('Ø®Ø·Ø£', 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹', 'error');
            });
        }
    }

    function sendPost() {
        let u = document.getElementById('pUser').value, t = document.getElementById('pTitle').value, img = document.getElementById('pImg').value;
        if(!u || !t || !img) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØµÙˆØ±Ø©', 'warning');
        
        db.ref('all_posts').push({
            user: u, title: t, price: document.getElementById('pPrice').value, 
            desc: document.getElementById('pDesc').value, pass: document.getElementById('pPass').value, 
            phone: "249" + document.getElementById('pPhone').value,
            lat: document.getElementById('pLat').value || "", lng: document.getElementById('pLng').value || "",
            img: img, cat: curS
        });
        Swal.fire('ØªÙ…!', 'Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ù‚Ø³Ù… ' + curS, 'success');
        resetHome();
    }

    function addComment(postId) {
        let n = document.getElementById('cName-'+postId).value, t = document.getElementById('cText-'+postId).value;
        if(!n || !t) return Swal.fire('Ø¹Ø°Ø±Ø§Ù‹', 'Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ ÙˆØªØ¹Ù„ÙŠÙ‚Ùƒ', 'info');
        db.ref('all_posts/' + postId + '/comments').push({ name: n, text: t });
        document.getElementById('cText-'+postId).value = '';
    }

    function loadPosts() {
        db.ref('all_posts').on('value', snap => {
            let f = document.getElementById('feed'); f.innerHTML = '';
            snap.forEach(c => {
                let v = c.val(), k = c.key;
                if(v.cat === curS) {
                    let comms = '';
                    if(v.comments) Object.values(v.comments).forEach(cm => { comms += `<div class="comment-item"><b>${cm.name}:</b> ${cm.text}</div>`; });
                    f.innerHTML += `
                    <div class="post-card">
                        <img src="${v.img}">
                        <div class="post-content">
                            <b>${v.title}</b> <span style="color:red; float:left;">${v.price} Ø¬.Ø³</span>
                            <p>${v.desc}</p>
                            <a href="https://wa.me/${v.phone}" class="btn-wa">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</a>
                            ${v.lat ? `<a href="https://www.google.com/maps?q=${v.lat},${v.lng}" target="_blank" class="btn-gps">ğŸ“ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØ§Ø¬Ø±</a>` : ''}
                            <div class="comments-section">
                                <div id="list-${k}">${comms}</div>
                                <div class="comment-input-area" style="display:flex; gap:5px; margin-top:10px;">
                                    <input type="text" id="cName-${k}" placeholder="Ø§Ø³Ù…Ùƒ">
                                    <input type="text" id="cText-${k}" placeholder="ØªØ¹Ù„ÙŠÙ‚Ùƒ...">
                                    <button onclick="addComment('${k}')" style="background:var(--navy); color:white; border:none; padding:5px 10px; border-radius:6px; cursor:pointer;">Ø¥Ø±Ø³Ø§Ù„</button>
                                </div>
                            </div>
                        </div>
                    </div>`;
                }
            });
        });
    }

    function doSearch() {
        let q = document.getElementById('gSearch').value.toLowerCase();
        document.querySelectorAll('.post-card').forEach(card => {
            card.style.display = card.innerText.toLowerCase().includes(q) ? 'block' : 'none';
        });
    }

    function goSub(m) { page = 'sub'; updateUI(); document.getElementById('titleShow').innerText = m; let sg = document.getElementById('sub'); sg.innerHTML = ''; tree[m].forEach(item => { sg.innerHTML += `<div class="cat-card" onclick="goFinal('${item.n}')"><img src="${item.img}"><span>${item.n}</span></div>`; }); }
    function goFinal(s) { page = 'final'; curS = s; document.getElementById('targetCat').innerText = s; updateUI(); loadPosts(); }
    function resetHome() { page = 'home'; updateUI(); }
    function goBack() { page = (page==='final')?'sub':'home'; updateUI(); }
    
    function updateUI() {
        document.getElementById('home').style.display = (page === 'home') ? 'grid' : 'none';
        document.getElementById('sliderArea').style.display = (page === 'home') ? 'block' : 'none';
        document.getElementById('navBar').style.display = (page === 'home') ? 'none' : 'flex';
        document.getElementById('sub').style.display = (page === 'sub') ? 'grid' : 'none';
        document.getElementById('final').style.display = (page === 'final') ? 'block' : 'none';
    }
</script>
</body>
</html>
