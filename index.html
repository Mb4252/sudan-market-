<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÙˆÙ‚ Ø§Ù„Ø³ÙˆØ¯Ø§Ù† Ø§Ù„Ø´Ø§Ù…Ù„ ğŸ‡¸ğŸ‡©</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root { --navy: #131921; --orange: #febd69; --bg: #eaeded; --whatsapp: #25D366; --maps: #4285F4; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--bg); color: #333; }
        header { background: var(--navy); padding: 15px; color: white; position: sticky; top: 0; z-index: 1000; text-align: center; }
        .search-area { background: var(--navy); padding: 10px; }
        .search-box { display: flex; background: white; border-radius: 6px; overflow: hidden; border: 2px solid var(--orange); }
        .search-box input { flex: 1; border: none; padding: 12px; outline: none; }
        .nav-tools { display: none; justify-content: space-between; padding: 12px; background: #232f3e; color: white; align-items: center; }
        .slider { width: 100%; height: 160px; position: relative; overflow: hidden; background: #000; }
        .slide { position: absolute; width: 100%; height: 100%; opacity: 0; transition: 1s; }
        .slide.active { opacity: 1; }
        .slide img { width: 100%; height: 100%; object-fit: cover; opacity: 0.7; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px; }
        @media (min-width: 600px) { .grid { grid-template-columns: repeat(4, 1fr); } }
        .cat-card { background: white; border-radius: 10px; text-align: center; border: 1px solid #ddd; cursor: pointer; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: 0.2s; }
        .cat-card img { width: 100%; height: 100px; object-fit: cover; }
        .cat-card span { display: block; padding: 8px; font-weight: bold; font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .post-card { background: white; border-radius: 12px; overflow: hidden; margin-bottom: 20px; border: 1px solid #ddd; position: relative; }
        .post-card img { width: 100%; height: 280px; object-fit: cover; }
        .post-content { padding: 15px; }
        .btn-wa { display: block; background: var(--whatsapp); color: white; text-align: center; padding: 12px; text-decoration: none; border-radius: 8px; font-weight: bold; margin-bottom: 8px; }
        .btn-gps { display: block; background: var(--maps); color: white; text-align: center; padding: 12px; text-decoration: none; border-radius: 8px; font-weight: bold; }
        .post-form { background: white; padding: 15px; border: 2px solid var(--orange); border-radius: 10px; margin: 15px; }
        input, textarea { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        .admin-controls { position: absolute; top: 10px; left: 10px; display: flex; gap: 5px; }
        .btn-mini { background: rgba(0,0,0,0.6); color: white; border: none; padding: 5px 8px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>

<header><b>ğŸ‡¸ğŸ‡© Ø³ÙˆÙ‚ Ø§Ù„Ø³ÙˆØ¯Ø§Ù† Ø§Ù„Ø´Ø§Ù…Ù„</b></header>

<div class="search-area">
    <div class="search-box"><input type="text" id="gSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡ ÙÙŠ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†..." oninput="doSearch()"></div>
</div>

<div class="nav-tools" id="navBar">
    <div onclick="goBack()" style="cursor:pointer;">ğŸ”™ Ø±Ø¬ÙˆØ¹</div>
    <div id="titleShow" style="font-weight:bold; color:var(--orange);"></div>
    <div onclick="resetHome()" style="cursor:pointer;">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
</div>

<div id="sliderArea" class="slider">
    <div class="slide active"><img src="https://images.pexels.com/photos/5632371/pexels-photo-5632371.jpeg?auto=compress&cs=tinysrgb&w=800"></div>
    <div class="slide"><img src="https://images.pexels.com/photos/1884581/pexels-photo-1884581.jpeg?auto=compress&cs=tinysrgb&w=800"></div>
</div>

<div id="home" class="grid">
    <div class="cat-card" onclick="goSub('Ù…ÙˆØ¨Ø§ÙŠÙ„Ø§Øª')"><img src="https://images.pexels.com/photos/404280/pexels-photo-404280.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸ“± Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„Ø§Øª</span></div>
    <div class="cat-card" onclick="goSub('Ø³ÙŠØ§Ø±Ø§Øª')"><img src="https://images.pexels.com/photos/210019/pexels-photo-210019.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸš— Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</span></div>
    <div class="cat-card" onclick="goSub('Ø§Ù„Ù…ØºØ§Ù„Ù‚')"><img src="https://images.pexels.com/photos/2219024/pexels-photo-2219024.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸ—ï¸ Ø§Ù„Ù…ØºØ§Ù„Ù‚ ÙˆØ§Ù„Ø¨Ù†Ø§Ø¡</span></div>
    <div class="cat-card" onclick="goSub('ÙƒÙ‡Ø±Ø¨Ø§Ø¡')"><img src="https://images.pexels.com/photos/257736/pexels-photo-257736.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸ’¡ Ø£Ø¬Ù‡Ø²Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</span></div>
    <div class="cat-card" onclick="goSub('Ø¹Ù‚Ø§Ø±Ø§Øª')"><img src="https://images.pexels.com/photos/106399/pexels-photo-106399.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸ  Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</span></div>
    <div class="cat-card" onclick="goSub('Ø£Ø«Ø§Ø«')"><img src="https://images.pexels.com/photos/1350789/pexels-photo-1350789.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸ›‹ï¸ Ø£Ø«Ø§Ø« ÙˆÙ…Ù†Ø²Ù„</span></div>
    <div class="cat-card" onclick="goSub('Ù…Ù„Ø§Ø¨Ø³')"><img src="https://images.pexels.com/photos/996329/pexels-photo-996329.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸ‘• Ù…Ù„Ø§Ø¨Ø³ ÙˆØ£Ø­Ø°ÙŠØ©</span></div>
    <div class="cat-card" onclick="goSub('Ø·Ø§Ù‚Ø©')"><img src="https://images.pexels.com/photos/356036/pexels-photo-356036.jpeg?auto=compress&cs=tinysrgb&w=400"><span>â˜€ï¸ Ø·Ø§Ù‚Ø© Ø´Ù…Ø³ÙŠØ©</span></div>
    <div class="cat-card" onclick="goSub('Ù…Ø­Ø§ØµÙŠÙ„')"><img src="https://images.pexels.com/photos/235925/pexels-photo-235925.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸŒ¾ Ù…Ø­Ø§ØµÙŠÙ„ Ø²Ø±Ø§Ø¹ÙŠØ©</span></div>
    <div class="cat-card" onclick="goSub('Ø­ÙŠÙˆØ§Ù†Ø§Øª')"><img src="https://images.pexels.com/photos/457447/pexels-photo-457447.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸ‘ Ø­ÙŠÙˆØ§Ù†Ø§Øª ÙˆÙ…ÙˆØ§Ø´ÙŠ</span></div>
    <div class="cat-card" onclick="goSub('ØªÙ…ÙˆÙŠÙ†')"><img src="https://images.pexels.com/photos/264636/pexels-photo-264636.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸ›’ Ù…ÙˆØ§Ø¯ ØªÙ…ÙˆÙŠÙ†ÙŠØ©</span></div>
    <div class="cat-card" onclick="goSub('ÙˆØ¸Ø§Ø¦Ù')"><img src="https://images.pexels.com/photos/3184328/pexels-photo-3184328.jpeg?auto=compress&cs=tinysrgb&w=400"><span>ğŸ’¼ ÙˆØ¸Ø§Ø¦Ù ÙˆØ®Ø¯Ù…Ø§Øª</span></div>
</div>

<div id="sub" class="grid" style="display:none;"></div>

<div id="final" style="display:none; padding-bottom: 40px;">
    <div class="post-form">
        <h3 id="formAction">Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯</h3>
        <input type="text" id="pUser" placeholder="Ø§Ø³Ù… Ø§Ù„ØªØ§Ø¬Ø±">
        <input type="text" id="pTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³Ù„Ø¹Ø©">
        <input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
        <textarea id="pDesc" placeholder="Ø§Ù„ØªÙØ§ØµÙŠÙ„..."></textarea>
        <input type="password" id="pPass" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†">
        <input type="number" id="pPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨">
        <button onclick="getGPS()" style="width:100%; padding:10px; background:#eee; border:1px solid #ccc; margin:5px 0; border-radius:8px;">ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
        <input type="hidden" id="pLat"> <input type="hidden" id="pLng">
        <button onclick="document.getElementById('fInp').click()" style="width:100%; padding:10px; border-radius:8px; background:#444; color:white;">ğŸ“¸ Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</button>
        <input type="file" id="fInp" style="display:none" onchange="uploadImg(this)">
        <input type="hidden" id="pImg">
        <button onclick="sendPost()" style="width:100%; background:var(--orange); border:none; padding:15px; font-weight:bold; border-radius:10px; margin-top:10px;">Ù†Ø´Ø± Ø§Ù„Ø¢Ù† âœ…</button>
    </div>
    <div id="feed" style="padding:15px;"></div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://sudan-market-6b122-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø±
    let sIdx = 0;
    setInterval(() => {
        const slides = document.querySelectorAll('.slide');
        if(slides.length > 0) {
            slides[sIdx].classList.remove('active');
            sIdx = (sIdx + 1) % slides.length;
            slides[sIdx].classList.add('active');
        }
    }, 3000);

    const tree = {
        "Ù…ÙˆØ¨Ø§ÙŠÙ„Ø§Øª": [{n: "Ø¢ÙŠÙÙˆÙ†", img: "https://images.pexels.com/photos/805922/pexels-photo-805922.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬", img: "https://images.pexels.com/photos/47261/pexels-photo-47261.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ù‡ÙˆÙ†Ø±", img: "https://images.pexels.com/photos/1474132/pexels-photo-1474132.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "ØªÙƒÙ†Ùˆ ÙˆØ§Ù†ÙÙŠÙ†ÙŠÙƒØ³", img: "https://images.pexels.com/photos/607812/pexels-photo-607812.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª", img: "https://images.pexels.com/photos/1476055/pexels-photo-1476055.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "Ø³ÙŠØ§Ø±Ø§Øª": [{n: "ØªÙˆÙŠÙˆØªØ§ (Ø¨ÙˆÙƒØ³/Ø¨Ø±Ø§Ø¯Ùˆ)", img: "https://images.pexels.com/photos/3311574/pexels-photo-3311574.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ (Ø¢ÙØ§Ù†ØªÙŠ/ØªÙˆØ³Ø§Ù†)", img: "https://images.pexels.com/photos/11051515/pexels-photo-11051515.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø±ÙƒØ´Ø§Øª ÙˆÙ…ÙˆØ§ØªØ±", img: "https://images.pexels.com/photos/5956944/pexels-photo-5956944.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ù‚Ø·Ø¹ ØºÙŠØ§Ø±", img: "https://images.pexels.com/photos/190574/pexels-photo-190574.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "Ø§Ù„Ù…ØºØ§Ù„Ù‚": [{n: "Ø£Ø³Ù…Ù†Øª", img: "https://images.pexels.com/photos/2219024/pexels-photo-2219024.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø³ÙŠØ® ØµÙ„Ø¨", img: "https://images.pexels.com/photos/162539/pexels-photo-162539.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø¯Ù‡Ø§Ù†Ø§Øª ÙˆØ¨Ø±Ù‡Ø©", img: "https://images.pexels.com/photos/1667612/pexels-photo-1667612.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø£Ø¯ÙˆØ§Øª ØµØ­ÙŠØ©", img: "https://images.pexels.com/photos/323933/pexels-photo-323933.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "ÙƒÙ‡Ø±Ø¨Ø§Ø¡": [{n: "Ù…ÙƒÙŠÙØ§Øª Ù†Ø³Ù…Ø© ÙˆÙ„Ø¤Ù„Ø¤Ø©", img: "https://images.pexels.com/photos/1454806/pexels-photo-1454806.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø´Ø§Ø´Ø§Øª ÙˆØªÙ„ÙØ²ÙŠÙˆÙ†Ø§Øª", img: "https://images.pexels.com/photos/572056/pexels-photo-572056.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø«Ù„Ø§Ø¬Ø§Øª ÙˆØ¯ÙŠØ¨ ÙØ±ÙŠØ²Ø±", img: "https://images.pexels.com/photos/2343467/pexels-photo-2343467.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "ØºØ³Ø§Ù„Ø§Øª", img: "https://images.pexels.com/photos/4597621/pexels-photo-4597621.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "Ø¹Ù‚Ø§Ø±Ø§Øª": [{n: "Ø¨ÙŠÙˆØª Ù„Ù„Ø¨ÙŠØ¹", img: "https://images.pexels.com/photos/106399/pexels-photo-106399.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø´Ù‚Ù‚ Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±", img: "https://images.pexels.com/photos/271618/pexels-photo-271618.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø£Ø±Ø§Ø¶ÙŠ ÙˆÙ…Ø²Ø§Ø±Ø¹", img: "https://images.pexels.com/photos/259280/pexels-photo-259280.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "Ø·Ø§Ù‚Ø©": [{n: "Ø£Ù„ÙˆØ§Ø­ Ø´Ù…Ø³ÙŠØ©", img: "https://images.pexels.com/photos/356036/pexels-photo-356036.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø¨Ø·Ø§Ø±ÙŠØ§Øª (Ø¬Ù„/Ù„ÙŠØ«ÙŠÙˆÙ…)", img: "https://images.pexels.com/photos/459762/pexels-photo-459762.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø§Ù†ÙÙŠØ±ØªØ±Ø§Øª", img: "https://images.pexels.com/photos/257736/pexels-photo-257736.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "Ù…Ø­Ø§ØµÙŠÙ„": [{n: "Ø¨ØµÙ„ ÙˆÙÙ„ÙÙ„", img: "https://images.pexels.com/photos/533342/pexels-photo-533342.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø³Ù…Ø³Ù… ÙˆÙÙˆÙ„", img: "https://images.pexels.com/photos/235925/pexels-photo-235925.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "ØµÙ…Øº Ø¹Ø±Ø¨ÙŠ", img: "https://images.pexels.com/photos/235725/pexels-photo-235725.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "Ø­ÙŠÙˆØ§Ù†Ø§Øª": [{n: "Ø®Ø±Ø§Ù (Ø­Ù…Ø±ÙŠ/Ø¨Ù„Ø¯ÙŠ)", img: "https://images.pexels.com/photos/457447/pexels-photo-457447.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø£Ø¨Ù‚Ø§Ø± ÙˆØ¥Ø¨Ù„", img: "https://images.pexels.com/photos/2647053/pexels-photo-2647053.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø¯ÙˆØ§Ø¬Ù†", img: "https://images.pexels.com/photos/1769279/pexels-photo-1769279.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "ØªÙ…ÙˆÙŠÙ†": [{n: "Ø³ÙƒØ± ÙˆØ²ÙŠØª", img: "https://images.pexels.com/photos/264636/pexels-photo-264636.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø¯Ù‚ÙŠÙ‚ ÙˆÙ…Ø¹ÙƒØ±ÙˆÙ†Ø©", img: "https://images.pexels.com/photos/36712/pexels-photo-36712.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "Ø£Ø«Ø§Ø«": [{n: "Ø£Ø·Ù‚Ù… Ø¬Ù„ÙˆØ³", img: "https://images.pexels.com/photos/1350789/pexels-photo-1350789.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "ØºØ±Ù Ù†ÙˆÙ…", img: "https://images.pexels.com/photos/164595/pexels-photo-164595.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ù…Ø·Ø§Ø¨Ø®", img: "https://images.pexels.com/photos/2062426/pexels-photo-2062426.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "Ù…Ù„Ø§Ø¨Ø³": [{n: "ØªÙŠØ§Ø¨ Ø³ÙˆØ¯Ø§Ù†ÙŠØ©", img: "https://images.pexels.com/photos/996329/pexels-photo-996329.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "Ø¬Ù„Ø§Ø¨ÙŠØ¨ ÙˆØ¹Ù…Ø§Ù…Ø§Øª", img: "https://images.pexels.com/photos/298863/pexels-photo-298863.jpeg?auto=compress&cs=tinysrgb&w=400"}],
        "ÙˆØ¸Ø§Ø¦Ù": [{n: "ØµÙŠØ§Ù†Ø© Ù…Ù†Ø²Ù„ÙŠØ©", img: "https://images.pexels.com/photos/2219024/pexels-photo-2219024.jpeg?auto=compress&cs=tinysrgb&w=400"},{n: "ØªØ¯Ø±ÙŠØ³ ÙˆØ¯Ø±ÙˆØ³", img: "https://images.pexels.com/photos/3184328/pexels-photo-3184328.jpeg?auto=compress&cs=tinysrgb&w=400"}]
    };

    let page = 'home', curS = '', editId = null;

    function getGPS() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(p => {
                document.getElementById('pLat').value = p.coords.latitude;
                document.getElementById('pLng').value = p.coords.longitude;
                Swal.fire({ icon: 'success', title: 'Ø±Ø§Ø¦Ø¹!', text: 'ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­ ğŸ“', confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹', confirmButtonColor: '#febd69' });
            });
        }
    }

    async function uploadImg(i) {
        Swal.fire({ title: 'Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©...', allowOutsideClick: false, didOpen: () => { Swal.showLoading(); } });
        let fd = new FormData(); fd.append("image", i.files[0]);
        let res = await fetch("https://api.imgbb.com/1/upload?key=606414168058f5530182522709e23924", {method:"POST", body:fd});
        let d = await res.json(); document.getElementById('pImg').value = d.data.url;
        Swal.fire({ icon: 'success', title: 'Ù…Ù…ØªØ§Ø²!', text: 'ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­ ğŸ“¸', confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹', confirmButtonColor: '#febd69' });
    }

    function sendPost() {
        let u = document.getElementById('pUser').value;
        if(!u) return Swal.fire({ icon: 'warning', title: 'Ø¹Ø°Ø±Ø§Ù‹', text: 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ØªØ§Ø¬Ø±', confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹' });
        
        let obj = {
            user: u, title: document.getElementById('pTitle').value,
            price: document.getElementById('pPrice').value, desc: document.getElementById('pDesc').value,
            pass: document.getElementById('pPass').value, phone: "249" + document.getElementById('pPhone').value,
            lat: document.getElementById('pLat').value, lng: document.getElementById('pLng').value,
            img: document.getElementById('pImg').value || 'https://via.placeholder.com/400', cat: curS
        };

        if(editId) { db.ref('all_posts/'+editId).update(obj); editId = null; }
        else { db.ref('all_posts').push(obj); }

        Swal.fire({
            icon: 'success',
            title: 'ØªÙ… Ø¨Ù†Ø¬Ø§Ø­!',
            text: 'Ù„Ù‚Ø¯ ØªÙ… Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†Ùƒ ÙÙŠ Ø³ÙˆÙ‚ Ø§Ù„Ø³ÙˆØ¯Ø§Ù† Ø§Ù„Ø´Ø§Ù…Ù„ âœ…',
            confirmButtonText: 'Ø±Ø§Ø¦Ø¹',
            confirmButtonColor: '#febd69'
        });
        
        document.getElementById('pTitle').value = '';
        document.getElementById('pPrice').value = '';
        document.getElementById('pDesc').value = '';
        document.getElementById('pImg').value = '';
        loadPosts();
    }

    function loadPosts(query = "") {
        db.ref('all_posts').on('value', snap => {
            let f = document.getElementById('feed'); f.innerHTML = '';
            snap.forEach(c => {
                let v = c.val(), k = c.key;
                if((v.cat === curS && !query) || (query && v.title.toLowerCase().includes(query.toLowerCase()))) {
                    f.innerHTML += `
                    <div class="post-card">
                        <div class="admin-controls">
                            <button class="btn-mini" onclick="editPost('${k}', ${JSON.stringify(v).replace(/"/g, '&quot;')})">âœï¸</button>
                            <button class="btn-mini" style="background:red" onclick="delPost('${k}','${v.pass}')">ğŸ—‘ï¸</button>
                        </div>
                        <img src="${v.img || 'https://via.placeholder.com/400'}">
                        <div class="post-content">
                            <b>${v.title}</b>
                            <div style="color:red; font-size:20px; font-weight:bold;">${v.price} Ø¬.Ø³</div>
                            <p>${v.desc}</p>
                            <small>ğŸ‘¤ Ø§Ù„ØªØ§Ø¬Ø±: ${v.user}</small><br><br>
                            <a href="https://wa.me/${v.phone}" class="btn-wa">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</a>
                            ${v.lat ? `<a href="https://www.google.com/maps?q=${v.lat},${v.lng}" class="btn-gps" target="_blank">ğŸ“ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØ§Ø¬Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a>` : ''}
                        </div>
                    </div>`;
                }
            });
        });
    }

    function goSub(m) {
        page = 'sub'; updateUI(); document.getElementById('titleShow').innerText = m;
        let sg = document.getElementById('sub'); sg.innerHTML = '';
        tree[m].forEach(item => {
            sg.innerHTML += `<div class="cat-card" onclick="goFinal('${item.n}')"><img src="${item.img}"><span>${item.n}</span></div>`;
        });
    }

    function goFinal(s) { page = 'final'; curS = s; updateUI(); loadPosts(); }
    function resetHome() { page = 'home'; updateUI(); }
    function goBack() { page = (page==='final')?'sub':'home'; updateUI(); }
    function doSearch() { let s = document.getElementById('gSearch').value; if(s.length > 1) { page = 'final'; updateUI(); loadPosts(s); } }

    function updateUI() {
        document.getElementById('home').style.display = (page === 'home') ? 'grid' : 'none';
        document.getElementById('sliderArea').style.display = (page === 'home') ? 'block' : 'none';
        document.getElementById('navBar').style.display = (page === 'home') ? 'none' : 'flex';
        document.getElementById('sub').style.display = (page === 'sub') ? 'grid' : 'none';
        document.getElementById('final').style.display = (page === 'final') ? 'block' : 'none';
    }

    async function editPost(k, v) {
        const { value: password } = await Swal.fire({
            title: 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†',
            input: 'password',
            inputLabel: 'Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†',
            inputPlaceholder: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±',
            confirmButtonText: 'ØªØ£ÙƒÙŠØ¯',
            confirmButtonColor: '#febd69'
        });
        if(password === v.pass) {
            editId = k; document.getElementById('pTitle').value = v.title;
            document.getElementById('pPrice').value = v.price; document.getElementById('pDesc').value = v.desc;
            window.scrollTo(0,0);
        } else if(password) {
            Swal.fire({ icon: 'error', title: 'Ø®Ø·Ø£', text: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!' });
        }
    }

    async function delPost(k, pass) {
        const { value: password } = await Swal.fire({
            title: 'Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†',
            input: 'password',
            inputLabel: 'Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„Ø­Ø°Ù',
            inputPlaceholder: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±',
            confirmButtonText: 'Ø­Ø°Ù Ø§Ù„Ø¢Ù†',
            confirmButtonColor: 'red'
        });
        if(password === pass) { 
            db.ref('all_posts/'+k).remove();
            Swal.fire('ØªÙ… Ø§Ù„Ø­Ø°Ù!', 'ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­.', 'success');
        } else if(password) {
            Swal.fire({ icon: 'error', title: 'Ø®Ø·Ø£', text: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!' });
        }
    }
</script>
</body>
</html>
