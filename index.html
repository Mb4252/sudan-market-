<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø®Ø§Ø±Ù‚ | Ù†Ø¸Ø§Ù… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©</title>
    
    <!-- Ø®Ø·ÙˆØ· Ø¹Ø±Ø¨ÙŠØ© -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- TensorFlow.js Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…Ø­Ù„ÙŠ -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    
    <!-- Tesseract.js Ù„Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† Ø§Ù„ØµÙˆØ± -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.0/dist/tesseract.min.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <style>
        :root {
            --bg-dark: #0a0a1a;
            --bg-darker: #050510;
            --bg-card: #151530;
            --primary: #00f5ff;
            --primary-dark: #00b4d8;
            --accent: #ff006e;
            --accent-light: #ff4da6;
            --neon-blue: #00f5ff;
            --neon-purple: #9d4edd;
            --neon-green: #00ff9d;
            --neon-yellow: #ffd166;
            --text-main: #ffffff;
            --text-secondary: #b8b8d1;
            --text-dim: #8a8aa3;
            --gradient-ai: linear-gradient(135deg, #00f5ff 0%, #9d4edd 50%, #ff006e 100%);
            --gradient-dark: linear-gradient(180deg, #0a0a1a 0%, #050510 100%);
            --gradient-card: linear-gradient(145deg, #151530 0%, #101025 100%);
            --shadow-glow: 0 0 30px rgba(0, 245, 255, 0.3);
            --shadow-heavy: 0 10px 40px rgba(0, 0, 0, 0.5);
            --shadow-accent: 0 0 25px rgba(255, 0, 110, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background: var(--gradient-dark);
            color: var(--text-main);
            min-height: 100vh;
            direction: rtl;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 245, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(157, 78, 221, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 0, 110, 0.05) 0%, transparent 50%);
            z-index: -1;
        }

        .hidden {
            display: none !important;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-content {
            text-align: center;
        }

        .ai-loader {
            width: 80px;
            height: 80px;
            border: 4px solid transparent;
            border-top: 4px solid var(--neon-blue);
            border-right: 4px solid var(--neon-purple);
            border-bottom: 4px solid var(--accent);
            border-left: 4px solid var(--neon-green);
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            margin: 0 auto 30px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }

        .login-container {
            width: 100%;
            max-width: 500px;
            background: var(--gradient-card);
            border-radius: 30px;
            padding: 50px 40px;
            border: 3px solid rgba(0, 245, 255, 0.15);
            box-shadow: var(--shadow-glow), var(--shadow-heavy);
            position: relative;
            z-index: 1;
            backdrop-filter: blur(10px);
        }

        /* Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        #app-screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header {
            background: rgba(10, 10, 25, 0.95);
            backdrop-filter: blur(20px);
            padding: 20px 30px;
            border-bottom: 2px solid rgba(0, 245, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
        .sidebar {
            width: 280px;
            background: var(--gradient-card);
            border-left: 2px solid rgba(0, 245, 255, 0.15);
            padding: 20px;
            overflow-y: auto;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        /* ÙˆØ­Ø¯Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        .module {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            overflow-y: auto;
        }

        .module.active {
            display: block;
        }

        .module-content {
            background: var(--gradient-card);
            border-radius: 25px;
            padding: 30px;
            margin: 50px auto;
            width: 90%;
            max-width: 900px;
            border: 3px solid rgba(0, 245, 255, 0.2);
            box-shadow: var(--shadow-glow);
        }

        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-control {
            width: 100%;
            padding: 15px;
            background: rgba(10, 10, 25, 0.7);
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 245, 255, 0.4);
        }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--gradient-ai);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow);
        }

        .btn-secondary {
            background: rgba(0, 245, 255, 0.1);
            color: var(--neon-blue);
            border: 2px solid var(--neon-blue);
        }

        .btn-secondary:hover {
            background: rgba(0, 245, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª */
        .quiz-card {
            background: var(--gradient-card);
            border-radius: 20px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid rgba(0, 245, 255, 0.2);
            transition: transform 0.3s;
            cursor: pointer;
        }

        .quiz-card:hover {
            transform: translateY(-5px);
            border-color: var(--neon-blue);
            box-shadow: var(--shadow-glow);
        }

        /* Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± */
        .quiz-modal {
            background: var(--gradient-card);
            border-radius: 20px;
            padding: 30px;
            max-width: 700px;
            margin: 50px auto;
            border: 3px solid rgba(0, 245, 255, 0.3);
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -2;
        }

        .particle {
            position: absolute;
            background: var(--neon-blue);
            border-radius: 50%;
            animation: floatParticle 15s infinite linear;
        }

        @keyframes floatParticle {
            0% {
                transform: translateY(100vh) translateX(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„ØªÙ‚Ø¯Ù… */
        .progress-area {
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-ai);
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        /* Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª */
        .skill-tree {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 20px 0;
        }

        .skill-node {
            background: rgba(0, 245, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid rgba(0, 245, 255, 0.3);
            position: relative;
        }

        .skill-node.unlocked {
            border-color: var(--neon-green);
            background: rgba(0, 255, 157, 0.1);
        }

        /* Ø±ØªØ¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
        .user-rank {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(157, 78, 221, 0.1);
            padding: 10px 20px;
            border-radius: 25px;
            border: 2px solid rgba(157, 78, 221, 0.3);
        }

        /* Ø£Ù‚Ø³Ø§Ù… Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        .dashboard-section {
            background: var(--gradient-card);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid rgba(0, 245, 255, 0.15);
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø±ÙƒØ© */
        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .action-btn {
            background: rgba(0, 245, 255, 0.1);
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background: rgba(0, 245, 255, 0.2);
            border-color: var(--neon-blue);
            transform: translateY(-5px);
            box-shadow: var(--shadow-glow);
        }

        /* Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ØªØ¨ÙˆÙŠØ¨ */
        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .tab-btn {
            padding: 12px 24px;
            background: rgba(0, 245, 255, 0.1);
            border: none;
            border-radius: 10px;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: var(--gradient-ai);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù†Øµ */
        .text-area {
            min-height: 200px;
            max-height: 400px;
            resize: vertical;
            font-size: 16px;
            line-height: 1.6;
        }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² */
        .achievement-card {
            background: linear-gradient(135deg, rgba(255,215,102,0.1), rgba(255,215,102,0.05));
            border: 2px solid rgba(255,215,102,0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 10px;
            text-align: center;
            transition: transform 0.3s;
        }

        .achievement-card:hover {
            transform: scale(1.05);
        }

        /* Ø³Ø¤Ø§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± */
        .question-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid rgba(0, 245, 255, 0.1);
        }

        .question-text {
            font-size: 18px;
            margin-bottom: 15px;
            color: white;
        }

        .option-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 12px 15px;
            margin: 8px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s;
        }

        .option-item:hover {
            background: rgba(0, 245, 255, 0.1);
            border-color: var(--neon-blue);
        }

        .option-item.selected {
            background: rgba(0, 245, 255, 0.2);
            border-color: var(--neon-blue);
            box-shadow: 0 0 10px rgba(0, 245, 255, 0.3);
        }

        /* Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© */
        .image-preview-container {
            border: 2px dashed rgba(0, 245, 255, 0.3);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s;
        }

        .image-preview-container:hover {
            border-color: var(--neon-blue);
        }

        .image-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }

        /* Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--gradient-card);
            border-radius: 15px;
            padding: 15px 25px;
            border-left: 5px solid var(--neon-blue);
            box-shadow: var(--shadow-heavy);
            z-index: 3000;
            animation: slideInRight 0.3s ease;
            max-width: 400px;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .module-content {
                width: 95%;
                padding: 20px;
                margin: 20px auto;
            }
            
            .action-grid {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .login-container {
                padding: 30px 20px;
            }
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
        @media (min-width: 1200px) {
            .main-content {
                display: flex;
                gap: 20px;
                max-width: 1400px;
                margin: 0 auto;
            }
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…ØªÙˆÙ‡Ø¬Ø© */
        .glow-text {
            text-shadow: 0 0 10px currentColor;
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 10px currentColor; }
            to { text-shadow: 0 0 20px currentColor; }
        }

        /* ØªØ­Ù…ÙŠÙ„ */
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--neon-blue);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        /* Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
        .result-card {
            background: var(--gradient-card);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            border: 2px solid var(--neon-green);
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--gradient-ai);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            margin: 0 auto;
            box-shadow: 0 0 30px rgba(0, 245, 255, 0.4);
        }
    </style>
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loading-screen">
        <div class="loading-content">
            <div class="ai-loader"></div>
            <div style="color: var(--neon-blue); font-size: 24px; font-weight: 700; margin: 20px 0;">
                Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚
            </div>
            <div class="progress-bar" style="width: 300px; margin: 20px auto;">
                <div class="progress-fill" id="loading-progress" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="login-screen" class="hidden">
        <div class="login-container">
            <div style="text-align: center; margin-bottom: 40px;">
                <i class="fas fa-brain" style="font-size: 80px; background: var(--gradient-ai); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i>
                <h1 style="font-size: 42px; background: var(--gradient-ai); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 20px 0;">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚</h1>
                <p style="color: var(--text-secondary); font-size: 18px;">Ù†Ø¸Ø§Ù… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø°ÙƒÙŠ - Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ±</p>
            </div>
            
            <div class="form-group">
                <input type="email" id="login-email" class="form-control" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            </div>
            
            <div class="form-group">
                <input type="password" id="login-password" class="form-control" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
            
            <button class="btn btn-primary" onclick="login()" style="width: 100%; margin: 20px 0; padding: 15px;">
                <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            </button>
            
            <button class="btn btn-secondary" onclick="showRegister()" style="width: 100%; padding: 15px;">
                <i class="fas fa-user-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
            </button>
            
            <div style="text-align: center; margin-top: 30px; color: var(--text-dim);">
                <p>Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø°ÙƒÙŠØ©</p>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="app-screen" class="hidden">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <header>
            <div class="header-content">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="width: 50px; height: 50px; background: var(--gradient-ai); border-radius: 15px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-brain" style="color: white; font-size: 24px;"></i>
                    </div>
                    <div>
                        <h2 style="background: var(--gradient-ai); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0;">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚</h2>
                        <p style="color: var(--text-secondary); font-size: 12px; margin: 0;">Ù†Ø¸Ø§Ù… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø°ÙƒÙŠ</p>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 20px;">
                    <div style="text-align: right;">
                        <div id="user-name" style="font-weight: bold; color: var(--neon-blue); font-size: 16px;"></div>
                        <div id="user-level" style="color: var(--text-secondary); font-size: 12px;"></div>
                    </div>
                    <div id="user-avatar" style="width: 50px; height: 50px; background: var(--gradient-ai); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px;">
                        <i class="fas fa-user"></i>
                    </div>
                    <button class="btn btn-secondary" onclick="logout()" style="padding: 10px 15px;">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="main-content">
            <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
            <div class="sidebar" id="sidebar">
                <h3 style="color: var(--neon-blue); margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid rgba(0,245,255,0.2);">
                    <i class="fas fa-th-large"></i> Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </h3>
                
                <div class="action-btn" onclick="openModule('dashboard')">
                    <i class="fas fa-home" style="color: var(--neon-blue);"></i>
                    <div>
                        <div style="font-weight: bold; color: white;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
                        <div style="color: var(--text-secondary); font-size: 12px;">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…</div>
                    </div>
                </div>
                
                <div class="action-btn" onclick="openModule('test-generator')">
                    <i class="fas fa-file-alt" style="color: var(--neon-green);"></i>
                    <div>
                        <div style="font-weight: bold; color: white;">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±</div>
                        <div style="color: var(--text-secondary); font-size: 12px;">ØªÙˆÙ„ÙŠØ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø°ÙƒÙŠ Ø¬Ø¯ÙŠØ¯</div>
                    </div>
                </div>
                
                <div class="action-btn" onclick="openModule('test-history')">
                    <i class="fas fa-history" style="color: var(--neon-purple);"></i>
                    <div>
                        <div style="font-weight: bold; color: white;">Ø³Ø¬Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</div>
                        <div style="color: var(--text-secondary); font-size: 12px;">Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</div>
                    </div>
                </div>
                
                <div class="action-btn" onclick="openModule('test-library')">
                    <i class="fas fa-book" style="color: var(--neon-yellow);"></i>
                    <div>
                        <div style="font-weight: bold; color: white;">Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</div>
                        <div style="color: var(--text-secondary); font-size: 12px;">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¬Ø§Ù‡Ø²Ø©</div>
                    </div>
                </div>
                
                <div class="action-btn" onclick="openModule('progress')">
                    <i class="fas fa-chart-line" style="color: var(--neon-blue);"></i>
                    <div>
                        <div style="font-weight: bold; color: white;">Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</div>
                        <div style="color: var(--text-secondary); font-size: 12px;">ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ£Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
                    </div>
                </div>
                
                <div class="action-btn" onclick="openModule('settings')">
                    <i class="fas fa-cog" style="color: var(--text-secondary);"></i>
                    <div>
                        <div style="font-weight: bold; color: white;">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
                        <div style="color: var(--text-secondary); font-size: 12px;">ØªØ®ØµÙŠØµ Ø§Ù„Ù†Ø¸Ø§Ù…</div>
                    </div>
                </div>
                
                <div style="margin-top: 40px;">
                    <h4 style="color: var(--neon-blue); margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid rgba(0,245,255,0.2);">
                        <i class="fas fa-brain"></i> Ø­Ø§Ù„Ø© Ø§Ù„Ø°ÙƒØ§Ø¡
                    </h4>
                    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: var(--text-secondary);">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø°ÙƒØ§Ø¡:</span>
                            <span id="ai-intelligence" style="color: var(--neon-green); font-weight: bold;">IQ: 180</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: var(--text-secondary);">Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø®Ø²Ù†Ø©:</span>
                            <span id="ai-knowledge" style="color: var(--neon-purple); font-weight: bold;">1.2TB</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary);">Ù‚ÙˆØ© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:</span>
                            <span id="ai-power" style="color: var(--neon-blue); font-weight: bold;">âˆ</span>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(0,245,255,0.2);">
                    <div style="text-align: center; color: var(--text-dim); font-size: 12px;">
                        <p>Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚ v2.0</p>
                        <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2024</p>
                    </div>
                </div>
            </div>

            <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
            <div style="flex: 1; padding: 20px; overflow-y: auto; max-height: calc(100vh - 90px);">
                <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                <div id="content-area"></div>
            </div>
        </div>
    </div>

    <!-- ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª -->
    <div class="particles" id="particles"></div>

    <script>
        // =============== [ Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø®Ø§Ø±Ù‚ ] ===============
        
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAI_mUhuPNoO-XC0Q-VNoWft8UWFbAbIGg",
            authDomain: "sudan-market-6b122.firebaseapp.com",
            databaseURL: "https://sudan-market-6b122-default-rtdb.firebaseio.com",
            projectId: "sudan-market-6b122",
            storageBucket: "sudan-market-6b122.firebasestorage.app",
            messagingSenderId: "66729481566",
            appId: "1:66729481566:web:93393f28dc22d32cceebcf"
        };

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        let auth, db, storage, currentUser = null;
        let userData = {};
        let currentTest = null;
        let currentAnswers = [];
        let testSystem = null;

        // =============== [ 1. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ] ===============
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚...');
            
            // ØªÙ‡ÙŠØ¦Ø© Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            simulateLoading();
            
            // ØªÙ‡ÙŠØ¦Ø© Firebase
            await initializeFirebase();
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            initializeUI();
            
            // ÙØ­Øµ Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            checkUserSession();
            
            console.log('âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„!');
        });

        async function simulateLoading() {
            const progressBar = document.getElementById('loading-progress');
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += 10;
                progressBar.style.width = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('loading-screen').classList.add('hidden');
                        checkUserSession();
                    }, 500);
                }
            }, 200);
        }

        async function initializeFirebase() {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                auth = firebase.auth();
                db = firebase.database();
                storage = firebase.storage();
                
                // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        currentUser = user;
                        await loadUserData();
                        showAppScreen();
                    } else {
                        showLoginScreen();
                    }
                });
                
                console.log('âœ… Firebase Ù…Ù‡ÙŠØ£');
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase:', error);
            }
        }

        function initializeUI() {
            // ØªÙ‡ÙŠØ¦Ø© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª
            createParticles();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø­Ø¯Ø§Ø« Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
            setupKeyboardShortcuts();
            
            // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
            testSystem = new TestSystem();
        }

        // =============== [ 2. Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ] ===============
        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                const snapshot = await db.ref(`users/${currentUser.uid}`).once('value');
                userData = snapshot.val() || {};
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯Ø§Ù‹ØŒ Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                if (!userData.createdAt) {
                    userData = {
                        email: currentUser.email,
                        name: currentUser.email.split('@')[0],
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString(),
                        stats: {
                            testsTaken: 0,
                            testsCreated: 0,
                            averageScore: 0,
                            totalXP: 0,
                            level: 1,
                            streak: 1
                        },
                        preferences: {
                            theme: 'dark',
                            language: 'ar',
                            notifications: true
                        },
                        tests: [],
                        achievements: []
                    };
                    
                    await saveUserData();
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„
                userData.lastLogin = new Date().toISOString();
                await saveUserData();
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                updateUserUI();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
            }
        }

        async function saveUserData() {
            if (!currentUser || !userData) return;
            
            try {
                await db.ref(`users/${currentUser.uid}`).set(userData);
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
            }
        }

        function updateUserUI() {
            document.getElementById('user-name').textContent = userData.name || 'Ù…Ø³ØªØ®Ø¯Ù…';
            document.getElementById('user-level').textContent = `Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${userData.stats?.level || 1}`;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª
            if (userData.profileImage) {
                document.getElementById('user-avatar').innerHTML = `<img src="${userData.profileImage}" style="width: 100%; height: 100%; border-radius: 50%;">`;
            }
        }

        async function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                return;
            }
            
            showLoading('Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...');
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showNotification('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚!', 'success');
                
                // Ø­ÙØ¸ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù„Ù„Ø¥Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù„Ø§Ø­Ù‚
                localStorage.setItem('ai_system_email', email);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
                let message = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                
                switch(error.code) {
                    case 'auth/user-not-found':
                        message = 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯';
                        break;
                    case 'auth/wrong-password':
                        message = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                        break;
                    case 'auth/invalid-email':
                        message = 'Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­';
                        break;
                }
                
                showNotification(message, 'error');
            }
            
            hideLoading();
        }

        async function logout() {
            try {
                await auth.signOut();
                showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                showLoginScreen();
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'error');
            }
        }

        function showRegister() {
            Swal.fire({
                title: 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯',
                html: `
                    <input type="text" id="register-name" class="swal2-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" dir="rtl">
                    <input type="email" id="register-email" class="swal2-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" dir="rtl">
                    <input type="password" id="register-password" class="swal2-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" dir="rtl">
                    <input type="password" id="register-confirm" class="swal2-input" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" dir="rtl">
                    <select id="register-role" class="swal2-input" dir="rtl">
                        <option value="student">Ø·Ø§Ù„Ø¨</option>
                        <option value="teacher">Ù…Ø¹Ù„Ù…</option>
                        <option value="researcher">Ø¨Ø§Ø­Ø«</option>
                    </select>
                `,
                confirmButtonText: 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨',
                cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
                showCancelButton: true,
                focusConfirm: false,
                preConfirm: async () => {
                    const name = document.getElementById('register-name').value;
                    const email = document.getElementById('register-email').value;
                    const password = document.getElementById('register-password').value;
                    const confirm = document.getElementById('register-confirm').value;
                    const role = document.getElementById('register-role').value;
                    
                    if (!name || !email || !password || !confirm) {
                        Swal.showValidationMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                        return false;
                    }
                    
                    if (password !== confirm) {
                        Swal.showValidationMessage('ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†');
                        return false;
                    }
                    
                    if (password.length < 6) {
                        Swal.showValidationMessage('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                        return false;
                    }
                    
                    showLoading('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...');
                    
                    try {
                        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                        const user = userCredential.user;
                        
                        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                        await db.ref(`users/${user.uid}`).set({
                            email: email,
                            name: name,
                            role: role,
                            createdAt: new Date().toISOString(),
                            lastLogin: new Date().toISOString(),
                            stats: {
                                testsTaken: 0,
                                testsCreated: 0,
                                averageScore: 0,
                                totalXP: 0,
                                level: 1,
                                streak: 1
                            },
                            preferences: {
                                theme: 'dark',
                                language: 'ar',
                                notifications: true
                            },
                            tests: [],
                            achievements: []
                        });
                        
                        hideLoading();
                        return user;
                        
                    } catch (error) {
                        hideLoading();
                        Swal.showValidationMessage(error.message);
                        return false;
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                }
            });
        }

        // =============== [ 3. Ù†Ø¸Ø§Ù… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ] ===============
        class TestSystem {
            constructor() {
                this.tests = new Map();
                this.questionBank = [];
            }
            
            async generateTestFromText(text, options = {}) {
                try {
                    showLoading('Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Øµ ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©...');
                    
                    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Øµ ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ…
                    const analysis = await this.analyzeText(text);
                    
                    // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„
                    const questions = await this.generateQuestions(analysis, options);
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                    const test = {
                        id: 'test_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                        title: options.title || 'Ø§Ø®ØªØ¨Ø§Ø± Ø°ÙƒÙŠ Ù…ÙˆÙ„Ø¯',
                        description: options.description || 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ',
                        textSource: text.substring(0, 500) + '...',
                        questions: questions,
                        settings: {
                            difficulty: options.difficulty || 'medium',
                            timeLimit: options.timeLimit || 30,
                            passingScore: options.passingScore || 60,
                            questionCount: questions.length,
                            generatedAt: new Date().toISOString()
                        },
                        metadata: {
                            source: 'text',
                            wordCount: text.split(/\s+/).length,
                            language: 'ar'
                        }
                    };
                    
                    // Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¤Ù‚ØªØ§Ù‹
                    this.tests.set(test.id, test);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    await this.updateUserStats(test);
                    
                    hideLoading();
                    return test;
                    
                } catch (error) {
                    hideLoading();
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', error);
                    throw error;
                }
            }
            
            async generateTestFromImage(imageFile, options = {}) {
                try {
                    showLoading('Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©...');
                    
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©
                    const text = await this.extractTextFromImage(imageFile);
                    
                    if (!text || text.length < 50) {
                        throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†Øµ ÙƒØ§ÙÙŠ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©');
                    }
                    
                    hideLoading();
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬
                    return await this.generateTestFromText(text, {
                        ...options,
                        title: 'Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† ØµÙˆØ±Ø©',
                        description: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ù†Øµ Ù…Ø³ØªØ®Ø±Ø¬ Ù…Ù† ØµÙˆØ±Ø©'
                    });
                    
                } catch (error) {
                    hideLoading();
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©:', error);
                    throw error;
                }
            }
            
            async generateTestFromTopic(topic, options = {}) {
                try {
                    showLoading('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...');
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ù†ØµÙŠ Ù…Ù† Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹
                    const text = await this.generateContentFromTopic(topic);
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ÙˆÙ„Ø¯
                    return await this.generateTestFromText(text, {
                        ...options,
                        title: `Ø§Ø®ØªØ¨Ø§Ø± ÙÙŠ: ${topic}`,
                        description: `Ø§Ø®ØªØ¨Ø§Ø± ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø­ÙˆÙ„ Ù…ÙˆØ¶ÙˆØ¹: ${topic}`
                    });
                    
                } catch (error) {
                    hideLoading();
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:', error);
                    throw error;
                }
            }
            
            async analyzeText(text) {
                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ ÙˆØªØ­Ø³ÙŠÙ†Ù‡
                const cleanedText = this.cleanArabicText(text);
                
                // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø¬Ù…Ù„
                const sentences = this.splitIntoSentences(cleanedText);
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©
                const keywords = this.extractKeywords(cleanedText);
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                const topics = this.identifyTopics(cleanedText, keywords);
                
                // ØªØ­Ù„ÙŠÙ„ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©
                const difficulty = this.analyzeDifficulty(cleanedText);
                
                return {
                    text: cleanedText,
                    sentences: sentences,
                    keywords: keywords,
                    topics: topics,
                    difficulty: difficulty,
                    wordCount: cleanedText.split(/\s+/).length,
                    sentenceCount: sentences.length
                };
            }
            
            cleanArabicText(text) {
                let cleaned = text
                    .replace(/[Ø¥Ø£Ø¢Ø§]/g, 'Ø§')
                    .replace(/Ø©/g, 'Ù‡')
                    .replace(/Ù‰/g, 'ÙŠ')
                    .replace(/[Ø¤Ø¦]/g, 'Ø¡')
                    .replace(/[^\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\s\d\.\,\?\!]/g, '')
                    .replace(/\s+/g, ' ')
                    .trim();
                
                return cleaned;
            }
            
            splitIntoSentences(text) {
                return text.split(/[\.\?!Û”ØŸ]+/).filter(s => s.trim().length > 0);
            }
            
            extractKeywords(text) {
                const words = text.split(/\s+/);
                const stopWords = ['ÙÙŠ', 'Ù…Ù†', 'Ø¥Ù„Ù‰', 'Ø¹Ù„Ù‰', 'Ø£Ù†', 'Ø¥Ù†', 'Ù‡Ùˆ', 'Ù‡ÙŠ', 'Ù‡Ù…', 'Ù‡Ø°Ø§', 'Ù‡Ø°Ù‡', 'Ø°Ù„Ùƒ', 'ÙƒØ§Ù†', 'ÙŠÙƒÙˆÙ†'];
                
                const wordFrequency = {};
                words.forEach(word => {
                    if (word.length > 2 && !stopWords.includes(word)) {
                        wordFrequency[word] = (wordFrequency[word] || 0) + 1;
                    }
                });
                
                // ØªØ±ØªÙŠØ¨ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±
                return Object.entries(wordFrequency)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 20)
                    .map(([word]) => word);
            }
            
            identifyTopics(text, keywords) {
                const topics = [];
                
                // Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
                const commonTopics = {
                    'Ø¹Ù„ÙˆÙ…': ['Ø¹Ù„Ù…', 'ØªØ¬Ø±Ø¨Ø©', 'Ø¨Ø­Ø«', 'Ø¯Ø±Ø§Ø³Ø©', 'Ø·Ø¨ÙŠØ¹Ø©'],
                    'Ø±ÙŠØ§Ø¶ÙŠØ§Øª': ['Ø¹Ø¯Ø¯', 'Ù…Ø¹Ø§Ø¯Ù„Ø©', 'Ø­Ø³Ø§Ø¨', 'Ù‡Ù†Ø¯Ø³Ø©', 'Ø¬Ø¨Ø±'],
                    'ØªØ§Ø±ÙŠØ®': ['ØªØ§Ø±ÙŠØ®', 'Ø­Ø¯Ø«', 'Ø­Ø±Ø¨', 'Ø³Ù„Ø§Ù…', 'Ø£Ù…Ø©'],
                    'Ø¬ØºØ±Ø§ÙÙŠØ§': ['Ø¨Ù„Ø¯', 'Ù…Ø¯ÙŠÙ†Ø©', 'Ù†Ù‡Ø±', 'Ø¬Ø¨Ù„', 'Ù…Ù†Ø§Ø®'],
                    'Ø£Ø¯Ø¨': ['Ø´Ø¹Ø±', 'Ø±ÙˆØ§ÙŠØ©', 'Ù‚ØµØ©', 'Ø£Ø¯ÙŠØ¨', 'ÙƒØªØ§Ø¨'],
                    'Ø¯ÙŠÙ†': ['Ø¯ÙŠÙ†', 'Ø¥Ø³Ù„Ø§Ù…', 'Ù…Ø³Ù„Ù…', 'ØµÙ„Ø§Ø©', 'Ù‚Ø±Ø¢Ù†']
                };
                
                Object.entries(commonTopics).forEach(([topic, words]) => {
                    const matches = words.filter(word => text.includes(word));
                    if (matches.length > 0) {
                        topics.push({
                            name: topic,
                            confidence: matches.length / words.length,
                            keywords: matches
                        });
                    }
                });
                
                return topics.slice(0, 3);
            }
            
            analyzeDifficulty(text) {
                const words = text.split(/\s+/);
                const longWords = words.filter(w => w.length > 7).length;
                const ratio = longWords / words.length;
                
                if (ratio > 0.3) return 'hard';
                if (ratio > 0.15) return 'medium';
                return 'easy';
            }
            
            async generateQuestions(analysis, options) {
                const questions = [];
                const count = options.count || 20;
                const difficulty = options.difficulty || 'medium';
                
                // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ØªØ§Ø­Ø©
                const questionTypes = ['multiple_choice', 'true_false', 'short_answer'];
                
                for (let i = 0; i < count; i++) {
                    const type = questionTypes[Math.floor(Math.random() * questionTypes.length)];
                    const question = await this.createQuestion(analysis, type, difficulty, i);
                    questions.push(question);
                }
                
                return questions;
            }
            
            async createQuestion(analysis, type, difficulty, index) {
                switch(type) {
                    case 'multiple_choice':
                        return this.createMCQuestion(analysis, difficulty, index);
                    case 'true_false':
                        return this.createTFQuestion(analysis, difficulty, index);
                    case 'short_answer':
                        return this.createSAQuestion(analysis, difficulty, index);
                    default:
                        return this.createMCQuestion(analysis, difficulty, index);
                }
            }
            
            createMCQuestion(analysis, difficulty, index) {
                // Ø§Ø®ØªÙŠØ§Ø± Ø¬Ù…Ù„Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ù† Ø§Ù„Ù†Øµ
                const sentence = analysis.sentences[Math.floor(Math.random() * analysis.sentences.length)];
                
                // Ø§Ø³ØªØ®Ù„Ø§Øµ ÙƒÙ„Ù…Ø© Ø±Ø¦ÙŠØ³ÙŠØ© Ù…Ù† Ø§Ù„Ø¬Ù…Ù„Ø©
                const words = sentence.split(/\s+/).filter(w => w.length > 3);
                const keyword = words[Math.floor(Math.random() * words.length)] || 'Ù…ÙÙ‡ÙˆÙ…';
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø³Ø¤Ø§Ù„
                const question = {
                    id: 'q_' + Date.now() + '_' + index,
                    type: 'multiple_choice',
                    text: `Ù…Ø§Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ù…ØµØ·Ù„Ø­ "${keyword}" ÙÙŠ Ø§Ù„Ù†ØµØŸ`,
                    options: this.generateOptions(keyword, analysis),
                    correctAnswer: 0,
                    explanation: `Ø§Ù„Ù…ØµØ·Ù„Ø­ "${keyword}" ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ù…ÙÙ‡ÙˆÙ… Ù…Ù‡Ù… ÙÙŠ Ø§Ù„Ù†Øµ.`,
                    difficulty: difficulty,
                    points: difficulty === 'hard' ? 3 : difficulty === 'medium' ? 2 : 1
                };
                
                return question;
            }
            
            createTFQuestion(analysis, difficulty, index) {
                // Ø§Ø®ØªÙŠØ§Ø± Ø¬Ù…Ù„Ø© ÙˆØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ø¥Ù„Ù‰ Ø¹Ø¨Ø§Ø±Ø© Ù‚Ø¯ ØªÙƒÙˆÙ† ØµØ­ÙŠØ­Ø© Ø£Ùˆ Ø®Ø§Ø·Ø¦Ø©
                const sentence = analysis.sentences[Math.floor(Math.random() * analysis.sentences.length)];
                const isTrue = Math.random() > 0.5;
                
                let statement = sentence;
                if (!isTrue) {
                    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ù…Ù„Ø© Ù„Ø¬Ø¹Ù„Ù‡Ø§ Ø®Ø§Ø·Ø¦Ø©
                    statement = this.modifySentenceToFalse(sentence);
                }
                
                const question = {
                    id: 'q_' + Date.now() + '_' + index,
                    type: 'true_false',
                    text: `Ù‡Ù„ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© ØµØ­ÙŠØ­Ø© Ø£Ù… Ø®Ø§Ø·Ø¦Ø©: "${statement}"`,
                    options: ['ØµØ­ÙŠØ­', 'Ø®Ø·Ø£'],
                    correctAnswer: isTrue ? 0 : 1,
                    explanation: isTrue 
                        ? 'Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© ØµØ­ÙŠØ­Ø© ÙƒÙ…Ø§ ÙˆØ±Ø¯Øª ÙÙŠ Ø§Ù„Ù†Øµ.'
                        : 'Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© Ø®Ø§Ø·Ø¦Ø©ØŒ Ø§Ù„Ù†Øµ ÙŠÙ‚ÙˆÙ„ Ø´ÙŠØ¦Ø§Ù‹ Ù…Ø®ØªÙ„ÙØ§Ù‹.',
                    difficulty: difficulty,
                    points: 1
                };
                
                return question;
            }
            
            createSAQuestion(analysis, difficulty, index) {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¤Ø§Ù„ Ø¥Ø¬Ø§Ø¨Ø© Ù‚ØµÙŠØ±Ø©
                const keyword = analysis.keywords[Math.floor(Math.random() * analysis.keywords.length)];
                
                const question = {
                    id: 'q_' + Date.now() + '_' + index,
                    type: 'short_answer',
                    text: `Ø§Ø´Ø±Ø­ Ø¨Ø§Ø®ØªØµØ§Ø± Ù…Ø§ Ø§Ù„Ù…Ù‚ØµÙˆØ¯ Ø¨Ù€ "${keyword}" ÙÙŠ Ø§Ù„Ù†Øµ.`,
                    correctAnswer: `${keyword} Ù‡Ùˆ Ù…ÙÙ‡ÙˆÙ… Ø±Ø¦ÙŠØ³ÙŠ ÙÙŠ Ø§Ù„Ù†Øµ ÙŠØ´Ø±Ø­...`,
                    explanation: `Ø§Ù„Ù…Ù‚ØµÙˆØ¯ Ø¨Ù€ ${keyword} Ù‡Ùˆ...`,
                    difficulty: difficulty,
                    points: difficulty === 'hard' ? 4 : difficulty === 'medium' ? 3 : 2
                };
                
                return question;
            }
            
            generateOptions(keyword, analysis) {
                const options = [];
                
                // Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
                options.push(`ØªØ¹Ø±ÙŠÙ ${keyword} ÙƒÙ…Ø§ ÙˆØ±Ø¯ ÙÙŠ Ø§Ù„Ù†Øµ`);
                
                // Ø¥Ø¬Ø§Ø¨Ø§Øª Ø®Ø§Ø·Ø¦Ø© Ù…Ù‚Ù†Ø¹Ø©
                const distractors = [
                    `Ù…ÙÙ‡ÙˆÙ… Ù…Ø®Ø§Ù„Ù Ù„Ù€ ${keyword}`,
                    `ØªÙØ³ÙŠØ± Ø®Ø§Ø·Ø¦ Ù„Ù€ ${keyword}`,
                    `Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ ${keyword} ÙˆÙ„ÙŠØ³ ØªØ¹Ø±ÙŠÙØ§Ù‹`,
                    `Ù…ØµØ·Ù„Ø­ Ù…Ø´Ø§Ø¨Ù‡ Ù„ÙƒÙ†Ù‡ Ù…Ø®ØªÙ„Ù Ø¹Ù† ${keyword}`
                ];
                
                // Ø¥Ø¶Ø§ÙØ© 3 Ø¥Ø¬Ø§Ø¨Ø§Øª Ø®Ø§Ø·Ø¦Ø©
                for (let i = 0; i < 3; i++) {
                    options.push(distractors[i] || `Ø®ÙŠØ§Ø± ${i + 1}`);
                }
                
                // Ø®Ù„Ø· Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© ÙÙŠ Ø§Ù„ÙÙ‡Ø±Ø³ 0)
                const correct = options[0];
                const wrong = options.slice(1);
                this.shuffleArray(wrong);
                
                return [correct, ...wrong.slice(0, 3)];
            }
            
            modifySentenceToFalse(sentence) {
                // ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ· Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø¬Ù…Ù„Ø© Ø®Ø§Ø·Ø¦Ø©
                const words = sentence.split(/\s+/);
                if (words.length > 3) {
                    const randomIndex = Math.floor(Math.random() * (words.length - 2)) + 1;
                    words[randomIndex] = 'Ù„ÙŠØ³';
                }
                return words.join(' ');
            }
            
            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            async extractTextFromImage(imageFile) {
                try {
                    const worker = await Tesseract.createWorker();
                    await worker.loadLanguage('ara+eng');
                    await worker.initialize('ara+eng');
                    
                    const { data: { text } } = await worker.recognize(imageFile);
                    await worker.terminate();
                    
                    return text;
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ:', error);
                    throw error;
                }
            }
            
            async generateContentFromTopic(topic) {
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ù…Ù† Ù…ÙˆØ¶ÙˆØ¹
                const templates = [
                    `${topic} Ù‡Ùˆ Ù…Ø¬Ø§Ù„ Ù…Ù‡Ù… ÙÙŠ Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¥Ù†Ø³Ø§Ù†ÙŠØ©.`,
                    `ÙŠØ¹ØªØ¨Ø± ${topic} Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„ØªÙŠ ØªØ¯Ø±Ø³ ÙÙŠ Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„ØªØ®ØµØµØ§Øª.`,
                    `ÙŠØªÙ…ÙŠØ² ${topic} Ø¨ØªÙ†ÙˆØ¹ Ù…ÙØ§Ù‡ÙŠÙ…Ù‡ ÙˆØªØ·Ø¨ÙŠÙ‚Ø§ØªÙ‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.`,
                    `Ù…Ù† Ø£Ù‡Ù… Ø¬ÙˆØ§Ù†Ø¨ ${topic} Ù‡Ùˆ...`,
                    `ÙŠÙ…ÙƒÙ† ØªÙ‚Ø³ÙŠÙ… ${topic} Ø¥Ù„Ù‰ Ø¹Ø¯Ø© Ø£Ù‚Ø³Ø§Ù… Ø±Ø¦ÙŠØ³ÙŠØ©.`,
                    `ÙŠØ¬Ø¨ ÙÙ‡Ù… ${topic} Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù„ØªØ·Ø¨ÙŠÙ‚Ù‡ Ø¹Ù…Ù„ÙŠØ§Ù‹.`
                ];
                
                return templates.slice(0, Math.floor(Math.random() * 3) + 3).join(' ');
            }
            
            async updateUserStats(test) {
                if (!userData.stats) userData.stats = {};
                
                userData.stats.testsCreated = (userData.stats.testsCreated || 0) + 1;
                userData.stats.totalXP = (userData.stats.totalXP || 0) + 10;
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                const newLevel = Math.floor(userData.stats.totalXP / 100) + 1;
                if (newLevel > userData.stats.level) {
                    userData.stats.level = newLevel;
                    showNotification(`ğŸ‰ ØªÙ‚Ø¯Ù…Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${newLevel}!`, 'success');
                }
                
                // Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                if (!userData.tests) userData.tests = [];
                userData.tests.push({
                    id: test.id,
                    title: test.title,
                    date: new Date().toISOString(),
                    score: 0,
                    status: 'created'
                });
                
                await saveUserData();
                updateUserUI();
            }
            
            async evaluateTest(testId, answers) {
                const test = this.tests.get(testId);
                if (!test) return null;
                
                let score = 0;
                let correctAnswers = 0;
                const results = [];
                
                test.questions.forEach((question, index) => {
                    const userAnswer = answers[index];
                    let isCorrect = false;
                    
                    switch(question.type) {
                        case 'multiple_choice':
                            isCorrect = userAnswer === question.correctAnswer;
                            break;
                        case 'true_false':
                            isCorrect = userAnswer === question.correctAnswer;
                            break;
                        case 'short_answer':
                            // ØªÙ‚ÙŠÙŠÙ… Ø¨Ø³ÙŠØ· Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù‚ØµÙŠØ±Ø©
                            isCorrect = userAnswer && userAnswer.length > 10;
                            break;
                    }
                    
                    if (isCorrect) {
                        score += question.points;
                        correctAnswers++;
                    }
                    
                    results.push({
                        question: question.text,
                        userAnswer: userAnswer,
                        correctAnswer: question.correctAnswer,
                        isCorrect: isCorrect,
                        explanation: question.explanation
                    });
                });
                
                const percentage = (score / test.questions.reduce((sum, q) => sum + q.points, 0)) * 100;
                
                const evaluation = {
                    testId: testId,
                    score: score,
                    percentage: percentage.toFixed(2),
                    correctAnswers: correctAnswers,
                    totalQuestions: test.questions.length,
                    results: results,
                    date: new Date().toISOString(),
                    passed: percentage >= test.settings.passingScore
                };
                
                // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                await this.updateUserTestStats(evaluation);
                
                return evaluation;
            }
            
            async updateUserTestStats(evaluation) {
                if (!userData.stats) userData.stats = {};
                
                userData.stats.testsTaken = (userData.stats.testsTaken || 0) + 1;
                
                // Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
                const totalTests = userData.stats.testsTaken;
                const currentAverage = userData.stats.averageScore || 0;
                userData.stats.averageScore = ((currentAverage * (totalTests - 1)) + parseFloat(evaluation.percentage)) / totalTests;
                
                userData.stats.totalXP = (userData.stats.totalXP || 0) + Math.floor(evaluation.percentage / 10);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªÙˆÙ‰
                const newLevel = Math.floor(userData.stats.totalXP / 100) + 1;
                if (newLevel > userData.stats.level) {
                    userData.stats.level = newLevel;
                    showNotification(`ğŸ‰ ØªÙ‚Ø¯Ù…Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${newLevel}!`, 'success');
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                const testIndex = userData.tests?.findIndex(t => t.id === evaluation.testId);
                if (testIndex !== -1 && userData.tests) {
                    userData.tests[testIndex].score = evaluation.percentage;
                    userData.tests[testIndex].status = 'completed';
                    userData.tests[testIndex].completedAt = new Date().toISOString();
                }
                
                await saveUserData();
                updateUserUI();
            }
        }

        // =============== [ 4. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ] ===============
        function showLoginScreen() {
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('app-screen').classList.add('hidden');
        }

        function showAppScreen() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app-screen').classList.remove('hidden');
            openModule('dashboard');
        }

        function openModule(moduleName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ­Ø¯Ø§Øª
            document.querySelectorAll('.module').forEach(module => {
                module.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            const module = document.getElementById(`${moduleName}-module`);
            if (module) {
                module.classList.add('active');
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØ­Ø¯Ø©
            loadModuleContent(moduleName);
        }

        function closeModule() {
            document.querySelectorAll('.module').forEach(module => {
                module.classList.remove('active');
            });
            openModule('dashboard');
        }

        async function loadModuleContent(moduleName) {
            const contentArea = document.getElementById('content-area');
            
            switch(moduleName) {
                case 'dashboard':
                    contentArea.innerHTML = await loadDashboardContent();
                    break;
                case 'test-generator':
                    contentArea.innerHTML = await loadTestGeneratorContent();
                    break;
                case 'test-history':
                    contentArea.innerHTML = await loadTestHistoryContent();
                    break;
                case 'test-library':
                    contentArea.innerHTML = await loadTestLibraryContent();
                    break;
                case 'progress':
                    contentArea.innerHTML = await loadProgressContent();
                    break;
                case 'settings':
                    contentArea.innerHTML = await loadSettingsContent();
                    break;
                default:
                    contentArea.innerHTML = await loadDashboardContent();
            }
        }

        async function loadDashboardContent() {
            return `
                <div style="max-width: 1200px; margin: 0 auto;">
                    <h1 style="color: var(--neon-blue); margin-bottom: 30px; font-size: 36px;">
                        <i class="fas fa-home"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                    </h1>
                    
                    <div class="action-grid" style="margin-bottom: 40px;">
                        <div class="action-btn" onclick="openModule('test-generator')">
                            <div style="text-align: center;">
                                <i class="fas fa-plus-circle" style="font-size: 48px; color: var(--neon-green); margin-bottom: 15px;"></i>
                                <h3 style="color: white; margin-bottom: 10px;">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±</h3>
                                <p style="color: var(--text-secondary);">ØªÙˆÙ„ÙŠØ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø°ÙƒÙŠ Ø¬Ø¯ÙŠØ¯</p>
                            </div>
                        </div>
                        
                        <div class="action-btn" onclick="openModule('test-history')">
                            <div style="text-align: center;">
                                <i class="fas fa-history" style="font-size: 48px; color: var(--neon-purple); margin-bottom: 15px;"></i>
                                <h3 style="color: white; margin-bottom: 10px;">Ø³Ø¬Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h3>
                                <p style="color: var(--text-secondary);">Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</p>
                            </div>
                        </div>
                        
                        <div class="action-btn" onclick="openModule('test-library')">
                            <div style="text-align: center;">
                                <i class="fas fa-book" style="font-size: 48px; color: var(--neon-yellow); margin-bottom: 15px;"></i>
                                <h3 style="color: white; margin-bottom: 10px;">Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h3>
                                <p style="color: var(--text-secondary);">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¬Ø§Ù‡Ø²Ø©</p>
                            </div>
                        </div>
                        
                        <div class="action-btn" onclick="openModule('progress')">
                            <div style="text-align: center;">
                                <i class="fas fa-chart-line" style="font-size: 48px; color: var(--neon-blue); margin-bottom: 15px;"></i>
                                <h3 style="color: white; margin-bottom: 10px;">Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</h3>
                                <p style="color: var(--text-secondary);">ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ£Ø­ØµØ§Ø¦ÙŠØ§Øª</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-bottom: 40px;">
                        <div class="dashboard-section">
                            <h3 style="color: var(--neon-blue); margin-bottom: 20px;">
                                <i class="fas fa-bolt"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹
                            </h3>
                            
                            <div style="margin-bottom: 20px;">
                                <input type="text" id="quick-test-text" class="form-control" placeholder="Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹..." style="margin-bottom: 15px;">
                                <button class="btn btn-primary" onclick="quickGenerateTest()" style="width: 100%; padding: 15px;">
                                    <i class="fas fa-magic"></i> ØªÙˆÙ„ÙŠØ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø°ÙƒÙŠ
                                </button>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div>
                                    <label style="color: var(--text-secondary); display: block; margin-bottom: 5px;">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</label>
                                    <input type="number" id="quick-question-count" class="form-control" value="10" min="5" max="30">
                                </div>
                                <div>
                                    <label style="color: var(--text-secondary); display: block; margin-bottom: 5px;">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©</label>
                                    <select id="quick-difficulty" class="form-control">
                                        <option value="easy">Ø³Ù‡Ù„</option>
                                        <option value="medium" selected>Ù…ØªÙˆØ³Ø·</option>
                                        <option value="hard">ØµØ¹Ø¨</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-section">
                            <h3 style="color: var(--neon-green); margin-bottom: 20px;">
                                <i class="fas fa-chart-bar"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙƒ
                            </h3>
                            
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span style="color: var(--text-secondary);">Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</span>
                                    <span style="color: var(--neon-blue); font-weight: bold;">${userData.stats?.level || 1}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span style="color: var(--text-secondary);">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©:</span>
                                    <span style="color: var(--neon-green); font-weight: bold;">${userData.stats?.testsTaken || 0}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span style="color: var(--text-secondary);">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø©:</span>
                                    <span style="color: var(--neon-purple); font-weight: bold;">${userData.stats?.testsCreated || 0}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span style="color: var(--text-secondary);">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</span>
                                    <span style="color: var(--neon-yellow); font-weight: bold;">${(userData.stats?.averageScore || 0).toFixed(1)}%</span>
                                </div>
                            </div>
                            
                            <div style="text-align: center;">
                                <div class="score-circle" style="width: 80px; height: 80px; font-size: 24px;">
                                    ${userData.stats?.level || 1}
                                </div>
                                <div style="color: var(--text-secondary); margin-top: 10px;">Ù…Ø³ØªÙˆØ§Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-section">
                        <h3 style="color: var(--neon-purple); margin-bottom: 20px;">
                            <i class="fas fa-trophy"></i> Ø£Ø­Ø¯Ø« Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª
                        </h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            ${(userData.achievements?.length > 0 ? userData.achievements.slice(0, 4).map(ach => `
                                <div class="achievement-card">
                                    <i class="fas fa-trophy" style="font-size: 32px; color: var(--neon-yellow); margin-bottom: 10px;"></i>
                                    <div style="font-weight: bold; color: white;">${ach.name}</div>
                                    <div style="color: var(--text-secondary); font-size: 12px;">${ach.description}</div>
                                </div>
                            `).join('') : `
                                <div style="text-align: center; padding: 30px; color: var(--text-secondary);">
                                    <i class="fas fa-trophy" style="font-size: 48px; color: var(--text-dim); margin-bottom: 15px;"></i>
                                    <div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø¨Ø¹Ø¯</div>
                                    <div style="font-size: 12px; margin-top: 10px;">Ø£Ù†Ø´Ø¦ ÙˆØ­Ù„ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</div>
                                </div>
                            `)}
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadTestGeneratorContent() {
            return `
                <div style="max-width: 900px; margin: 0 auto;">
                    <h1 style="color: var(--neon-blue); margin-bottom: 30px; font-size: 36px;">
                        <i class="fas fa-magic"></i> Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø°ÙƒÙŠ
                    </h1>
                    
                    <div class="tab-container" style="margin-bottom: 30px;">
                        <button class="tab-btn active" onclick="switchTestTab('text')">Ù…Ù† Ù†Øµ</button>
                        <button class="tab-btn" onclick="switchTestTab('image')">Ù…Ù† ØµÙˆØ±Ø©</button>
                        <button class="tab-btn" onclick="switchTestTab('topic')">Ø¹Ù†ÙˆØ§Ù† Ø±Ø¦ÙŠØ³ÙŠ</button>
                    </div>
                    
                    <div id="tab-content" style="background: var(--gradient-card); border-radius: 20px; padding: 30px; border: 2px solid rgba(0,245,255,0.2);">
                        ${await loadTextTabContent()}
                    </div>
                </div>
            `;
        }

        async function loadTextTabContent() {
            return `
                <div id="text-tab-content">
                    <h3 style="color: var(--neon-blue); margin-bottom: 20px;">
                        <i class="fas fa-font"></i> Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ
                    </h3>
                    
                    <div class="form-group">
                        <textarea id="input-text" class="form-control text-area" placeholder="Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ù‡Ù†Ø§... ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù†Øµ Ø¨Ø£ÙŠ Ø´ÙƒÙ„ (Ù…Ø±Ù‚Ù…ØŒ ÙÙ‚Ø±Ø§ØªØŒ Ø¹Ù†Ø§ÙˆÙŠÙ†ØŒ Ø¥Ù„Ø®). Ø³ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨ØªØ­Ù„ÙŠÙ„Ù‡ ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ù‡Ù… Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ØªÙˆÙ„ÙŠØ¯ Ø£Ø³Ø¦Ù„Ø© Ø°ÙƒÙŠØ©."></textarea>
                        <div style="color: var(--text-dim); font-size: 12px; margin-top: 5px;">
                            Ø§Ù„Ù†Øµ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 100 ÙƒÙ„Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                        <div>
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">
                                <i class="fas fa-question-circle"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
                            </label>
                            <input type="range" id="question-count" class="form-control" min="5" max="30" value="15" style="width: 100%;">
                            <div id="question-count-display" style="color: var(--neon-blue); text-align: center; margin-top: 5px; font-weight: bold;">15 Ø³Ø¤Ø§Ù„</div>
                        </div>
                        
                        <div>
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">
                                <i class="fas fa-brain"></i> Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©
                            </label>
                            <select id="difficulty" class="form-control">
                                <option value="easy">Ø³Ù‡Ù„ (Ù…Ø¨ØªØ¯Ø¦)</option>
                                <option value="medium" selected>Ù…ØªÙˆØ³Ø· (Ù…ØªÙ‚Ø¯Ù…)</option>
                                <option value="hard">ØµØ¹Ø¨ (Ø®Ø¨ÙŠØ±)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 25px;">
                        <label style="color: var(--text-secondary); display: block; margin-bottom: 10px;">
                            <i class="fas fa-check-circle"></i> Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
                        </label>
                        <div style="display: flex; flex-wrap: wrap; gap: 15px;">
                            <label style="color: var(--text-secondary); cursor: pointer;">
                                <input type="checkbox" id="mcq-type" checked style="margin-left: 5px;"> Ø§Ø®ØªÙŠØ§Ø± Ù…ØªØ¹Ø¯Ø¯
                            </label>
                            <label style="color: var(--text-secondary); cursor: pointer;">
                                <input type="checkbox" id="tf-type" checked style="margin-left: 5px;"> ØµØ­ ÙˆØ®Ø·Ø£
                            </label>
                            <label style="color: var(--text-secondary); cursor: pointer;">
                                <input type="checkbox" id="sa-type" style="margin-left: 5px;"> Ø¥Ø¬Ø§Ø¨Ø© Ù‚ØµÙŠØ±Ø©
                            </label>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="generateTestFromText()" style="width: 100%; padding: 18px; font-size: 18px;">
                        <i class="fas fa-bolt"></i> ØªÙˆÙ„ÙŠØ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø°ÙƒÙŠ
                    </button>
                    
                    <div style="margin-top: 30px; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 15px; border: 1px solid rgba(0,245,255,0.1);">
                        <h4 style="color: var(--neon-green); margin-bottom: 10px;">
                            <i class="fas fa-lightbulb"></i> ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠØŸ
                        </h4>
                        <div style="color: var(--text-secondary); line-height: 1.6;">
                            <p>1. ÙŠØ­Ù„Ù„ Ø§Ù„Ù†Øµ ÙˆÙŠØ³ØªØ®Ø±Ø¬ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p>
                            <p>2. ÙŠØ­Ø¯Ø¯ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ø£ÙÙƒØ§Ø±</p>
                            <p>3. ÙŠØ³ØªÙ‡Ø¯Ù Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ Ø§Ù„Ù†Øµ</p>
                            <p>4. ÙŠÙˆÙ„Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù…ØªÙ†ÙˆØ¹Ø© ØªØ¹ÙƒØ³ ÙÙ‡Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰</p>
                            <p>5. ÙŠØ¶Ù…Ù† ØªØºØ·ÙŠØ© Ø´Ø§Ù…Ù„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù†Øµ</p>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadImageTabContent() {
            return `
                <div id="image-tab-content">
                    <h3 style="color: var(--neon-green); margin-bottom: 20px;">
                        <i class="fas fa-image"></i> Ø±ÙØ¹ ØµÙˆØ±Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†Øµ
                    </h3>
                    
                    <div class="image-preview-container" onclick="document.getElementById('image-file-input').click()">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 64px; color: var(--neon-blue); margin-bottom: 15px;"></i>
                        <div style="color: var(--neon-blue); font-size: 18px; margin-bottom: 10px;">Ø§Ù†Ù‚Ø± Ù„Ø±ÙØ¹ ØµÙˆØ±Ø©</div>
                        <div style="color: var(--text-secondary); font-size: 14px;">
                            Ø£Ùˆ Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§
                            <br>
                            ÙŠØ¯Ø¹Ù…: JPG, PNG, GIF
                        </div>
                        <input type="file" id="image-file-input" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                    </div>
                    
                    <div id="image-preview" style="text-align: center; margin: 20px 0; display: none;">
                        <img id="preview-img" style="max-width: 100%; max-height: 300px; border-radius: 10px; border: 2px solid var(--neon-blue);">
                        <div style="margin-top: 10px;">
                            <button class="btn btn-secondary" onclick="clearImage()" style="padding: 8px 15px;">
                                <i class="fas fa-times"></i> Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙˆØ±Ø©
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 25px;">
                        <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">
                            <i class="fas fa-language"></i> Ù„ØºØ© Ø§Ù„Ù†Øµ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©
                        </label>
                        <select id="ocr-language" class="form-control">
                            <option value="ara">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø·</option>
                            <option value="eng">Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙÙ‚Ø·</option>
                            <option value="ara+eng">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
                        </select>
                    </div>
                    
                    <button id="generate-image-btn" class="btn btn-primary" onclick="generateTestFromImage()" style="width: 100%; padding: 18px; font-size: 18px;" disabled>
                        <i class="fas fa-image"></i> Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±
                    </button>
                    
                    <div style="margin-top: 30px; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 15px; border: 1px solid rgba(0,245,255,0.1);">
                        <h4 style="color: var(--neon-green); margin-bottom: 10px;">
                            <i class="fas fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù‡Ø§Ù…Ø©
                        </h4>
                        <div style="color: var(--text-secondary); line-height: 1.6;">
                            <p>â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶ÙˆØ­ Ø§Ù„Ù†Øµ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©</p>
                            <p>â€¢ Ø¥Ø¶Ø§Ø¡Ø© Ø¬Ø§Ø¹Ø¯Ø© ØªØ³Ø§Ø¹Ø¯ ÙÙŠ Ø¯Ù‚Ø© Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬</p>
                            <p>â€¢ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø±Ø£Ø³ÙŠØ© ØªØ¹Ø·ÙŠ Ù†ØªØ§Ø¦Ø¬ Ø£ÙØ¶Ù„</p>
                            <p>â€¢ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</p>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadTopicTabContent() {
            return `
                <div id="topic-tab-content">
                    <h3 style="color: var(--neon-purple); margin-bottom: 20px;">
                        <i class="fas fa-hashtag"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ø¹Ù†ÙˆØ§Ù† Ø±Ø¦ÙŠØ³ÙŠ
                    </h3>
                    
                    <div class="form-group">
                        <input type="text" id="topic-input" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ù…ÙˆØ¶ÙˆØ¹ (Ù…Ø«Ø§Ù„: Ù†Ø¸Ø±ÙŠØ© Ø§Ù„ØªØ·ÙˆØ± ÙÙŠ Ø¹Ù„Ù… Ø§Ù„Ø£Ø­ÙŠØ§Ø¡)">
                    </div>
                    
                    <div class="form-group">
                        <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">
                            ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <textarea id="topic-details" class="form-control" placeholder="ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© Ø£Ùˆ Ù†Ù‚Ø§Ø· Ù…Ø­Ø¯Ø¯Ø© ØªØ±ÙŠØ¯ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„ÙŠÙ‡Ø§..." rows="4"></textarea>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                        <div>
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">
                                Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙØµÙŠÙ„
                            </label>
                            <select id="topic-depth" class="form-control">
                                <option value="basic">Ø£Ø³Ø§Ø³ÙŠ</option>
                                <option value="intermediate" selected>Ù…ØªÙˆØ³Ø·</option>
                                <option value="advanced">Ù…ØªÙ‚Ø¯Ù…</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">
                                Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
                            </label>
                            <input type="number" id="topic-question-count" class="form-control" value="15" min="5" max="30">
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="generateTestFromTopic()" style="width: 100%; padding: 18px; font-size: 18px;">
                        <i class="fas fa-brain"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ø®ØªØ¨Ø§Ø±
                    </button>
                    
                    <div style="margin-top: 30px; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 15px; border: 1px solid rgba(0,245,255,0.1);">
                        <h4 style="color: var(--neon-green); margin-bottom: 10px;">
                            <i class="fas fa-magic"></i> ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ
                        </h4>
                        <div style="color: var(--text-secondary); line-height: 1.6;">
                            <p>1. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ ØªØ¹Ù„ÙŠÙ…ÙŠ Ù…Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</p>
                            <p>2. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p>
                            <p>3. ØªÙˆÙ„ÙŠØ¯ Ø£Ø³Ø¦Ù„Ø© ØªØºØ·ÙŠ Ø¬Ù…ÙŠØ¹ Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</p>
                            <p>4. Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆØ§Ø²Ù† Ø¨ÙŠÙ† Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</p>
                            <p>5. Ù…Ø±Ø§Ø¹Ø§Ø© Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙØµÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function switchTestTab(tabName) {
            // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            const tabContent = document.getElementById('tab-content');
            
            switch(tabName) {
                case 'text':
                    loadTextTabContent().then(content => tabContent.innerHTML = content);
                    break;
                case 'image':
                    loadImageTabContent().then(content => tabContent.innerHTML = content);
                    break;
                case 'topic':
                    loadTopicTabContent().then(content => tabContent.innerHTML = content);
                    break;
            }
        }

        async function generateTestFromText() {
            const text = document.getElementById('input-text')?.value;
            const questionCount = parseInt(document.getElementById('question-count')?.value || 15);
            const difficulty = document.getElementById('difficulty')?.value;
            
            if (!text || text.length < 100) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ ÙŠØªÙƒÙˆÙ† Ù…Ù† 100 Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                return;
            }
            
            try {
                const test = await testSystem.generateTestFromText(text, {
                    count: questionCount,
                    difficulty: difficulty,
                    title: 'Ø§Ø®ØªØ¨Ø§Ø± Ø°ÙƒÙŠ Ù…ÙˆÙ„Ø¯',
                    description: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…Ù† Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ø®Ù„'
                });
                
                currentTest = test;
                currentAnswers = new Array(test.questions.length).fill(null);
                
                displayTest(test);
                showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'error');
            }
        }

        async function generateTestFromImage() {
            const fileInput = document.getElementById('image-file-input');
            if (!fileInput?.files[0]) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            const language = document.getElementById('ocr-language')?.value;
            
            try {
                const test = await testSystem.generateTestFromImage(fileInput.files[0], {
                    count: 15,
                    difficulty: 'medium',
                    title: 'Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† ØµÙˆØ±Ø©',
                    description: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ù†Øµ Ù…Ø³ØªØ®Ø±Ø¬ Ù…Ù† ØµÙˆØ±Ø©'
                });
                
                currentTest = test;
                currentAnswers = new Array(test.questions.length).fill(null);
                
                displayTest(test);
                showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©', 'error');
            }
        }

        async function generateTestFromTopic() {
            const topic = document.getElementById('topic-input')?.value;
            const details = document.getElementById('topic-details')?.value;
            const depth = document.getElementById('topic-depth')?.value;
            const questionCount = parseInt(document.getElementById('topic-question-count')?.value || 15);
            
            if (!topic) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹', 'error');
                return;
            }
            
            try {
                const test = await testSystem.generateTestFromTopic(topic, {
                    count: questionCount,
                    difficulty: depth === 'advanced' ? 'hard' : depth === 'basic' ? 'easy' : 'medium',
                    title: `Ø§Ø®ØªØ¨Ø§Ø± ÙÙŠ: ${topic}`,
                    description: details || `Ø§Ø®ØªØ¨Ø§Ø± ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø­ÙˆÙ„ Ù…ÙˆØ¶ÙˆØ¹: ${topic}`
                });
                
                currentTest = test;
                currentAnswers = new Array(test.questions.length).fill(null);
                
                displayTest(test);
                showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'error');
            }
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const previewDiv = document.getElementById('image-preview');
                const previewImg = document.getElementById('preview-img');
                const generateBtn = document.getElementById('generate-image-btn');
                
                previewImg.src = e.target.result;
                previewDiv.style.display = 'block';
                generateBtn.disabled = false;
                
                // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¸Ù‡ÙˆØ±
                previewDiv.style.animation = 'slideInRight 0.3s ease';
            };
            reader.readAsDataURL(file);
        }

        function clearImage() {
            const fileInput = document.getElementById('image-file-input');
            const previewDiv = document.getElementById('image-preview');
            const generateBtn = document.getElementById('generate-image-btn');
            
            fileInput.value = '';
            previewDiv.style.display = 'none';
            generateBtn.disabled = true;
        }

        function displayTest(test) {
            const content = `
                <div style="max-width: 900px; margin: 0 auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h1 style="color: var(--neon-blue); margin: 0; font-size: 32px;">
                            <i class="fas fa-file-alt"></i> ${test.title}
                        </h1>
                        <button class="btn btn-secondary" onclick="openModule('test-generator')">
                            <i class="fas fa-arrow-right"></i> Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯
                        </button>
                    </div>
                    
                    <div style="background: var(--gradient-card); border-radius: 20px; padding: 25px; margin-bottom: 30px; border: 2px solid rgba(0,245,255,0.2);">
                        <h3 style="color: var(--neon-blue); margin-bottom: 20px;">
                            <i class="fas fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                        </h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div>
                                <div style="color: var(--text-secondary); font-size: 14px;">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</div>
                                <div style="color: white; font-size: 28px; font-weight: bold;">${test.questions.length}</div>
                            </div>
                            
                            <div>
                                <div style="color: var(--text-secondary); font-size: 14px;">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©</div>
                                <div style="color: var(--neon-green); font-size: 28px; font-weight: bold;">
                                    ${test.settings.difficulty === 'easy' ? 'Ø³Ù‡Ù„' : 
                                      test.settings.difficulty === 'medium' ? 'Ù…ØªÙˆØ³Ø·' : 'ØµØ¹Ø¨'}
                                </div>
                            </div>
                            
                            <div>
                                <div style="color: var(--text-secondary); font-size: 14px;">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø¯Ø±</div>
                                <div style="color: var(--neon-purple); font-size: 28px; font-weight: bold;">${test.settings.timeLimit} Ø¯Ù‚ÙŠÙ‚Ø©</div>
                            </div>
                            
                            <div>
                                <div style="color: var(--text-secondary); font-size: 14px;">Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ø¬Ø§Ø­</div>
                                <div style="color: var(--neon-yellow); font-size: 28px; font-weight: bold;">${test.settings.passingScore}%</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(0,245,255,0.1);">
                            <div style="color: var(--text-secondary); margin-bottom: 10px;">ÙˆØµÙ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</div>
                            <div style="color: white;">${test.description}</div>
                        </div>
                    </div>
                    
                    <div id="questions-container" style="margin-bottom: 30px;"></div>
                    
                    <div style="background: var(--gradient-card); border-radius: 20px; padding: 25px; border: 2px solid rgba(0,245,255,0.2);">
                        <h3 style="color: var(--neon-blue); margin-bottom: 20px;">
                            <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
                        </h3>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="color: var(--text-secondary);">
                                <span id="answered-count">0</span> / ${test.questions.length} Ø£Ø³Ø¦Ù„Ø© ØªÙ…Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„ÙŠÙ‡Ø§
                            </div>
                            <button class="btn btn-primary" onclick="submitTest()" style="padding: 15px 30px; font-size: 18px;">
                                <i class="fas fa-check-circle"></i> Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
            displayQuestions(test.questions);
            updateAnswerCount();
        }

        function displayQuestions(questions) {
            const container = document.getElementById('questions-container');
            let html = '<h3 style="color: var(--neon-blue); margin-bottom: 25px;"><i class="fas fa-question-circle"></i> Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>';
            
            questions.forEach((question, index) => {
                html += `
                    <div class="question-item" id="question-${index}">
                        <div class="question-text">
                            <span style="color: var(--neon-blue); font-weight: bold;">Ø§Ù„Ø³Ø¤Ø§Ù„ ${index + 1}:</span>
                            ${question.text}
                            <span style="color: var(--text-dim); font-size: 14px; display: block; margin-top: 5px;">
                                (${question.points} Ù†Ù‚Ø·Ø©)
                            </span>
                        </div>
                        
                        ${question.type === 'multiple_choice' ? `
                            <div class="options-container">
                                ${question.options.map((option, optIndex) => `
                                    <div class="option-item" onclick="selectAnswer(${index}, ${optIndex})" id="option-${index}-${optIndex}">
                                        ${String.fromCharCode(1633 + optIndex)}) ${option}
                                    </div>
                                `).join('')}
                            </div>
                        ` : question.type === 'true_false' ? `
                            <div style="display: flex; gap: 15px; margin-top: 15px;">
                                <button class="btn ${currentAnswers[index] === 0 ? 'btn-primary' : 'btn-secondary'}" onclick="selectAnswer(${index}, 0)" style="flex: 1;">
                                    ØµØ­ÙŠØ­
                                </button>
                                <button class="btn ${currentAnswers[index] === 1 ? 'btn-primary' : 'btn-secondary'}" onclick="selectAnswer(${index}, 1)" style="flex: 1;">
                                    Ø®Ø·Ø£
                                </button>
                            </div>
                        ` : `
                            <div style="margin-top: 15px;">
                                <textarea id="answer-${index}" class="form-control" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§..." rows="3" oninput="selectAnswer(${index}, this.value)"></textarea>
                            </div>
                        `}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function selectAnswer(questionIndex, answer) {
            currentAnswers[questionIndex] = answer;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯
            const question = currentTest.questions[questionIndex];
            if (question.type === 'multiple_choice') {
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
                for (let i = 0; i < question.options.length; i++) {
                    const optionElement = document.getElementById(`option-${questionIndex}-${i}`);
                    if (optionElement) {
                        optionElement.classList.remove('selected');
                    }
                }
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù„Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ù…Ø®ØªØ§Ø±
                const selectedOption = document.getElementById(`option-${questionIndex}-${answer}`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                }
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø¬Ø§Ø¨Ø©
            updateAnswerCount();
        }

        function updateAnswerCount() {
            const answered = currentAnswers.filter(answer => answer !== null && answer !== '').length;
            const total = currentTest.questions.length;
            document.getElementById('answered-count').textContent = answered;
            
            // ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø¨Ø©
            const countElement = document.getElementById('answered-count');
            const percentage = (answered / total) * 100;
            
            if (percentage >= 80) {
                countElement.style.color = 'var(--neon-green)';
            } else if (percentage >= 50) {
                countElement.style.color = 'var(--neon-yellow)';
            } else {
                countElement.style.color = 'var(--neon-red)';
            }
        }

        async function submitTest() {
            const answered = currentAnswers.filter(answer => answer !== null && answer !== '').length;
            const total = currentTest.questions.length;
            
            if (answered < total) {
                const confirm = await Swal.fire({
                    title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
                    text: `Ù„Ø¯ÙŠÙƒ ${total - answered} Ø£Ø³Ø¦Ù„Ø© Ù„Ù… ØªØ¬Ø¨ Ø¹Ù„ÙŠÙ‡Ø§. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±',
                    cancelButtonText: 'Ù„Ø§ØŒ Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©',
                    reverseButtons: true
                });
                
                if (!confirm.isConfirmed) {
                    return;
                }
            }
            
            showLoading('Ø¬Ø§Ø±ÙŠ ØªØµØ­ÙŠØ­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...');
            
            try {
                const evaluation = await testSystem.evaluateTest(currentTest.id, currentAnswers);
                
                hideLoading();
                displayResults(evaluation);
                
            } catch (error) {
                hideLoading();
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØµØ­ÙŠØ­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØµØ­ÙŠØ­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'error');
            }
        }

        function displayResults(evaluation) {
            const content = `
                <div style="max-width: 800px; margin: 0 auto;">
                    <h1 style="color: var(--neon-blue); margin-bottom: 30px; font-size: 36px; text-align: center;">
                        <i class="fas fa-trophy"></i> Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                    </h1>
                    
                    <div class="result-card" style="text-align: center; padding: 40px;">
                        <div class="score-circle" style="margin: 0 auto 30px;">
                            ${evaluation.percentage}%
                        </div>
                        
                        <h2 style="color: ${evaluation.passed ? 'var(--neon-green)' : 'var(--accent)'}; margin-bottom: 20px;">
                            ${evaluation.passed ? 'ğŸ‰ Ù†Ø§Ø¬Ø­' : 'âŒ ØºÙŠØ± Ù†Ø§Ø¬Ø­'}
                        </h2>
                        
                        <div style="font-size: 20px; color: white; margin-bottom: 25px;">
                            ${evaluation.correctAnswers} Ù…Ù† ${evaluation.totalQuestions} Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-bottom: 30px;">
                            <div>
                                <div style="color: var(--text-secondary);">Ø§Ù„Ø¯Ø±Ø¬Ø©</div>
                                <div style="color: var(--neon-blue); font-size: 24px; font-weight: bold;">${evaluation.score}</div>
                            </div>
                            
                            <div>
                                <div style="color: var(--text-secondary);">Ø§Ù„Ù†Ø³Ø¨Ø©</div>
                                <div style="color: var(--neon-green); font-size: 24px; font-weight: bold;">${evaluation.percentage}%</div>
                            </div>
                            
                            <div>
                                <div style="color: var(--text-secondary);">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©</div>
                                <div style="color: var(--neon-purple); font-size: 24px; font-weight: bold;">${evaluation.correctAnswers}</div>
                            </div>
                            
                            <div>
                                <div style="color: var(--text-secondary);">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­</div>
                                <div style="color: var(--neon-yellow); font-size: 24px; font-weight: bold;">${currentTest.settings.passingScore}%</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <button class="btn btn-primary" onclick="openModule('dashboard')" style="margin-right: 15px; padding: 12px 25px;">
                                <i class="fas fa-home"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                            </button>
                            <button class="btn btn-secondary" onclick="reviewTest()" style="padding: 12px 25px;">
                                <i class="fas fa-eye"></i> Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 40px;">
                        <h3 style="color: var(--neon-blue); margin-bottom: 20px;">
                            <i class="fas fa-chart-line"></i> ØªØ­Ù„ÙŠÙ„ Ø£Ø¯Ø§Ø¦Ùƒ
                        </h3>
                        
                        <div style="background: var(--gradient-card); border-radius: 15px; padding: 20px;">
                            <div style="margin-bottom: 15px;">
                                <div style="color: var(--text-secondary);">Ù…Ø³ØªÙˆØ§Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ:</div>
                                <div style="color: white; font-size: 20px; font-weight: bold;">${userData.stats?.level || 1}</div>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <div style="color: var(--text-secondary);">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·:</div>
                                <div style="color: var(--neon-green); font-size: 20px; font-weight: bold;">${userData.stats?.totalXP || 0}</div>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <div style="color: var(--text-secondary);">Ù…ØªÙˆØ³Ø· Ù†ØªØ§Ø¦Ø¬Ùƒ:</div>
                                <div style="color: var(--neon-purple); font-size: 20px; font-weight: bold;">${(userData.stats?.averageScore || 0).toFixed(1)}%</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
        }

        function reviewTest() {
            // Ø¹Ø±Ø¶ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…ÙØµÙ„Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
            let reviewContent = `
                <div style="max-width: 900px; margin: 0 auto;">
                    <h1 style="color: var(--neon-blue); margin-bottom: 30px;">
                        <i class="fas fa-search"></i> Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
                    </h1>
            `;
            
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù‡Ù†Ø§
            reviewContent += `
                    <div style="text-align: center; margin-top: 50px;">
                        <button class="btn btn-primary" onclick="openModule('dashboard')">
                            <i class="fas fa-home"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = reviewContent;
        }

        async function loadTestHistoryContent() {
            const tests = userData.tests || [];
            
            return `
                <div style="max-width: 1000px; margin: 0 auto;">
                    <h1 style="color: var(--neon-blue); margin-bottom: 30px; font-size: 36px;">
                        <i class="fas fa-history"></i> Ø³Ø¬Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
                    </h1>
                    
                    <div style="background: var(--gradient-card); border-radius: 20px; padding: 30px; margin-bottom: 30px; border: 2px solid rgba(0,245,255,0.2);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="color: var(--neon-blue); margin: 0;">
                                <i class="fas fa-list"></i> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
                            </h3>
                            <div style="color: var(--text-secondary);">
                                ${tests.length} Ø§Ø®ØªØ¨Ø§Ø±
                            </div>
                        </div>
                        
                        ${tests.length > 0 ? `
                            <div style="max-height: 500px; overflow-y: auto;">
                                ${tests.map((test, index) => `
                                    <div class="quiz-card" onclick="viewTest('${test.id}')">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                            <div style="font-weight: bold; color: white; font-size: 18px;">${test.title || 'Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</div>
                                            <div style="color: ${test.status === 'completed' ? 'var(--neon-green)' : 'var(--neon-yellow)'};">
                                                ${test.status === 'completed' ? 'Ù…ÙƒØªÙ…Ù„' : 'Ù…Ø¨Ø¯Ø¦ÙŠ'}
                                            </div>
                                        </div>
                                        
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div style="color: var(--text-secondary);">
                                                ${new Date(test.date).toLocaleDateString('ar-SA')}
                                            </div>
                                            
                                            ${test.score ? `
                                                <div style="background: var(--gradient-ai); padding: 5px 15px; border-radius: 20px; color: white; font-weight: bold;">
                                                    ${test.score}%
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `).reverse().join('')}
                            </div>
                        ` : `
                            <div style="text-align: center; padding: 50px; color: var(--text-secondary);">
                                <i class="fas fa-history" style="font-size: 64px; margin-bottom: 20px; color: var(--text-dim);"></i>
                                <h3 style="color: var(--text-secondary); margin-bottom: 15px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø³Ø§Ø¨Ù‚Ø©</h3>
                                <p>Ø£Ù†Ø´Ø¦ Ø§Ø®ØªØ¨Ø§Ø±Ùƒ Ø§Ù„Ø£ÙˆÙ„ Ù„ÙŠØ±Ø¯ Ù‡Ù†Ø§ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„</p>
                                <button class="btn btn-primary" onclick="openModule('test-generator')" style="margin-top: 20px;">
                                    <i class="fas fa-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯
                                </button>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        async function loadTestLibraryContent() {
            // Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©
            const sampleTests = [
                {
                    id: 'sample1',
                    title: 'Ø§Ø®ØªØ¨Ø§Ø± ÙÙŠ Ø§Ù„Ø«Ù‚Ø§ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø©',
                    description: 'Ø£Ø³Ø¦Ù„Ø© Ù…ØªÙ†ÙˆØ¹Ø© ÙÙŠ Ø§Ù„Ø«Ù‚Ø§ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø©',
                    difficulty: 'medium',
                    questions: 20,
                    time: 30
                },
                {
                    id: 'sample2',
                    title: 'Ø§Ø®ØªØ¨Ø§Ø± ÙÙŠ Ø§Ù„Ø¹Ù„ÙˆÙ…',
                    description: 'Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ ÙˆØ§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ ÙˆØ§Ù„Ø£Ø­ÙŠØ§Ø¡',
                    difficulty: 'hard',
                    questions: 25,
                    time: 40
                },
                {
                    id: 'sample3',
                    title: 'Ø§Ø®ØªØ¨Ø§Ø± ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ®',
                    description: 'Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ù„Ø¹Ø§Ù„Ù…ÙŠ',
                    difficulty: 'medium',
                    questions: 15,
                    time: 25
                },
                {
                    id: 'sample4',
                    title: 'Ø§Ø®ØªØ¨Ø§Ø± ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª',
                    description: 'Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©',
                    difficulty: 'easy',
                    questions: 15,
                    time: 20
                }
            ];
            
            return `
                <div style="max-width: 1000px; margin: 0 auto;">
                    <h1 style="color: var(--neon-blue); margin-bottom: 30px; font-size: 36px;">
                        <i class="fas fa-book"></i> Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
                    </h1>
                    
                    <div style="background: var(--gradient-card); border-radius: 20px; padding: 30px; margin-bottom: 30px; border: 2px solid rgba(0,245,255,0.2);">
                        <h3 style="color: var(--neon-blue); margin-bottom: 25px;">
                            <i class="fas fa-star"></i> Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¬Ø§Ù‡Ø²Ø©
                        </h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            ${sampleTests.map(test => `
                                <div class="quiz-card" onclick="startSampleTest('${test.id}')">
                                    <div style="font-weight: bold; color: white; font-size: 18px; margin-bottom: 10px;">${test.title}</div>
                                    <div style="color: var(--text-secondary); margin-bottom: 15px; font-size: 14px;">${test.description}</div>
                                    
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <div style="color: var(--text-dim); font-size: 12px;">Ø§Ù„ØµØ¹ÙˆØ¨Ø©</div>
                                            <div style="color: ${test.difficulty === 'easy' ? 'var(--neon-green)' : 
                                                          test.difficulty === 'medium' ? 'var(--neon-yellow)' : 
                                                          'var(--accent)'}; font-weight: bold;">
                                                ${test.difficulty === 'easy' ? 'Ø³Ù‡Ù„' : 
                                                  test.difficulty === 'medium' ? 'Ù…ØªÙˆØ³Ø·' : 'ØµØ¹Ø¨'}
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <div style="color: var(--text-dim); font-size: 12px;">Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</div>
                                            <div style="color: var(--neon-blue); font-weight: bold;">${test.questions}</div>
                                        </div>
                                        
                                        <div>
                                            <div style="color: var(--text-dim); font-size: 12px;">Ø§Ù„ÙˆÙ‚Øª</div>
                                            <div style="color: var(--neon-purple); font-weight: bold;">${test.time} Ø¯</div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="background: var(--gradient-card); border-radius: 20px; padding: 30px; border: 2px solid rgba(0,245,255,0.2);">
                        <h3 style="color: var(--neon-green); margin-bottom: 20px;">
                            <i class="fas fa-lightbulb"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ø®ØµØµØ©
                        </h3>
                        <div style="color: var(--text-secondary); margin-bottom: 25px;">
                            Ø§Ø³ØªØ®Ø¯Ù… Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ø®ØµØµØ© ØªÙ†Ø§Ø³Ø¨ Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙƒ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©.
                        </div>
                        <button class="btn btn-primary" onclick="openModule('test-generator')" style="padding: 15px 30px;">
                            <i class="fas fa-magic"></i> Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
                        </button>
                    </div>
                </div>
            `;
        }

        async function loadProgressContent() {
            const stats = userData.stats || {};
            
            return `
                <div style="max-width: 1000px; margin: 0 auto;">
                    <h1 style="color: var(--neon-blue); margin-bottom: 30px; font-size: 36px;">
                        <i class="fas fa-chart-line"></i> Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ
                    </h1>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 40px;">
                        <div class="dashboard-section">
                            <h3 style="color: var(--neon-blue); margin-bottom: 20px;">
                                <i class="fas fa-trophy"></i> Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙ‚Ø¯Ù…
                            </h3>
                            <div style="text-align: center;">
                                <div class="score-circle" style="margin: 0 auto 20px;">
                                    ${stats.level || 1}
                                </div>
                                <div style="color: white; font-size: 20px; font-weight: bold; margin-bottom: 10px;">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${stats.level || 1}</div>
                                <div style="color: var(--text-secondary);">${stats.totalXP || 0} Ù†Ù‚Ø·Ø©</div>
                            </div>
                        </div>
                        
                        <div class="dashboard-section">
                            <h3 style="color: var(--neon-green); margin-bottom: 20px;">
                                <i class="fas fa-chart-bar"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                            </h3>
                            <div style="margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span style="color: var(--text-secondary);">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©:</span>
                                    <span style="color: var(--neon-green); font-weight: bold;">${stats.testsTaken || 0}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span style="color: var(--text-secondary);">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø©:</span>
                                    <span style="color: var(--neon-blue); font-weight: bold;">${stats.testsCreated || 0}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span style="color: var(--text-secondary);">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</span>
                                    <span style="color: var(--neon-purple); font-weight: bold;">${(stats.averageScore || 0).toFixed(1)}%</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: var(--text-secondary);">Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©:</span>
                                    <span style="color: var(--neon-yellow); font-weight: bold;">${(stats.bestScore || 0).toFixed(1)}%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-section" style="margin-bottom: 30px;">
                        <h3 style="color: var(--neon-purple); margin-bottom: 20px;">
                            <i class="fas fa-award"></i> Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª
                        </h3>
                        
                        ${(userData.achievements?.length > 0 ? `
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                ${userData.achievements.map(ach => `
                                    <div class="achievement-card">
                                        <div style="font-size: 32px; margin-bottom: 10px;">${ach.icon || 'ğŸ†'}</div>
                                        <div style="font-weight: bold; color: white;">${ach.name}</div>
                                        <div style="color: var(--text-secondary); font-size: 12px;">${ach.description}</div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                <i class="fas fa-trophy" style="font-size: 64px; color: var(--text-dim); margin-bottom: 20px;"></i>
                                <div style="font-size: 18px; margin-bottom: 10px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø¨Ø¹Ø¯</div>
                                <div style="font-size: 14px;">Ø£Ù†Ø´Ø¦ ÙˆØ­Ù„ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</div>
                            </div>
                        `)}
                    </div>
                    
                    <div class="dashboard-section">
                        <h3 style="color: var(--neon-blue); margin-bottom: 20px;">
                            <i class="fas fa-bullseye"></i> Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©
                        </h3>
                        <div style="color: var(--text-secondary); line-height: 1.8;">
                            <p>âœ“ Ø¥Ù†Ø´Ø§Ø¡ 5 Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø°ÙƒÙŠØ©</p>
                            <p>âœ“ Ø­Ù„ 10 Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¨Ù†Ø³Ø¨Ø© Ù†Ø¬Ø§Ø­ 80% ÙØ£ÙƒØ«Ø±</p>
                            <p>âœ“ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 5</p>
                            <p>âœ“ Ø§ÙƒØªØ³Ø§Ø¨ 500 Ù†Ù‚Ø·Ø© Ø®Ø¨Ø±Ø©</p>
                            <p>âœ“ ÙØªØ­ 3 Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</p>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadSettingsContent() {
            return `
                <div style="max-width: 800px; margin: 0 auto;">
                    <h1 style="color: var(--neon-blue); margin-bottom: 30px; font-size: 36px;">
                        <i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    </h1>
                    
                    <div class="dashboard-section" style="margin-bottom: 30px;">
                        <h3 style="color: var(--neon-blue); margin-bottom: 25px;">
                            <i class="fas fa-user"></i> Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                        </h3>
                        
                        <div class="form-group">
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Ø§Ù„Ø§Ø³Ù…</label>
                            <input type="text" id="profile-name" class="form-control" value="${userData.name || ''}">
                        </div>
                        
                        <div class="form-group">
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                            <input type="email" class="form-control" value="${userData.email || ''}" disabled>
                        </div>
                        
                        <button class="btn btn-primary" onclick="updateProfile()" style="width: 100%; padding: 15px; margin-top: 10px;">
                            <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                        </button>
                    </div>
                    
                    <div class="dashboard-section" style="margin-bottom: 30px;">
                        <h3 style="color: var(--neon-green); margin-bottom: 25px;">
                            <i class="fas fa-palette"></i> Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª
                        </h3>
                        
                        <div class="form-group">
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Ø§Ù„Ù„ØºØ©</label>
                            <select id="pref-language" class="form-control">
                                <option value="ar" selected>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                <option value="en">Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Ø§Ù„ÙˆØ¶Ø¹</label>
                            <select id="pref-theme" class="form-control">
                                <option value="dark" selected>Ø¯Ø§ÙƒÙ†</option>
                                <option value="light">ÙØ§ØªØ­</option>
                            </select>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <label style="color: var(--text-secondary); cursor: pointer; display: flex; align-items: center;">
                                <input type="checkbox" id="pref-notifications" ${userData.preferences?.notifications ? 'checked' : ''} style="margin-left: 10px;">
                                ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                            </label>
                        </div>
                        
                        <button class="btn btn-secondary" onclick="updatePreferences()" style="width: 100%; padding: 15px; margin-top: 20px;">
                            <i class="fas fa-check"></i> ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª
                        </button>
                    </div>
                    
                    <div class="dashboard-section">
                        <h3 style="color: var(--accent); margin-bottom: 25px;">
                            <i class="fas fa-shield-alt"></i> Ø§Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ§Ù„Ø£Ù…Ø§Ù†
                        </h3>
                        
                        <div style="color: var(--text-secondary); margin-bottom: 20px;">
                            <p>ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø£Ùˆ Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ Ù…Ù† Ù‡Ù†Ø§.</p>
                        </div>
                        
                        <button class="btn btn-secondary" onclick="changePassword()" style="width: 100%; padding: 15px; margin-bottom: 15px;">
                            <i class="fas fa-key"></i> ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                        </button>
                        
                        <button class="btn" onclick="deleteAccount()" style="width: 100%; padding: 15px; background: rgba(255,0,110,0.1); color: var(--accent); border: 2px solid var(--accent);">
                            <i class="fas fa-trash"></i> Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨
                        </button>
                    </div>
                </div>
            `;
        }

        async function updateProfile() {
            const name = document.getElementById('profile-name').value;
            
            if (!name) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…', 'error');
                return;
            }
            
            userData.name = name;
            await saveUserData();
            
            updateUserUI();
            showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        async function updatePreferences() {
            const language = document.getElementById('pref-language').value;
            const theme = document.getElementById('pref-theme').value;
            const notifications = document.getElementById('pref-notifications').checked;
            
            userData.preferences = {
                language: language,
                theme: theme,
                notifications: notifications
            };
            
            await saveUserData();
            showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        async function changePassword() {
            const { value: formValues } = await Swal.fire({
                title: 'ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
                html: `
                    <input type="password" id="current-password" class="swal2-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©">
                    <input type="password" id="new-password" class="swal2-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
                    <input type="password" id="confirm-password" class="swal2-input" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
                `,
                focusConfirm: false,
                showCancelButton: true,
                confirmButtonText: 'ØªØºÙŠÙŠØ±',
                cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
                preConfirm: () => {
                    return {
                        current: document.getElementById('current-password').value,
                        new: document.getElementById('new-password').value,
                        confirm: document.getElementById('confirm-password').value
                    };
                }
            });
            
            if (formValues) {
                if (formValues.new !== formValues.confirm) {
                    showNotification('ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†', 'error');
                    return;
                }
                
                if (formValues.new.length < 6) {
                    showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                    return;
                }
                
                try {
                    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø£ÙˆÙ„Ø§Ù‹
                    const user = auth.currentUser;
                    const credential = firebase.auth.EmailAuthProvider.credential(
                        user.email,
                        formValues.current
                    );
                    
                    await user.reauthenticateWithCredential(credential);
                    await user.updatePassword(formValues.new);
                    
                    showNotification('ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:', error);
                    showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                }
            }
        }

        async function deleteAccount() {
            const confirm = await Swal.fire({
                title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
                text: 'Ø³ÙŠØªÙ… Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ ÙˆÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ø´ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠ. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨',
                cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
                reverseButtons: true,
                confirmButtonColor: '#ff006e'
            });
            
            if (confirm.isConfirmed) {
                try {
                    await db.ref(`users/${currentUser.uid}`).remove();
                    await currentUser.delete();
                    
                    showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    showLoginScreen();
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨:', error);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨', 'error');
                }
            }
        }

        async function quickGenerateTest() {
            const text = document.getElementById('quick-test-text')?.value;
            const questionCount = parseInt(document.getElementById('quick-question-count')?.value || 10);
            const difficulty = document.getElementById('quick-difficulty')?.value;
            
            if (!text || text.length < 50) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ ÙƒØ§ÙÙŠ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'error');
                return;
            }
            
            try {
                const test = await testSystem.generateTestFromText(text, {
                    count: questionCount,
                    difficulty: difficulty,
                    title: 'Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹',
                    description: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹'
                });
                
                currentTest = test;
                currentAnswers = new Array(test.questions.length).fill(null);
                
                displayTest(test);
                showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'error');
            }
        }

        function startSampleTest(testId) {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù…ÙˆØ°Ø¬ÙŠ
            const sampleTests = {
                'sample1': createSampleTest1(),
                'sample2': createSampleTest2(),
                'sample3': createSampleTest3(),
                'sample4': createSampleTest4()
            };
            
            const test = sampleTests[testId];
            if (test) {
                currentTest = test;
                currentAnswers = new Array(test.questions.length).fill(null);
                displayTest(test);
                showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠ', 'success');
            }
        }

        function createSampleTest1() {
            return {
                id: 'sample_test_1',
                title: 'Ø§Ø®ØªØ¨Ø§Ø± ÙÙŠ Ø§Ù„Ø«Ù‚Ø§ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø©',
                description: 'Ø£Ø³Ø¦Ù„Ø© Ù…ØªÙ†ÙˆØ¹Ø© ÙÙŠ Ø§Ù„Ø«Ù‚Ø§ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø©',
                questions: [
                    {
                        id: 'q1',
                        type: 'multiple_choice',
                        text: 'Ù…Ø§ Ù‡Ùˆ Ø£Ø·ÙˆÙ„ Ù†Ù‡Ø± ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ',
                        options: ['Ù†Ù‡Ø± Ø§Ù„Ù†ÙŠÙ„', 'Ù†Ù‡Ø± Ø§Ù„Ø£Ù…Ø§Ø²ÙˆÙ†', 'Ù†Ù‡Ø± Ø§Ù„Ù…Ø³ÙŠØ³ÙŠØ¨ÙŠ', 'Ù†Ù‡Ø± Ø§Ù„ÙŠØ§Ù†ØºØªØ³ÙŠ'],
                        correctAnswer: 0,
                        explanation: 'Ù†Ù‡Ø± Ø§Ù„Ù†ÙŠÙ„ Ù‡Ùˆ Ø£Ø·ÙˆÙ„ Ù†Ù‡Ø± ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… Ø¨Ø·ÙˆÙ„ 6650 ÙƒÙ….',
                        difficulty: 'medium',
                        points: 2
                    },
                    {
                        id: 'q2',
                        type: 'true_false',
                        text: 'Ø§Ù„Ù‚Ù…Ø± Ù‡Ùˆ Ø§Ù„ÙƒÙˆÙƒØ¨ Ø§Ù„ÙˆØ­ÙŠØ¯ Ø§Ù„Ø°ÙŠ ÙŠØ¯ÙˆØ± Ø­ÙˆÙ„ Ø§Ù„Ø£Ø±Ø¶',
                        options: ['ØµØ­ÙŠØ­', 'Ø®Ø·Ø£'],
                        correctAnswer: 1,
                        explanation: 'Ø§Ù„Ù‚Ù…Ø± Ù‡Ùˆ Ø§Ù„Ù‚Ù…Ø± Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ø§Ù„ÙˆØ­ÙŠØ¯ Ù„Ù„Ø£Ø±Ø¶ØŒ ÙˆÙ„ÙŠØ³ ÙƒÙˆÙƒØ¨Ø§Ù‹.',
                        difficulty: 'easy',
                        points: 1
                    },
                    {
                        id: 'q3',
                        type: 'multiple_choice',
                        text: 'Ù…Ù† Ù‡Ùˆ Ù…Ø¤Ù„Ù ÙƒØªØ§Ø¨ "Ø§Ù„Ø£ÙŠØ§Ù…"ØŸ',
                        options: ['Ø·Ù‡ Ø­Ø³ÙŠÙ†', 'Ù†Ø¬ÙŠØ¨ Ù…Ø­ÙÙˆØ¸', 'ØªÙˆÙÙŠÙ‚ Ø§Ù„Ø­ÙƒÙŠÙ…', 'Ø¹Ø¨Ø§Ø³ Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„Ø¹Ù‚Ø§Ø¯'],
                        correctAnswer: 0,
                        explanation: 'Ø·Ù‡ Ø­Ø³ÙŠÙ† Ù‡Ùˆ Ù…Ø¤Ù„Ù ÙƒØªØ§Ø¨ "Ø§Ù„Ø£ÙŠØ§Ù…" ÙˆÙ‡Ùˆ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ©.',
                        difficulty: 'medium',
                        points: 2
                    },
                    {
                        id: 'q4',
                        type: 'short_answer',
                        text: 'Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© ÙØ±Ù†Ø³Ø§ØŸ',
                        correctAnswer: 'Ø¨Ø§Ø±ÙŠØ³',
                        explanation: 'Ø¨Ø§Ø±ÙŠØ³ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© ÙØ±Ù†Ø³Ø§ ÙˆØ£ÙƒØ¨Ø± Ù…Ø¯Ù†Ù‡Ø§.',
                        difficulty: 'easy',
                        points: 1
                    }
                ],
                settings: {
                    difficulty: 'medium',
                    timeLimit: 30,
                    passingScore: 60,
                    questionCount: 4,
                    generatedAt: new Date().toISOString()
                },
                metadata: {
                    source: 'sample',
                    language: 'ar'
                }
            };
        }

        // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©...

        // =============== [ 5. Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ] ===============
        function showNotification(message, type = 'info') {
            // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø³Ø§Ø¨Ù‚Ø©
            const oldNotifications = document.querySelectorAll('.notification');
            oldNotifications.forEach(notif => notif.remove());
            
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            let icon = 'â„¹ï¸';
            if (type === 'success') icon = 'âœ…';
            if (type === 'error') icon = 'âŒ';
            if (type === 'warning') icon = 'âš ï¸';
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 20px;">${icon}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function showLoading(message = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...') {
            Swal.fire({
                title: message,
                allowOutsideClick: false,
                showConfirmButton: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
        }

        function hideLoading() {
            Swal.close();
        }

        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 5 + 2;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.animationDelay = `${Math.random() * 15}s`;
                particle.style.animationDuration = `${Math.random() * 10 + 10}s`;
                
                // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø¨Ø´ÙƒÙ„ Ù…ØªØ³Ø§ÙˆÙ
                const colors = ['var(--neon-blue)', 'var(--neon-purple)', 'var(--neon-green)', 'var(--accent)'];
                particle.style.background = colors[i % colors.length];
                particle.style.opacity = Math.random() * 0.5 + 0.2;
                
                container.appendChild(particle);
            }
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl + N: Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯
                if (e.ctrlKey && e.key === 'n') {
                    e.preventDefault();
                    openModule('test-generator');
                }
                
                // Ctrl + D: Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                if (e.ctrlKey && e.key === 'd') {
                    e.preventDefault();
                    openModule('dashboard');
                }
                
                // Ctrl + H: Ø³Ø¬Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
                if (e.ctrlKey && e.key === 'h') {
                    e.preventDefault();
                    openModule('test-history');
                }
                
                // Ctrl + Q: ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                if (e.ctrlKey && e.key === 'q') {
                    e.preventDefault();
                    logout();
                }
                
                // Escape: Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ°
                if (e.key === 'Escape') {
                    closeModule();
                }
            });
        }

        function checkUserSession() {
            const savedEmail = localStorage.getItem('ai_system_email');
            if (savedEmail) {
                document.getElementById('login-email').value = savedEmail;
                document.getElementById('login-password').focus();
            }
        }

        // =============== [ 6. ØªØµØ¯ÙŠØ± Ø§Ù„Ø¯ÙˆØ§Ù„ Ù„Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ø§Ù… ] ===============
        window.login = login;
        window.logout = logout;
        window.showRegister = showRegister;
        window.openModule = openModule;
        window.closeModule = closeModule;
        window.switchTestTab = switchTestTab;
        window.generateTestFromText = generateTestFromText;
        window.generateTestFromImage = generateTestFromImage;
        window.generateTestFromTopic = generateTestFromTopic;
        window.handleImageUpload = handleImageUpload;
        window.clearImage = clearImage;
        window.selectAnswer = selectAnswer;
        window.submitTest = submitTest;
        window.reviewTest = reviewTest;
        window.updateProfile = updateProfile;
        window.updatePreferences = updatePreferences;
        window.changePassword = changePassword;
        window.deleteAccount = deleteAccount;
        window.quickGenerateTest = quickGenerateTest;
        window.startSampleTest = startSampleTest;
        window.viewTest = viewTest;

        // =============== [ 7. Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ] ===============
        async function viewTest(testId) {
            // ÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¹ÙŠÙ†
            showNotification('Ù…ÙŠØ²Ø© Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
        }

        console.log('ğŸš€ Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø®Ø§Ø±Ù‚ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„!');
        console.log('ğŸ“Š Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¯Ø¹Ù…:');
        console.log('- ØªÙˆÙ„ÙŠØ¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ù† Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©');
        console.log('- Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† Ø§Ù„ØµÙˆØ±');
        console.log('- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ù† Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†');
        console.log('- Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙÙŠ Firebase');
        console.log('- ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ© ÙƒØ§Ù…Ù„Ø©');
    </script>
</body>
</html>
