<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø®Ø§Ø±Ù‚ | Super AI</title>
    
    <!-- Ø®Ø·ÙˆØ· Ø¹Ø±Ø¨ÙŠØ© -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700;800&display=swap" rel="stylesheet">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <!-- Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-dark: #0f0f23;
            --bg-card: #1a1a2e;
            --primary: #00b4d8;
            --accent: #ff006e;
            --neon-blue: #00f5ff;
            --neon-purple: #9d4edd;
            --text-main: #ffffff;
            --text-sec: #b8b8d1;
            --success: #00ff9d;
            --warning: #ffd166;
            --danger: #ff0054;
            --gradient-ai: linear-gradient(135deg, #00f5ff 0%, #9d4edd 100%);
            --gradient-dark: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
            --shadow-glow: 0 0 20px rgba(0, 245, 255, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background: var(--gradient-dark);
            color: var(--text-main);
            min-height: 100vh;
            direction: rtl;
        }

        .hidden {
            display: none !important;
        }

        /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: var(--gradient-dark);
        }

        .login-container {
            width: 100%;
            max-width: 420px;
            background: var(--bg-card);
            border-radius: 25px;
            padding: 40px;
            border: 2px solid rgba(0, 245, 255, 0.1);
            box-shadow: var(--shadow-glow);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 20px rgba(0, 245, 255, 0.3); }
            50% { box-shadow: 0 0 30px rgba(0, 245, 255, 0.5); }
            100% { box-shadow: 0 0 20px rgba(0, 245, 255, 0.3); }
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo i {
            font-size: 90px;
            background: var(--gradient-ai);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .login-title {
            font-size: 38px;
            margin-bottom: 10px;
            background: var(--gradient-ai);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .login-subtitle {
            color: var(--text-sec);
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-input {
            width: 100%;
            padding: 18px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 245, 255, 0.2);
            border-radius: 15px;
            color: white;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--neon-blue);
            background: rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 15px rgba(0, 245, 255, 0.2);
        }

        .btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: var(--gradient-ai);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 245, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 245, 255, 0.4);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--neon-blue);
            color: var(--neon-blue);
        }

        .btn-success {
            background: var(--success);
            color: black;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        #app-screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: rgba(10, 10, 20, 0.95);
            backdrop-filter: blur(15px);
            padding: 15px 25px;
            border-bottom: 2px solid rgba(0, 245, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-ai);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            box-shadow: var(--shadow-glow);
        }

        .ai-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-header i {
            font-size: 32px;
            background: var(--gradient-ai);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .ai-level {
            background: var(--danger);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: rgba(10, 10, 20, 0.5);
            border-radius: 20px;
            border: 2px solid rgba(0, 245, 255, 0.1);
            margin-bottom: 20px;
        }

        .message {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 20px;
            max-width: 85%;
            position: relative;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            background: linear-gradient(135deg, rgba(0, 180, 216, 0.2), rgba(0, 245, 255, 0.1));
            border: 2px solid rgba(0, 245, 255, 0.3);
            margin-left: auto;
            border-top-right-radius: 5px;
        }

        .message.ai {
            background: linear-gradient(135deg, rgba(157, 78, 221, 0.2), rgba(255, 0, 110, 0.1));
            border: 2px solid rgba(157, 78, 221, 0.3);
            margin-right: auto;
            border-top-left-radius: 5px;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: -15px;
        }

        .message.user .message-avatar {
            right: -15px;
            background: var(--primary);
        }

        .message.ai .message-avatar {
            left: -15px;
            background: var(--neon-purple);
        }

        .message-content {
            margin-bottom: 10px;
            line-height: 1.8;
            font-size: 16px;
        }

        .message-time {
            font-size: 12px;
            color: var(--text-sec);
            text-align: left;
        }

        .ai-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .feature-card {
            background: var(--bg-card);
            border: 2px solid rgba(0, 245, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: var(--neon-blue);
            box-shadow: var(--shadow-glow);
        }

        .feature-card i {
            font-size: 32px;
            margin-bottom: 15px;
            background: var(--gradient-ai);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .feature-card h3 {
            margin-bottom: 10px;
            color: var(--text-main);
        }

        .feature-card p {
            color: var(--text-sec);
            font-size: 14px;
        }

        .chat-input-container {
            background: rgba(10, 10, 20, 0.7);
            border-radius: 20px;
            padding: 15px;
            border: 2px solid rgba(0, 245, 255, 0.2);
            display: flex;
            gap: 10px;
        }

        #chat-input {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            color: white;
            font-size: 16px;
            outline: none;
        }

        #chat-input::placeholder {
            color: var(--text-sec);
        }

        .input-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            background: var(--bg-card);
            border: 2px solid rgba(0, 245, 255, 0.2);
            color: var(--neon-blue);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background: var(--neon-blue);
            color: black;
            border-color: var(--neon-blue);
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª */
        .quiz-container {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            margin: 20px;
            border: 2px solid rgba(0, 245, 255, 0.2);
        }

        .question {
            font-size: 20px;
            margin-bottom: 25px;
            color: var(--text-main);
            line-height: 1.6;
        }

        .options {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
        }

        .option {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 245, 255, 0.1);
            border-radius: 15px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .option:hover {
            border-color: var(--neon-blue);
            background: rgba(0, 245, 255, 0.1);
        }

        .option.selected {
            background: rgba(0, 245, 255, 0.2);
            border-color: var(--neon-blue);
            box-shadow: 0 0 10px rgba(0, 245, 255, 0.3);
        }

        .option-letter {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .option-text {
            flex: 1;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-container {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            margin: 20px;
            border: 2px solid rgba(0, 245, 255, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 2px solid rgba(0, 245, 255, 0.1);
        }

        .stat-value {
            font-size: 42px;
            font-weight: bold;
            background: var(--gradient-ai);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 15px 0;
        }

        .stat-label {
            color: var(--text-sec);
            font-size: 14px;
        }

        /* Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ø±Ø³ÙˆÙ…Ø§Øª */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .ai-loader {
            border: 3px solid transparent;
            border-top: 3px solid var(--neon-blue);
            border-right: 3px solid var(--neon-purple);
            border-bottom: 3px solid var(--accent);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Ø§Ù„ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 768px) {
            .login-container {
                padding: 25px;
            }
            
            .login-title {
                font-size: 28px;
            }
            
            .ai-features {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .message {
                max-width: 95%;
            }
        }

        @media (max-width: 480px) {
            .ai-features {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 10px;
            }
            
            .ai-header {
                order: -1;
            }
            
            .user-info {
                width: 100%;
                justify-content: center;
            }
            
            .input-actions {
                flex-wrap: wrap;
            }
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù†ÙŠÙˆÙ† */
        .neon-text {
            text-shadow: 0 0 10px currentColor;
        }

        .glow-effect {
            box-shadow: 0 0 15px currentColor;
        }
    </style>
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="login-screen">
        <div class="login-container">
            <div class="login-logo">
                <i class="fas fa-brain-circuit"></i>
            </div>
            
            <h1 class="login-title neon-text">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚</h1>
            <p class="login-subtitle">Ù†Ø¸Ø§Ù… Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ØªØ¹Ù„ÙŠÙ…ÙŠ Ù…ØªÙ‚Ø¯Ù… - Ù…Ø³ØªÙˆÙ‰ Ø¹Ø§Ù„Ù…ÙŠ</p>
            
            <div class="form-group">
                <input type="email" id="login-email" class="form-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            </div>
            
            <div class="form-group">
                <input type="password" id="login-password" class="form-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
            
            <button class="btn btn-primary" onclick="loginUser()">
                <i class="fas fa-sign-in-alt"></i> Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚
            </button>
            
            <button class="btn btn-secondary" onclick="showRegister()" style="margin-top: 15px;">
                <i class="fas fa-user-plus"></i> Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
            </button>
            
            <div style="text-align: center; margin-top: 25px; color: var(--text-sec); font-size: 12px;">
                <p>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Â© 2024</p>
            </div>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
    <div id="register-screen" class="hidden">
        <div class="login-container">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 30px;">
                <button class="btn btn-secondary" onclick="backToLogin()" style="width: 50px;">
                    <i class="fas fa-arrow-right"></i>
                </button>
                <h2 style="color: var(--neon-blue); margin: 0;">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
            </div>
            
            <div class="form-group">
                <input type="text" id="register-name" class="form-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
            </div>
            
            <div class="form-group">
                <input type="email" id="register-email" class="form-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            </div>
            
            <div class="form-group">
                <input type="password" id="register-password" class="form-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)">
            </div>
            
            <div class="form-group">
                <select id="register-role" class="form-input">
                    <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…ØªØ¹Ù„Ù…</option>
                    <option value="student">Ø·Ø§Ù„Ø¨</option>
                    <option value="researcher">Ø¨Ø§Ø­Ø«</option>
                    <option value="professional">Ù…Ø­ØªØ±Ù</option>
                    <option value="teacher">Ø£Ø³ØªØ§Ø°</option>
                </select>
            </div>
            
            <button class="btn btn-primary" onclick="registerUser()">
                <i class="fas fa-rocket"></i> Ø§Ù†Ø·Ù„Ø§Ù‚ Ù†Ø­Ùˆ Ø§Ù„Ø°ÙƒØ§Ø¡
            </button>
        </div>
    </div>

    <!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div id="app-screen" class="hidden">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <header>
            <div class="header-content">
                <div class="ai-header">
                    <i class="fas fa-brain"></i>
                    <div>
                        <h2 style="color: var(--neon-blue);">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚</h2>
                        <p style="color: var(--text-sec); font-size: 12px;" id="current-mode">ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø°ÙƒÙŠØ©</p>
                    </div>
                    <span class="ai-level">Ù…Ø³ØªÙˆÙ‰ Ø¹Ø§Ù„Ù…ÙŠ</span>
                </div>
                
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <div id="user-name" style="font-weight: bold; color: var(--neon-blue);"></div>
                        <div id="user-role" style="color: var(--text-sec); font-size: 12px;"></div>
                    </div>
                    <button class="action-btn" onclick="logout()" title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="chat-container">
            <!-- Ù…ÙŠØ²Ø§Øª Ø³Ø±ÙŠØ¹Ø© -->
            <div class="ai-features">
                <div class="feature-card" onclick="startSmartQuiz()">
                    <i class="fas fa-lightbulb"></i>
                    <h3>Ø§Ø®ØªØ¨Ø§Ø± Ø°ÙƒÙŠ</h3>
                    <p>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø°ÙƒÙŠØ© Ù…Ø®ØµØµØ©</p>
                </div>
                
                <div class="feature-card" onclick="analyzeDocument()">
                    <i class="fas fa-file-alt"></i>
                    <h3>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</h3>
                    <p>ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ Ù„Ù„Ù†ØµÙˆØµ</p>
                </div>
                
                <div class="feature-card" onclick="solveProblem()">
                    <i class="fas fa-calculator"></i>
                    <h3>Ø­Ù„ Ø§Ù„Ù…Ø³Ø§Ø¦Ù„</h3>
                    <p>Ø­Ù„ Ù…Ø³Ø§Ø¦Ù„ Ù…Ø¹Ù‚Ø¯Ø©</p>
                </div>
                
                <div class="feature-card" onclick="showStats()">
                    <i class="fas fa-chart-line"></i>
                    <h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡</h3>
                    <p>ØªØªØ¨Ø¹ ØªÙ‚Ø¯Ù…Ùƒ</p>
                </div>
            </div>

            <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© -->
            <div class="chat-messages" id="chat-messages">
                <div class="message ai">
                    <div class="message-avatar">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="message-content">
                        <strong>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚:</strong> 
                        Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…! ğŸ‘‹
                        <br><br>
                        Ø£Ù†Ø§ Ù†Ø¸Ø§Ù… Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø¹Ø§Ù„Ù…ÙŠØŒ Ù…ØµÙ…Ù… Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:
                        â€¢ Ø­Ù„ Ø§Ù„Ù…Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø© Ø¨Ø·Ø±Ù‚ Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©
                        â€¢ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø°ÙƒÙŠØ© Ù…Ø®ØµØµØ©
                        â€¢ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¨Ø¯Ù‚Ø© ÙØ§Ø¦Ù‚Ø©
                        â€¢ Ø§Ù„Ø´Ø±Ø­ Ø§Ù„Ù…ÙØµÙ„ Ù„Ø£ÙŠ Ù…ÙˆØ¶ÙˆØ¹ ØªØ¹Ù„ÙŠÙ…ÙŠ
                        <br><br>
                        ğŸ’¡ <strong>Ù†ØµÙŠØ­Ø©:</strong> ÙŠÙ…ÙƒÙ†Ùƒ Ø·Ø±Ø­ Ø£ÙŠ Ø³Ø¤Ø§Ù„ØŒ ÙˆØ³Ø£Ù‚Ø¯Ù… Ù„Ùƒ Ø¥Ø¬Ø§Ø¨Ø© Ø°ÙƒÙŠØ© ÙˆØ´Ø§Ù…Ù„Ø©.
                    </div>
                    <div class="message-time">Ø§Ù„Ø¢Ù†</div>
                </div>
            </div>

            <!-- Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
            <div class="chat-input-container">
                <input type="text" id="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§... (Ø§Ø¶ØºØ· Enter Ù„Ù„Ø¥Ø±Ø³Ø§Ù„)" 
                       onkeypress="if(event.key === 'Enter') sendMessage()">
                <div class="input-actions">
                    <button class="action-btn" onclick="sendMessage()" title="Ø¥Ø±Ø³Ø§Ù„">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                    <button class="action-btn" onclick="recordVoice()" title="ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="action-btn" onclick="uploadFile()" title="Ø±ÙØ¹ Ù…Ù„Ù">
                        <i class="fas fa-upload"></i>
                    </button>
                    <button class="action-btn" onclick="clearChat()" title="Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª -->
    <div id="quiz-modal" class="hidden">
        <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 2000;">
            <div style="background: var(--bg-card); border-radius: 25px; padding: 30px; width: 95%; max-width: 600px; border: 2px solid var(--neon-blue); box-shadow: var(--shadow-glow);">
                <div id="quiz-content"></div>
            </div>
        </div>
    </div>

    <script>
        // ==================== [ 1. Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ] ====================
        const firebaseConfig = {
            apiKey: "AIzaSyAI_mUhuPNoO-XC0Q-VNoWft8UWFbAbIGg",
            authDomain: "sudan-market-6b122.firebaseapp.com",
            databaseURL: "https://sudan-market-6b122-default-rtdb.firebaseio.com",
            projectId: "sudan-market-6b122",
            storageBucket: "sudan-market-6b122.firebasestorage.app",
            messagingSenderId: "66729481566",
            appId: "1:66729481566:web:93393f28dc22d32cceebcf"
        };

        let auth, db, currentUser = null;
        let conversationHistory = [];
        let userStats = {
            questionsAsked: 0,
            correctAnswers: 0,
            learningHours: 0,
            aiInteractions: 0,
            streak: 0,
            lastActive: null
        };

        // ==================== [ 2. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ] ====================
        document.addEventListener('DOMContentLoaded', function() {
            initializeFirebase();
            setupEventListeners();
        });

        function initializeFirebase() {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                auth = firebase.auth();
                db = firebase.database();
                
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        currentUser = user;
                        loadUserData();
                        showAppScreen();
                    } else {
                        showLoginScreen();
                    }
                });
                
                console.log('âœ… Firebase initialized');
            } catch (error) {
                console.error('âŒ Firebase error:', error);
            }
        }

        function setupEventListeners() {
            document.getElementById('chat-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
        }

        // ==================== [ 3. Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ] ====================
        async function loginUser() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value.trim();
            
            if (!email || !password) {
                showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
                return;
            }
            
            showLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø°ÙƒØ§Ø¡...');
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                hideLoading();
                showSuccess('ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚! ğŸš€');
            } catch (error) {
                hideLoading();
                console.error('Login error:', error);
                showError(getAuthError(error.code));
            }
        }

        async function registerUser() {
            const name = document.getElementById('register-name').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value.trim();
            const role = document.getElementById('register-role').value;
            
            if (!name || !email || !password || !role) {
                showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }
            
            if (password.length < 6) {
                showError('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }
            
            showLoading('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø°ÙƒÙŠ...');
            
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                await user.sendEmailVerification();
                
                await db.ref('users/' + user.uid).set({
                    name: name,
                    email: email,
                    role: role,
                    createdAt: Date.now(),
                    level: 'Ù…Ø¨ØªØ¯Ø¦',
                    aiScore: 100,
                    stats: userStats
                });
                
                hideLoading();
                showSuccess('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰');
                backToLogin();
                
            } catch (error) {
                hideLoading();
                showError(getAuthError(error.code));
            }
        }

        function getAuthError(code) {
            const errors = {
                'auth/user-not-found': 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯',
                'auth/wrong-password': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©',
                'auth/email-already-in-use': 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„',
                'auth/invalid-email': 'Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­',
                'auth/weak-password': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹',
                'auth/network-request-failed': 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©'
            };
            return errors[code] || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
        }

        // ==================== [ 4. Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø®Ø§Ø±Ù‚ ] ====================
        class SuperIntelligentAI {
            constructor() {
                this.knowledgeBase = {
                    subjects: ['Ø±ÙŠØ§Ø¶ÙŠØ§Øª', 'ÙÙŠØ²ÙŠØ§Ø¡', 'ÙƒÙŠÙ…ÙŠØ§Ø¡', 'Ø£Ø­ÙŠØ§Ø¡', 'Ø¨Ø±Ù…Ø¬Ø©', 'Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', 'ØªØ§Ø±ÙŠØ®', 'Ø¬ØºØ±Ø§ÙÙŠØ§'],
                    levels: ['Ù…Ø¨ØªØ¯Ø¦', 'Ù…ØªÙˆØ³Ø·', 'Ù…ØªÙ‚Ø¯Ù…', 'Ø®Ø¨ÙŠØ±'],
                    responseTypes: ['Ø´Ø±Ø­', 'ØªØ­Ù„ÙŠÙ„', 'Ø­Ù„', 'ØªÙ‚ÙˆÙŠÙ…', 'Ø¥Ø¨Ø¯Ø§Ø¹']
                };
            }

            async processQuestion(question, context = {}) {
                // Ù…Ø­Ø§ÙƒØ§Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const analysis = this.analyzeQuestion(question);
                const response = this.generateIntelligentResponse(question, analysis, context);
                
                return {
                    success: true,
                    analysis: analysis,
                    response: response,
                    suggestions: this.generateSuggestions(analysis),
                    timestamp: new Date().toISOString()
                };
            }

            analyzeQuestion(question) {
                const words = question.toLowerCase().split(/\s+/).length;
                const complexity = Math.min(words / 10, 1);
                
                return {
                    length: words,
                    complexity: complexity,
                    type: this.detectQuestionType(question),
                    subjects: this.detectSubjects(question),
                    requiresReasoning: words > 5,
                    estimatedTime: Math.max(words * 2, 30) // Ø«ÙˆØ§Ù†ÙŠ
                };
            }

            detectQuestionType(question) {
                const patterns = {
                    'Ø´Ø±Ø­': ['Ù…Ø§ Ù‡Ùˆ', 'Ø§Ø´Ø±Ø­', 'Ø¹Ø±Ù', 'Ù…Ø§ Ù…Ø¹Ù†Ù‰'],
                    'Ø­Ù„': ['ÙƒÙŠÙ', 'Ø·Ø±ÙŠÙ‚Ø©', 'Ø­Ù„', 'Ø§Ø­Ø³Ø¨'],
                    'Ù…Ù‚Ø§Ø±Ù†Ø©': ['Ù…Ø§ Ø§Ù„ÙØ±Ù‚', 'Ù‚Ø§Ø±Ù†', 'Ø£ÙŠÙ‡Ù…Ø§ Ø£ÙØ¶Ù„'],
                    'ØªØ­Ù„ÙŠÙ„': ['Ø­Ù„Ù„', 'Ù†Ø§Ù‚Ø´', 'Ù…Ø§ Ø±Ø£ÙŠÙƒ'],
                    'Ø¥Ø¨Ø¯Ø§Ø¹': ['ØªØ®ÙŠÙ„', 'Ø§Ù‚ØªØ±Ø­', 'Ø§Ø¨ØªÙƒØ±', 'ØµÙ…Ù…']
                };

                for (const [type, keywords] of Object.entries(patterns)) {
                    if (keywords.some(keyword => question.includes(keyword))) {
                        return type;
                    }
                }
                return 'Ø¹Ø§Ù…';
            }

            detectSubjects(question) {
                const detected = [];
                this.knowledgeBase.subjects.forEach(subject => {
                    if (question.includes(subject)) {
                        detected.push(subject);
                    }
                });
                return detected.length > 0 ? detected : ['Ø¹Ø§Ù…'];
            }

            generateIntelligentResponse(question, analysis, context) {
                const templates = {
                    'Ø´Ø±Ø­': this.generateExplanation(question, analysis),
                    'Ø­Ù„': this.generateSolution(question, analysis),
                    'Ù…Ù‚Ø§Ø±Ù†Ø©': this.generateComparison(question, analysis),
                    'ØªØ­Ù„ÙŠÙ„': this.generateAnalysis(question, analysis),
                    'Ø¥Ø¨Ø¯Ø§Ø¹': this.generateCreative(question, analysis),
                    'Ø¹Ø§Ù…': this.generateGeneral(question, analysis)
                };

                const responseType = analysis.type in templates ? analysis.type : 'Ø¹Ø§Ù…';
                let response = templates[responseType];
                
                // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ØµØ± Ø°ÙƒØ§Ø¡ Ø¥Ø¶Ø§ÙÙŠØ©
                response += this.addIntelligenceElements(analysis);
                
                return response;
            }

            generateExplanation(question, analysis) {
                const explanations = [
                    `Ù‡Ø°Ø§ Ù…ÙÙ‡ÙˆÙ… Ù…Ù‡Ù…. Ø¥Ù„ÙŠÙƒ Ø´Ø±Ø­ ØªÙØµÙŠÙ„ÙŠ:\n\n`,
                    `Ù„ÙÙ‡Ù… "${question}" Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„:\n\n`,
                    `Ù‡Ø°Ø§ Ø³Ø¤Ø§Ù„ Ù…Ù…ØªØ§Ø². Ø¯Ø¹Ù†ÙŠ Ø£Ø´Ø±Ø­Ù‡ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø´Ø§Ù…Ù„Ø©:\n\n`
                ];
                
                const base = explanations[Math.floor(Math.random() * explanations.length)];
                const depth = analysis.complexity > 0.5 ? 'Ø¹Ù…ÙŠÙ‚' : 'Ù…Ø¨Ø³Ø·';
                
                return base + `ğŸ“š **Ø§Ù„Ø´Ø±Ø­ ${depth}:**\n` +
                       `â€¢ Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙˆØ§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\n` +
                       `â€¢ Ø§Ù„Ø£Ù…Ø«Ù„Ø© Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠØ© ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©\n` +
                       `â€¢ Ø§Ù„Ø£Ù‡Ù…ÙŠØ© ÙˆØ§Ù„ÙÙˆØ§Ø¦Ø¯ ÙÙŠ Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ\n` +
                       `â€¢ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù…Ø¹ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø°Ø§Øª Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©\n\n` +
                       `ğŸ’¡ **Ø§Ù„Ø®Ù„Ø§ØµØ© Ø§Ù„Ø°ÙƒÙŠØ©:**\n` +
                       `Ù‡Ø°Ø§ Ø§Ù„Ù…ÙÙ‡ÙˆÙ… ÙŠÙ…Ø«Ù„ Ù†Ù‚Ø·Ø© ØªØ­ÙˆÙ„ ÙÙŠ ÙÙ‡Ù…Ù†Ø§ Ù„Ù„Ù€ ${analysis.subjects[0] || 'Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹'} ` +
                       `ÙˆÙŠÙ…ÙƒÙ† ØªØ·Ø¨ÙŠÙ‚Ù‡ ÙÙŠ Ø¹Ø¯Ø© Ø³ÙŠØ§Ù‚Ø§Øª Ø¹Ù…Ù„ÙŠØ©.`;
            }

            generateSolution(question, analysis) {
                return `ğŸ§® **Ø§Ù„Ø­Ù„ Ø§Ù„Ø°ÙƒÙŠ:**\n\n` +
                       `Ù„Ø­Ù„ "${question}"ØŒ Ø£ØªØ¨Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠØ©:\n\n` +
                       `1. **ÙÙ‡Ù… Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø·ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø·Ù„ÙˆØ¨\n` +
                       `2. **ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ù‡Ø¬ÙŠØ©:** Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø­Ù„\n` +
                       `3. **Ø§Ù„ØªÙ†ÙÙŠØ°:** ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©/Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠØ©\n` +
                       `4. **Ø§Ù„ØªØ­Ù‚Ù‚:** Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬\n\n` +
                       `ğŸ” **Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù†Ù‚Ø¯ÙŠ:**\n` +
                       `ÙŠÙ…ÙƒÙ† Ø­Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø¨Ø¹Ø¯Ø© Ø·Ø±Ù‚ØŒ ÙˆØ£ÙØ¶Ù„ Ø·Ø±ÙŠÙ‚Ø© ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ${analysis.complexity > 0.7 ? 'Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠ' : 'Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±'}.` +
                       `\n\nâœ¨ **Ø¥Ø¨Ø¯Ø§Ø¹ ÙÙŠ Ø§Ù„Ø­Ù„:**\n` +
                       `Ø¬Ø±Ø¨ Ø§Ù„ØªÙÙƒÙŠØ± ÙÙŠ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ù…Ù† Ø²Ø§ÙˆÙŠØ© Ù…Ø®ØªÙ„ÙØ© Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø­Ù„ÙˆÙ„ Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©.`;
            }

            generateCreative(question, analysis) {
                return `ğŸ¨ **Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„Ø°ÙƒÙŠ:**\n\n` +
                       `Ù„Ù€ "${question}"ØŒ Ø¥Ù„ÙŠÙƒ Ø£ÙÙƒØ§Ø± Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©:\n\n` +
                       `ğŸ’¡ **Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:**\n` +
                       `Ø§Ø¨ØªÙƒØ§Ø± Ø¬Ø¯ÙŠØ¯ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø¯Ù…Ø¬ Ø¹Ø¯Ø© Ù…ÙØ§Ù‡ÙŠÙ…\n\n` +
                       `ğŸš€ **Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠ:**\n` +
                       `1. Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ù„Ù‡Ø§Ù… ÙˆØ§Ù„Ø¨Ø­Ø«\n` +
                       `2. Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªÙˆÙ„ÙŠÙ ÙˆØ§Ù„Ø¯Ù…Ø¬\n` +
                       `3. Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ† ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±\n` +
                       `4. Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„\n\n` +
                       `ğŸŒŸ **Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©:**\n` +
                       `Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ ÙŠÙ‚Ø¯Ù… Ù‚ÙŠÙ…Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ù…Ø¬Ø§Ù„ ${analysis.subjects[0] || 'Ø§Ù„Ù…Ø¹Ø±ÙØ©'}`;
            }

            addIntelligenceElements(analysis) {
                const elements = [];
                
                if (analysis.complexity > 0.7) {
                    elements.push(`\n\nğŸ§  **Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…:**\n` +
                                 `Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ÙŠØªØ·Ù„Ø¨ ØªÙÙƒÙŠØ±Ø§Ù‹ Ù…Ù† Ù…Ø³ØªÙˆÙ‰ Ø¹Ø§Ù„ÙØŒ ` +
                                 `ÙŠÙ…ÙƒÙ†Ùƒ ØªØ·ÙˆÙŠØ± Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù†Ù‚Ø¯ÙŠ ÙˆØ§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠ Ù…Ù† Ø®Ù„Ø§Ù„Ù‡.`);
                }
                
                if (analysis.requiresReasoning) {
                    elements.push(`\n\nâš¡ **Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø°ÙƒÙŠ:**\n` +
                                 `Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ù†Ø§ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ¯Ù„Ø§Ù„ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù….`);
                }
                
                elements.push(`\n\nğŸ“ˆ **Ù†ØµÙŠØ­Ø© Ø§Ù„Ø°ÙƒØ§Ø¡:**\n` +
                            `Ù„ØªØ·ÙˆÙŠØ± Ø°ÙƒØ§Ø¦Ùƒ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ø§Ù„ØŒ ` +
                            `Ø¬Ø±Ø¨ Ø­Ù„ Ù…Ø³Ø§Ø¦Ù„ Ø£ÙƒØ«Ø± ØªØ¹Ù‚ÙŠØ¯Ø§Ù‹ ÙˆØªØ§Ø¨Ø¹ Ø¢Ø®Ø± Ø§Ù„ØªØ·ÙˆØ±Ø§Øª Ø§Ù„Ø¹Ù„Ù…ÙŠØ©.`);
                
                return elements.join('');
            }

            generateSuggestions(analysis) {
                const suggestions = [];
                
                if (analysis.complexity > 0.6) {
                    suggestions.push({
                        text: 'ØªØ¹Ù…Ù‚ Ø£ÙƒØ«Ø± ÙÙŠ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹',
                        action: 'deep_dive'
                    });
                }
                
                if (analysis.subjects.length > 0) {
                    suggestions.push({
                        text: `Ø§Ø®ØªØ¨Ø§Ø± ÙÙŠ ${analysis.subjects[0]}`,
                        action: 'quiz'
                    });
                }
                
                suggestions.push({
                    text: 'Ø´Ø±Ø­ Ø¨ØµÙˆØ±Ø© Ù…Ø®ØªÙ„ÙØ©',
                    action: 'alternative_explanation'
                });
                
                return suggestions;
            }

            async generateSmartQuiz(subject, difficulty = 'medium', count = 10) {
                // ØªÙˆÙ„ÙŠØ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø°ÙƒÙŠ
                const questions = [];
                const levels = {
                    easy: { min: 1, max: 3 },
                    medium: { min: 3, max: 5 },
                    hard: { min: 5, max: 7 }
                };
                
                const level = levels[difficulty] || levels.medium;
                
                for (let i = 1; i <= count; i++) {
                    const question = this.generateQuestion(subject, level, i);
                    questions.push(question);
                }
                
                return {
                    id: `quiz_${Date.now()}`,
                    title: `Ø§Ø®ØªØ¨Ø§Ø± Ø°ÙƒÙŠ: ${subject} - Ù…Ø³ØªÙˆÙ‰ ${difficulty}`,
                    subject: subject,
                    difficulty: difficulty,
                    questions: questions,
                    estimatedTime: count * 45,
                    intelligenceLevel: this.calculateIntelligenceLevel(difficulty)
                };
            }

            generateQuestion(subject, level, index) {
                const questionTypes = [
                    {
                        type: 'Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯',
                        template: `Ù…Ø§ Ù‡Ùˆ ${this.getRandomTerm(subject)} ÙÙŠ ${subject}ØŸ`,
                        options: 4
                    },
                    {
                        type: 'ØµØ­/Ø®Ø·Ø£',
                        template: `${this.getRandomStatement(subject)}`,
                        options: 2
                    },
                    {
                        type: 'Ø¥ÙƒÙ…Ø§Ù„',
                        template: `Ø£ÙƒÙ…Ù„: ${this.getIncompleteSentence(subject)}`,
                        options: 4
                    }
                ];
                
                const qType = questionTypes[Math.floor(Math.random() * questionTypes.length)];
                const complexity = level.min + Math.random() * (level.max - level.min);
                
                return {
                    id: `q${index}`,
                    type: qType.type,
                    question: qType.template,
                    options: this.generateOptions(qType.options, subject),
                    correctAnswer: Math.floor(Math.random() * qType.options),
                    explanation: this.generateExplanationText(subject, complexity),
                    intelligencePoints: Math.round(complexity * 10),
                    timeLimit: 30 + complexity * 15
                };
            }

            getRandomTerm(subject) {
                const terms = {
                    'Ø±ÙŠØ§Ø¶ÙŠØ§Øª': ['Ø§Ù„ØªÙƒØ§Ù…Ù„', 'Ø§Ù„Ø§Ø´ØªÙ‚Ø§Ù‚', 'Ø§Ù„Ù…ØµÙÙˆÙØ©', 'Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ©'],
                    'ÙÙŠØ²ÙŠØ§Ø¡': ['Ø§Ù„Ø³Ø±Ø¹Ø©', 'Ø§Ù„ØªØ³Ø§Ø±Ø¹', 'Ø§Ù„Ù‚ÙˆØ©', 'Ø§Ù„Ø·Ø§Ù‚Ø©'],
                    'ÙƒÙŠÙ…ÙŠØ§Ø¡': ['Ø§Ù„Ø¹Ù†ØµØ±', 'Ø§Ù„Ù…Ø±ÙƒØ¨', 'Ø§Ù„ØªÙØ§Ø¹Ù„', 'Ø§Ù„Ø±ÙˆØ§Ø¨Ø·'],
                    'Ø¨Ø±Ù…Ø¬Ø©': ['Ø§Ù„Ø¯Ø§Ù„Ø©', 'Ø§Ù„ÙƒØ§Ø¦Ù†', 'Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ©', 'Ø§Ù„Ù‡ÙŠÙƒÙ„']
                };
                
                const subjectTerms = terms[subject] || ['Ø§Ù„Ù…ÙÙ‡ÙˆÙ…', 'Ø§Ù„Ø¹Ù†ØµØ±', 'Ø§Ù„Ø¹Ø§Ù…Ù„'];
                return subjectTerms[Math.floor(Math.random() * subjectTerms.length)];
            }

            generateOptions(count, subject) {
                const options = [];
                for (let i = 0; i < count; i++) {
                    options.push(`Ø§Ù„Ø®ÙŠØ§Ø± ${i + 1} ÙÙŠ ${subject}`);
                }
                return options;
            }

            generateExplanationText(subject, complexity) {
                return `Ø´Ø±Ø­ Ù…ÙØµÙ„ Ù„Ù„Ø¬ÙˆØ§Ø¨ Ø§Ù„ØµØ­ÙŠØ­ Ù…Ø¹ Ø£Ù…Ø«Ù„Ø© ÙˆØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¹Ù…Ù„ÙŠØ© ÙÙŠ Ù…Ø¬Ø§Ù„ ${subject}. ` +
                       `Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù‚ÙŠØ¯: ${complexity.toFixed(1)}/7`;
            }

            calculateIntelligenceLevel(difficulty) {
                const levels = {
                    easy: 'Ù…Ø¨ØªØ¯Ø¦',
                    medium: 'Ù…ØªÙˆØ³Ø·',
                    hard: 'Ù…ØªÙ‚Ø¯Ù…'
                };
                return levels[difficulty] || 'Ù…ØªÙˆØ³Ø·';
            }

            async analyzeDocument(text) {
                const words = text.split(/\s+/).length;
                const sentences = text.split(/[.!?]+/).length;
                const paragraphs = text.split(/\n\s*\n/).length;
                
                const complexity = words > 500 ? 'Ø¹Ø§Ù„ÙŠ' : words > 200 ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ù†Ø®ÙØ¶';
                const readingTime = Math.ceil(words / 200);
                
                return {
                    summary: this.generateSummary(text),
                    keyPoints: this.extractKeyPoints(text),
                    keywords: this.extractKeywords(text),
                    statistics: {
                        words: words,
                        sentences: sentences,
                        paragraphs: paragraphs,
                        readingTime: readingTime,
                        complexity: complexity
                    },
                    recommendations: this.generateDocumentRecommendations(text)
                };
            }

            generateSummary(text) {
                const sentences = text.split(/[.!?]+/);
                if (sentences.length <= 3) return text;
                
                const importantSentences = sentences.filter((_, i) => 
                    i === 0 || i === Math.floor(sentences.length / 2) || i === sentences.length - 2
                );
                
                return importantSentences.join('. ') + '...';
            }

            extractKeyPoints(text) {
                const sentences = text.split(/[.!?]+/);
                return sentences
                    .filter(s => s.length > 20)
                    .slice(0, 5)
                    .map(s => `â€¢ ${s.trim()}`);
            }

            extractKeywords(text) {
                const words = text.toLowerCase().split(/\W+/);
                const stopWords = new Set(['ÙÙŠ', 'Ù…Ù†', 'Ø¥Ù„Ù‰', 'Ø¹Ù„Ù‰', 'Ø¹Ù†', 'Ø£Ù†', 'Ø¥Ù†']);
                
                const freq = {};
                words.forEach(word => {
                    if (word.length > 2 && !stopWords.has(word)) {
                        freq[word] = (freq[word] || 0) + 1;
                    }
                });
                
                return Object.entries(freq)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10)
                    .map(([word]) => word);
            }

            generateDocumentRecommendations(text) {
                const recommendations = [];
                const words = text.split(/\s+/).length;
                
                if (words < 100) {
                    recommendations.push('Ø§Ù„Ù†Øµ Ù‚ØµÙŠØ±ØŒ Ø­Ø§ÙˆÙ„ Ø¥Ø¶Ø§ÙØ© ØªÙØ§ØµÙŠÙ„ Ø£ÙƒØ«Ø±');
                } else if (words > 1000) {
                    recommendations.push('Ø§Ù„Ù†Øµ Ø·ÙˆÙŠÙ„ØŒ ÙŠÙ…ÙƒÙ† ØªÙ‚Ø³ÙŠÙ…Ù‡ Ø¥Ù„Ù‰ Ø£Ø¬Ø²Ø§Ø¡');
                }
                
                if (text.split('\n').length < 3) {
                    recommendations.push('Ø£Ø¶Ù ÙÙˆØ§ØµÙ„ ÙÙ‚Ø±Ø§Øª Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©');
                }
                
                return recommendations;
            }
        }

        const superAI = new SuperIntelligentAI();

        // ==================== [ 5. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ] ====================
        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            addMessage(message, 'user');
            input.value = '';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            userStats.questionsAsked++;
            userStats.aiInteractions++;
            updateStats();
            
            // Ø¹Ø±Ø¶ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡
            const loadingId = showAILoading();
            
            try {
                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
                const response = await superAI.processQuestion(message, {
                    userLevel: userStats.level,
                    conversationHistory: conversationHistory.slice(-5)
                });
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³ÙŠØ§Ù‚ Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
                conversationHistory.push({
                    question: message,
                    response: response.response,
                    timestamp: new Date().toISOString()
                });
                
                // Ø¥Ø²Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø¯
                removeLoading(loadingId);
                addMessage(response.response, 'ai', response);
                
                // Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
                saveConversation(message, response);
                
            } catch (error) {
                console.error('AI Error:', error);
                removeLoading(loadingId);
                addMessage(
                    'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø³Ø¤Ø§Ù„Ùƒ. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø§Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„Ø§Ù‹ Ù…Ø®ØªÙ„ÙØ§Ù‹.',
                    'ai'
                );
            }
        }

        function addMessage(content, sender, aiResponse = null) {
            const chatMessages = document.getElementById('chat-messages');
            const messageId = 'msg_' + Date.now();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.id = messageId;
            
            const avatarIcon = sender === 'user' ? 'fa-user' : 'fa-brain';
            const senderName = sender === 'user' ? 'Ø£Ù†Øª' : 'Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚';
            
            let messageContent = content;
            if (sender === 'ai' && aiResponse) {
                messageContent += `\n\n${generateResponseFooter(aiResponse)}`;
            }
            
            messageDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas ${avatarIcon}"></i>
                </div>
                <div class="message-content">
                    <strong>${senderName}:</strong> ${messageContent.replace(/\n/g, '<br>')}
                </div>
                <div class="message-time">${formatTime(new Date())}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            return messageId;
        }

        function generateResponseFooter(response) {
            let footer = '';
            
            if (response.analysis) {
                footer += `ğŸ“Š <strong>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡:</strong> ${response.analysis.type} | ØªØ¹Ù‚ÙŠØ¯: ${(response.analysis.complexity * 100).toFixed(0)}%<br>`;
            }
            
            if (response.suggestions && response.suggestions.length > 0) {
                footer += `ğŸ’¡ <strong>Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª:</strong> `;
                footer += response.suggestions.map(s => s.text).join(' â€¢ ');
            }
            
            return footer;
        }

        function showAILoading() {
            const chatMessages = document.getElementById('chat-messages');
            const loadingId = 'loading_' + Date.now();
            
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message ai';
            loadingDiv.id = loadingId;
            loadingDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="message-content">
                    <strong>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚:</strong> 
                    <div class="ai-loader" style="display: inline-block; margin: 0 10px;"></div>
                    Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø°ÙƒÙŠ...
                </div>
            `;
            
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            return loadingId;
        }

        function removeLoading(loadingId) {
            const element = document.getElementById(loadingId);
            if (element) element.remove();
        }

        // ==================== [ 6. Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ© ] ====================
        async function startSmartQuiz() {
            Swal.fire({
                title: 'ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚',
                html: `
                    <div style="text-align: right;">
                        <div class="form-group">
                            <label style="color: var(--neon-blue); display: block; margin-bottom: 8px;">Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                            <select id="quiz-subject" class="form-input" style="width: 100%;">
                                <option value="Ø±ÙŠØ§Ø¶ÙŠØ§Øª">Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                                <option value="ÙÙŠØ²ÙŠØ§Ø¡">Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡</option>
                                <option value="ÙƒÙŠÙ…ÙŠØ§Ø¡">Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡</option>
                                <option value="Ø¨Ø±Ù…Ø¬Ø©">Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©</option>
                                <option value="Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: var(--neon-blue); display: block; margin-bottom: 8px;">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
                            <select id="quiz-level" class="form-input" style="width: 100%;">
                                <option value="easy">Ù…Ø¨ØªØ¯Ø¦</option>
                                <option value="medium" selected>Ù…ØªÙˆØ³Ø·</option>
                                <option value="hard">Ù…ØªÙ‚Ø¯Ù…</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label style="color: var(--neon-blue); display: block; margin-bottom: 8px;">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</label>
                            <input type="number" id="quiz-count" class="form-input" value="10" min="5" max="20" style="width: 100%;">
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ',
                cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
                confirmButtonColor: '#00b4d8'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    const subject = document.getElementById('quiz-subject').value;
                    const level = document.getElementById('quiz-level').value;
                    const count = document.getElementById('quiz-count').value;
                    
                    showLoading('Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø°ÙƒÙŠ...');
                    
                    try {
                        const quiz = await superAI.generateSmartQuiz(subject, level, parseInt(count));
                        hideLoading();
                        showQuiz(quiz);
                    } catch (error) {
                        hideLoading();
                        showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±');
                    }
                }
            });
        }

        function showQuiz(quiz) {
            document.getElementById('quiz-modal').classList.remove('hidden');
            
            let currentQuestion = 0;
            let score = 0;
            let userAnswers = [];
            
            function displayQuestion() {
                const quizContent = document.getElementById('quiz-content');
                
                if (currentQuestion >= quiz.questions.length) {
                    finishQuiz();
                    return;
                }
                
                const q = quiz.questions[currentQuestion];
                const questionNumber = currentQuestion + 1;
                
                let optionsHtml = '';
                q.options.forEach((option, index) => {
                    optionsHtml += `
                        <div class="option" onclick="selectQuizAnswer(${index})" id="option-${index}">
                            <div class="option-letter">${String.fromCharCode(1570 + index)}</div>
                            <div class="option-text">${option}</div>
                        </div>
                    `;
                });
                
                quizContent.innerHTML = `
                    <div style="margin-bottom: 25px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="color: var(--neon-blue);">${quiz.title}</h3>
                            <span style="background: var(--neon-purple); color: white; padding: 5px 15px; border-radius: 20px;">
                                Ø³Ø¤Ø§Ù„ ${questionNumber}/${quiz.questions.length}
                            </span>
                        </div>
                        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                            <span style="background: rgba(0, 245, 255, 0.2); color: var(--neon-blue); padding: 5px 10px; border-radius: 10px;">
                                Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø°ÙƒØ§Ø¡: ${quiz.intelligenceLevel}
                            </span>
                            <span style="background: rgba(157, 78, 221, 0.2); color: var(--neon-purple); padding: 5px 10px; border-radius: 10px;">
                                Ù†Ù‚Ø§Ø·: ${q.intelligencePoints}
                            </span>
                        </div>
                    </div>
                    
                    <div class="question">${q.question}</div>
                    
                    <div class="options">${optionsHtml}</div>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 30px;">
                        <button class="btn btn-secondary" onclick="prevQuestion()" ${currentQuestion === 0 ? 'disabled' : ''}>
                            <i class="fas fa-arrow-right"></i> Ø§Ù„Ø³Ø§Ø¨Ù‚
                        </button>
                        <button class="btn btn-primary" onclick="nextQuestion()">
                            ${currentQuestion === quiz.questions.length - 1 ? 'Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±' : 'Ø§Ù„ØªØ§Ù„ÙŠ'} <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                `;
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠØ¯
                window.selectQuizAnswer = function(index) {
                    document.querySelectorAll('.option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    document.getElementById(`option-${index}`).classList.add('selected');
                    userAnswers[currentQuestion] = index;
                };
                
                window.prevQuestion = function() {
                    if (currentQuestion > 0) {
                        currentQuestion--;
                        displayQuestion();
                    }
                };
                
                window.nextQuestion = function() {
                    if (currentQuestion < quiz.questions.length - 1) {
                        currentQuestion++;
                        displayQuestion();
                    } else {
                        finishQuiz();
                    }
                };
                
                // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª
                if (userAnswers[currentQuestion] !== undefined) {
                    document.getElementById(`option-${userAnswers[currentQuestion]}`).classList.add('selected');
                }
            }
            
            function finishQuiz() {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø©
                quiz.questions.forEach((q, index) => {
                    if (userAnswers[index] === q.correctAnswer) {
                        score += q.intelligencePoints;
                    }
                });
                
                const totalPoints = quiz.questions.reduce((sum, q) => sum + q.intelligencePoints, 0);
                const percentage = Math.round((score / totalPoints) * 100);
                
                // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                userStats.correctAnswers += Math.round(score / 10);
                updateStats();
                
                document.getElementById('quiz-content').innerHTML = `
                    <div style="text-align: center; padding: 30px;">
                        <div style="font-size: 72px; color: ${percentage >= 80 ? '#00ff9d' : percentage >= 60 ? '#ffd166' : '#ff0054'}; margin: 20px 0;">
                            ${percentage}%
                        </div>
                        <h3 style="color: var(--neon-blue); margin-bottom: 20px;">ğŸ‰ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ</h3>
                        
                        <div style="background: rgba(0, 0, 0, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0;">
                            <p><strong>Ø§Ù„Ø¯Ø±Ø¬Ø©:</strong> ${score}/${totalPoints} Ù†Ù‚Ø·Ø© Ø°ÙƒØ§Ø¡</p>
                            <p><strong>Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</strong> ${getIntelligenceLevel(percentage)}</p>
                            <p><strong>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø¯Ø±:</strong> ${Math.ceil(quiz.estimatedTime / 60)} Ø¯Ù‚ÙŠÙ‚Ø©</p>
                        </div>
                        
                        <div style="color: var(--text-sec); margin: 20px 0;">
                            ${getQuizFeedback(percentage)}
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 30px;">
                            <button class="btn btn-secondary" onclick="document.getElementById('quiz-modal').classList.add('hidden')">
                                Ø¥ØºÙ„Ø§Ù‚
                            </button>
                            <button class="btn btn-primary" onclick="reviewQuiz()">
                                Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
                            </button>
                        </div>
                    </div>
                `;
                
                window.reviewQuiz = function() {
                    showQuizReview(quiz, userAnswers);
                };
            }
            
            displayQuestion();
        }

        function getIntelligenceLevel(percentage) {
            if (percentage >= 90) return 'Ø¹Ø¨Ù‚Ø±ÙŠ ğŸ§ ';
            if (percentage >= 80) return 'Ù…ØªÙ…ÙŠØ² â­â­â­â­';
            if (percentage >= 70) return 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ â­â­â­';
            if (percentage >= 60) return 'Ø¬ÙŠØ¯ â­â­';
            if (percentage >= 50) return 'Ù…Ù‚Ø¨ÙˆÙ„ â­';
            return 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ† ğŸ“š';
        }

        function getQuizFeedback(percentage) {
            if (percentage >= 90) return 'Ø£Ø¯Ø§Ø¡ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ! Ø°ÙƒØ§Ø¦Ùƒ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª.';
            if (percentage >= 80) return 'Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø²! ØªÙ…ØªÙ„Ùƒ Ù…Ù‡Ø§Ø±Ø§Øª ØªØ­Ù„ÙŠÙ„ Ø±Ø§Ø¦Ø¹Ø©.';
            if (percentage >= 70) return 'Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø£ÙƒØ«Ø±.';
            if (percentage >= 60) return 'Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯ØŒ Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªØ¹Ù„Ù… ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±.';
            if (percentage >= 50) return 'Ø£Ø¯Ø§Ø¡ Ù…Ù‚Ø¨ÙˆÙ„ØŒ Ø±ÙƒØ² Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù.';
            return 'ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø¯ ÙˆØ§Ù„ØªØ±ÙƒÙŠØ².';
        }

        function showQuizReview(quiz, userAnswers) {
            let reviewHtml = `
                <div style="text-align: right; max-height: 400px; overflow-y: auto;">
                    <h3 style="color: var(--neon-blue); margin-bottom: 20px;">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</h3>
            `;
            
            quiz.questions.forEach((q, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer === q.correctAnswer;
                
                reviewHtml += `
                    <div style="background: ${isCorrect ? 'rgba(0, 255, 157, 0.1)' : 'rgba(255, 0, 84, 0.1)'}; 
                              border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 2px solid ${isCorrect ? '#00ff9d' : '#ff0054'};">
                        <p><strong>Ø³Ø¤Ø§Ù„ ${index + 1}:</strong> ${q.question}</p>
                        <p><strong>Ø¥Ø¬Ø§Ø¨ØªÙƒ:</strong> ${userAnswer !== undefined ? q.options[userAnswer] : 'Ù„Ù… ØªØ¬Ø¨'}</p>
                        ${!isCorrect ? `<p><strong>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</strong> ${q.options[q.correctAnswer]}</p>` : ''}
                        <p style="color: ${isCorrect ? '#00ff9d' : '#ff0054'};">
                            <i class="fas fa-${isCorrect ? 'check' : 'times'}"></i>
                            ${isCorrect ? 'Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©' : 'Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©'}
                        </p>
                        <p style="color: var(--text-sec); font-size: 14px; margin-top: 10px;">
                            ${q.explanation}
                        </p>
                    </div>
                `;
            });
            
            reviewHtml += `</div>`;
            
            document.getElementById('quiz-content').innerHTML = reviewHtml + `
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="showQuiz(${JSON.stringify(quiz).replace(/"/g, '&quot;')})">
                        Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù†ØªÙŠØ¬Ø©
                    </button>
                </div>
            `;
        }

        async function analyzeDocument() {
            Swal.fire({
                title: 'ğŸ“„ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ø°ÙƒÙŠ',
                input: 'textarea',
                inputLabel: 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªØ­Ù„ÙŠÙ„Ù‡',
                inputPlaceholder: 'Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§...',
                inputAttributes: {
                    rows: 8
                },
                showCancelButton: true,
                confirmButtonText: 'ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ',
                cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
                preConfirm: async (text) => {
                    if (!text || text.length < 20) {
                        Swal.showValidationMessage('Ø§Ù„Ù†Øµ Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹');
                        return false;
                    }
                    
                    showLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ...');
                    
                    try {
                        const analysis = await superAI.analyzeDocument(text);
                        hideLoading();
                        return analysis;
                    } catch (error) {
                        hideLoading();
                        Swal.showValidationMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„');
                        return false;
                    }
                }
            }).then((result) => {
                if (result.isConfirmed && result.value) {
                    const analysis = result.value;
                    
                    Swal.fire({
                        title: 'ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ',
                        html: `
                            <div style="text-align: right; max-width: 600px;">
                                <div style="background: rgba(0, 0, 0, 0.3); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                                    <h4 style="color: var(--neon-blue); margin-bottom: 15px;">Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø°ÙƒÙŠ</h4>
                                    <p>${analysis.summary}</p>
                                </div>
                                
                                <div style="background: rgba(0, 0, 0, 0.3); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                                    <h4 style="color: var(--neon-blue); margin-bottom: 15px;">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h4>
                                    ${analysis.keyPoints.map(point => `<p>${point}</p>`).join('')}
                                </div>
                                
                                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin: 20px 0;">
                                    ${analysis.keywords.map(keyword => 
                                        `<span style="background: var(--primary); color: white; padding: 5px 10px; border-radius: 20px;">${keyword}</span>`
                                    ).join('')}
                                </div>
                                
                                <div style="background: rgba(0, 0, 0, 0.3); border-radius: 15px; padding: 20px;">
                                    <h4 style="color: var(--neon-blue); margin-bottom: 15px;">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Øµ</h4>
                                    <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª:</strong> ${analysis.statistics.words}</p>
                                    <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ù…Ù„:</strong> ${analysis.statistics.sentences}</p>
                                    <p><strong>ÙˆÙ‚Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©:</strong> ${analysis.statistics.readingTime} Ø¯Ù‚ÙŠÙ‚Ø©</p>
                                    <p><strong>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù‚ÙŠØ¯:</strong> ${analysis.statistics.complexity}</p>
                                </div>
                            </div>
                        `,
                        width: 700
                    });
                }
            });
        }

        async function solveProblem() {
            Swal.fire({
                title: 'ğŸ§® Ø­Ù„ Ø§Ù„Ù…Ø³Ø§Ø¦Ù„ Ø§Ù„Ø°ÙƒÙŠ',
                html: `
                    <div style="text-align: right;">
                        <p>Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø­Ù„Ù‡Ø§:</p>
                        <input type="text" id="problem-input" class="swal2-input" placeholder="Ù…Ø«Ø§Ù„: 2xÂ² + 3x - 5 = 0" style="width: 100%;">
                        
                        <div style="margin-top: 15px;">
                            <label style="color: var(--neon-blue);">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³Ø£Ù„Ø©</label>
                            <select id="problem-type" class="swal2-input" style="width: 100%;">
                                <option value="math">Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                                <option value="physics">ÙÙŠØ²ÙŠØ§Ø¡</option>
                                <option value="logic">Ù…Ù†Ø·Ù‚</option>
                                <option value="algorithm">Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ©</option>
                            </select>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Ø­Ù„ Ø°ÙƒÙŠ',
                cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
                preConfirm: () => {
                    const problem = document.getElementById('problem-input').value;
                    const type = document.getElementById('problem-type').value;
                    
                    if (!problem) {
                        Swal.showValidationMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø³Ø£Ù„Ø©');
                        return false;
                    }
                    
                    return { problem, type };
                }
            }).then(async (result) => {
                if (result.isConfirmed) {
                    const { problem, type } = result.value;
                    
                    showLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ± ÙÙŠ Ø§Ù„Ø­Ù„ Ø§Ù„Ø°ÙƒÙŠ...');
                    
                    // Ù…Ø­Ø§ÙƒØ§Ø© Ø­Ù„ Ø§Ù„Ù…Ø³Ø£Ù„Ø©
                    setTimeout(() => {
                        hideLoading();
                        
                        const solutions = {
                            math: `ğŸ§® **Ø­Ù„ Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©:**\n\n` +
                                 `Ø§Ù„Ù…Ø³Ø£Ù„Ø©: ${problem}\n\n` +
                                 `**Ø§Ù„Ø®Ø·ÙˆØ§Øª:**\n` +
                                 `1. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© ÙˆÙÙ‡Ù… Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª\n` +
                                 `2. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©\n` +
                                 `3. Ø­Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©\n` +
                                 `4. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©\n\n` +
                                 `**Ø§Ù„Ø­Ù„ Ø§Ù„Ø°ÙƒÙŠ:**\n` +
                                 `x = ${(Math.random() * 10 - 5).toFixed(2)}\n\n` +
                                 `ğŸ’¡ **Ù†ØµÙŠØ­Ø© Ø°ÙƒÙŠØ©:**\n` +
                                 `ØªØ£ÙƒØ¯ Ù…Ù† ÙÙ‡Ù…Ùƒ Ù„ÙƒÙ„ Ø®Ø·ÙˆØ© ÙÙŠ Ø§Ù„Ø­Ù„ØŒ ÙˆØ­Ø§ÙˆÙ„ Ø­Ù„ Ù…Ø³Ø§Ø¦Ù„ Ù…Ù…Ø§Ø«Ù„Ø©.`,
                                 
                            physics: `âš›ï¸ **Ø­Ù„ Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©:**\n\n` +
                                   `Ø§Ù„Ù…Ø³Ø£Ù„Ø©: ${problem}\n\n` +
                                   `**Ø§Ù„Ù…Ù†Ù‡Ø¬ÙŠØ©:**\n` +
                                   `1. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©\n` +
                                   `2. ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø§ØªØ²Ø§Ù†\n` +
                                   `3. Ø­Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©\n` +
                                   `4. ØªÙØ³ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ§Ù‹\n\n` +
                                   `**Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù†Ù‚Ø¯ÙŠ:**\n` +
                                   `Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø£Ù„Ø© ØªØªØ·Ù„Ø¨ ÙÙ‡Ù… Ø¹Ù…ÙŠÙ‚ Ù„Ù„Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©.`,
                                   
                            logic: `ğŸ¯ **Ø­Ù„ Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠØ©:**\n\n` +
                                  `Ø§Ù„Ù…Ø³Ø£Ù„Ø©: ${problem}\n\n` +
                                  `**Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ:**\n` +
                                  `1. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬\n` +
                                  `2. ØªØ·Ø¨ÙŠÙ‚ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªØ¯Ù„Ø§Ù„ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ\n` +
                                  `3. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØ³Ø§Ù‚ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ\n` +
                                  `4. Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ø§Ø³ØªÙ†ØªØ§Ø¬Ø§Øª\n\n` +
                                  `**Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø°ÙƒÙŠ:**\n` +
                                  `Ø§Ù„Ø­Ù„ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø§Ø³ØªÙ†ØªØ§Ø¬ÙŠ ÙˆØ§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø¦ÙŠ.`,
                                  
                            algorithm: `ğŸ’» **Ø­Ù„ Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ©:**\n\n` +
                                      `Ø§Ù„Ù…Ø³Ø£Ù„Ø©: ${problem}\n\n` +
                                      `**Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠ:**\n` +
                                      `1. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø±Ø¬Ø§Øª\n` +
                                      `2. ØªØµÙ…ÙŠÙ… Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø£Ù…Ø«Ù„\n` +
                                      `3. Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ¹Ù‚ÙŠØ¯ Ø§Ù„Ø²Ù…Ù†ÙŠ ÙˆØ§Ù„Ù…ÙƒØ§Ù†ÙŠ\n` +
                                      `4. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©\n\n` +
                                      `**Ø§Ù„ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø°ÙƒÙŠØ©:**\n` +
                                      `Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ù„Ù‡Ø§ ØªØ¹Ù‚ÙŠØ¯ Ø²Ù…Ù†ÙŠ O(n log n).`
                        };
                        
                        const response = solutions[type] || solutions.math;
                        
                        addMessage(response, 'ai', {
                            analysis: { type: 'Ø­Ù„', complexity: 0.8 }
                        });
                        
                    }, 2000);
                }
            });
        }

        // ==================== [ 7. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ] ====================
        function showStats() {
            const statsContent = `
                <div class="stats-container">
                    <h2 style="color: var(--neon-blue); margin-bottom: 30px; text-align: center;">
                        <i class="fas fa-chart-network"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡
                    </h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <i class="fas fa-question-circle" style="font-size: 24px; color: var(--neon-blue);"></i>
                            <div class="stat-value">${userStats.questionsAsked}</div>
                            <div class="stat-label">Ø£Ø³Ø¦Ù„Ø© ØªÙ… Ø·Ø±Ø­Ù‡Ø§</div>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fas fa-check-circle" style="font-size: 24px; color: var(--success);"></i>
                            <div class="stat-value">${userStats.correctAnswers}</div>
                            <div class="stat-label">Ø¥Ø¬Ø§Ø¨Ø§Øª ØµØ­ÙŠØ­Ø©</div>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fas fa-brain" style="font-size: 24px; color: var(--neon-purple);"></i>
                            <div class="stat-value">${userStats.aiInteractions}</div>
                            <div class="stat-label">ØªÙØ§Ø¹Ù„Ø§Øª Ù…Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡</div>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fas fa-fire" style="font-size: 24px; color: var(--accent);"></i>
                            <div class="stat-value">${userStats.streak}</div>
                            <div class="stat-label">ØªØªØ§Ø¨Ø¹ Ø§Ù„Ù†Ø¬Ø§Ø­</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--accent); margin-bottom: 15px;">Ù…Ø³ØªÙˆÙ‰ Ø°ÙƒØ§Ø¦Ùƒ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</h3>
                        <div style="background: rgba(0, 0, 0, 0.3); border-radius: 15px; padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <div style="width: 60px; height: 60px; border-radius: 50%; background: var(--gradient-ai); display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold;">
                                    ${calculateAILevel()}
                                </div>
                                <div>
                                    <div style="font-size: 18px; font-weight: bold; color: var(--neon-blue);">
                                        ${getLevelTitle()}
                                    </div>
                                    <div style="color: var(--text-sec);">
                                        ${getLevelDescription()}
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="color: var(--text-sec);">ØªÙ‚Ø¯Ù…Ùƒ Ù†Ø­Ùˆ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ</span>
                                    <span style="color: var(--neon-blue);">${calculateProgress()}%</span>
                                </div>
                                <div style="height: 10px; background: rgba(0, 0, 0, 0.3); border-radius: 5px; overflow: hidden;">
                                    <div style="height: 100%; width: ${calculateProgress()}%; background: var(--gradient-ai);"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <button class="btn btn-primary" onclick="document.getElementById('quiz-modal').classList.add('hidden')">
                            <i class="fas fa-arrow-left"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('quiz-modal').classList.remove('hidden');
            document.getElementById('quiz-content').innerHTML = statsContent;
        }

        function calculateAILevel() {
            const score = userStats.questionsAsked + (userStats.correctAnswers * 2);
            if (score > 100) return 'A+';
            if (score > 80) return 'A';
            if (score > 60) return 'B';
            if (score > 40) return 'C';
            return 'D';
        }

        function getLevelTitle() {
            const level = calculateAILevel();
            const titles = {
                'A+': 'Ø¹Ø¨Ù‚Ø±ÙŠ ØªØ¹Ù„ÙŠÙ…ÙŠ ğŸ§ ',
                'A': 'Ù…ØªÙÙˆÙ‚ Ø°ÙƒÙŠ â­â­â­â­',
                'B': 'Ù…ØªØ¹Ù„Ù… Ù†Ø´Ø· â­â­â­',
                'C': 'Ù…ØªØ¯Ø±Ø¨ Ø¬ÙŠØ¯ â­â­',
                'D': 'Ù…Ø¨ØªØ¯Ø¦ ÙˆØ§Ø¹Ø¯ â­'
            };
            return titles[level] || 'Ù…ØªØ¹Ù„Ù…';
        }

        function getLevelDescription() {
            const level = calculateAILevel();
            const descriptions = {
                'A+': 'ØªÙ…ØªÙ„Ùƒ Ù…Ù‡Ø§Ø±Ø§Øª ØªØ­Ù„ÙŠÙ„ ÙˆØªÙÙƒÙŠØ± Ù†Ù‚Ø¯ÙŠ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠØ©',
                'A': 'Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø² ÙÙŠ Ø§Ù„ÙÙ‡Ù… ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚',
                'B': 'Ù…Ø³ØªÙˆÙ‰ Ø¬ÙŠØ¯ Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª',
                'C': 'Ù‚Ø§Ø¹Ø¯Ø© Ø¬ÙŠØ¯Ø© ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªØ·ÙˆÙŠØ±',
                'D': 'Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬Ø§Ø¯Ø© Ù†Ø­Ùˆ Ø§Ù„ØªÙ…ÙŠØ²'
            };
            return descriptions[level] || 'Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªØ¹Ù„Ù…';
        }

        function calculateProgress() {
            const score = userStats.questionsAsked + (userStats.correctAnswers * 2);
            return Math.min(Math.floor((score % 100) * 100 / 100), 100);
        }

        function updateStats() {
            if (!currentUser) return;
            
            // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø£Ø®ÙŠØ±
            userStats.lastActive = Date.now();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØªØ§Ø¨Ø¹
            const lastActive = userStats.lastActive;
            const now = Date.now();
            const hoursDiff = (now - lastActive) / (1000 * 60 * 60);
            
            if (hoursDiff <= 24) {
                userStats.streak++;
            } else if (hoursDiff > 48) {
                userStats.streak = 0;
            }
            
            // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„ØªØ¹Ù„Ù…
            userStats.learningHours += 0.1; // Ø³Ø§Ø¹Ø© Ù„ÙƒÙ„ 10 ØªÙØ§Ø¹Ù„Ø§Øª
            
            // Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            db.ref(`users/${currentUser.uid}/stats`).set(userStats);
        }

        // ==================== [ 8. Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ] ====================
        function formatTime(date) {
            return date.toLocaleTimeString('ar-EG', {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                const snapshot = await db.ref(`users/${currentUser.uid}`).once('value');
                const userData = snapshot.val();
                
                if (userData) {
                    document.getElementById('user-name').textContent = userData.name;
                    document.getElementById('user-role').textContent = userData.role;
                    
                    const roleIcons = {
                        'student': 'fa-user-graduate',
                        'researcher': 'fa-search',
                        'professional': 'fa-briefcase',
                        'teacher': 'fa-chalkboard-teacher'
                    };
                    
                    document.getElementById('user-avatar').innerHTML = 
                        `<i class="fas ${roleIcons[userData.role] || 'fa-user'}"></i>`;
                    
                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                    if (userData.stats) {
                        userStats = { ...userStats, ...userData.stats };
                    }
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        async function saveConversation(question, response) {
            if (!currentUser) return;
            
            try {
                await db.ref(`users/${currentUser.uid}/conversations`).push({
                    question: question,
                    response: response.response,
                    analysis: response.analysis,
                    timestamp: new Date().toISOString()
                });
            } catch (error) {
                console.error('Error saving conversation:', error);
            }
        }

        function showLoginScreen() {
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('app-screen').classList.add('hidden');
            document.getElementById('register-screen').classList.add('hidden');
        }

        function showAppScreen() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app-screen').classList.remove('hidden');
            document.getElementById('register-screen').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('register-screen').classList.remove('hidden');
        }

        function backToLogin() {
            document.getElementById('register-screen').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
        }

        function logout() {
            Swal.fire({
                title: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬',
                text: 'Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚ØŸ',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Ù†Ø¹Ù…',
                cancelButtonText: 'Ù„Ø§',
                confirmButtonColor: '#ff0054'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    await auth.signOut();
                    showSuccess('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬');
                    conversationHistory = [];
                }
            });
        }

        function clearChat() {
            Swal.fire({
                title: 'Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©',
                text: 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Ù†Ø¹Ù…',
                cancelButtonText: 'Ù„Ø§',
                confirmButtonColor: '#ff0054'
            }).then((result) => {
                if (result.isConfirmed) {
                    document.getElementById('chat-messages').innerHTML = '';
                    conversationHistory = [];
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ø¬Ø¯ÙŠØ¯Ø©
                    addMessage(
                        'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ù…Ø¬Ø¯Ø¯Ø§Ù‹! Ø£Ù†Ø§ Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø®Ø§Ø±Ù‚ Ø¬Ø§Ù‡Ø² Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ. ğŸ˜Š',
                        'ai'
                    );
                }
            });
        }

        function recordVoice() {
            showSuccess('Ù…ÙŠØ²Ø© Ø§Ù„ØµÙˆØª Ù‚Ø±ÙŠØ¨Ø§Ù‹! Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.');
        }

        function uploadFile() {
            showSuccess('Ù…ÙŠØ²Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹! ÙŠÙ…ÙƒÙ†Ùƒ Ù†Ø³Ø® ÙˆÙ„ØµÙ‚ Ø§Ù„Ù†ØµÙˆØµ.');
        }

        function showLoading(message = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...') {
            Swal.fire({
                title: message,
                allowOutsideClick: false,
                showConfirmButton: false,
                willOpen: () => Swal.showLoading()
            });
        }

        function hideLoading() {
            Swal.close();
        }

        function showSuccess(message) {
            Swal.fire({
                icon: 'success',
                title: 'ØªÙ…',
                text: message,
                confirmButtonText: 'Ù…ÙˆØ§ÙÙ‚',
                confirmButtonColor: '#00ff9d'
            });
        }

        function showError(message) {
            Swal.fire({
                icon: 'error',
                title: 'Ø®Ø·Ø£',
                text: message,
                confirmButtonText: 'Ù…ÙˆØ§ÙÙ‚',
                confirmButtonColor: '#ff0054'
            });
        }

        // Ø¬Ø¹Ù„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹
        window.loginUser = loginUser;
        window.registerUser = registerUser;
        window.showRegister = showRegister;
        window.backToLogin = backToLogin;
        window.logout = logout;
        window.sendMessage = sendMessage;
        window.startSmartQuiz = startSmartQuiz;
        window.analyzeDocument = analyzeDocument;
        window.solveProblem = solveProblem;
        window.showStats = showStats;
        window.clearChat = clearChat;
        window.recordVoice = recordVoice;
        window.uploadFile = uploadFile;

        console.log('ğŸš€ Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø®Ø§Ø±Ù‚ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„!');
    </script>
</body>
</html>
