const { Telegraf, Markup } = require('telegraf');
const http = require('http');

// Ø¥Ø¨Ù‚Ø§Ø¡ Ø³ÙŠØ±ÙØ± Ø±ÙŠÙ†Ø¯Ø± Ù†Ø´Ø·Ø§Ù‹ Ø¨Ø£Ù‚Ù„ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ù„Ù„Ø±Ø§Ù…
http.createServer((req, res) => {
    res.writeHead(200, { 'Content-Type': 'text/plain' });
    res.end('Bot Engine is Running in Background...\n');
}).listen(process.env.PORT || 10000, '0.0.0.0');

const bot = new Telegraf(process.env.TELEGRAM_BOT_TOKEN);

// --- 1. Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ (/start) ---
bot.start((ctx) => {
    const welcomeMessage = `
Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¨ÙˆØª Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ! ðŸ¤–ðŸš€

Ù‡Ø°Ø§ Ø§Ù„Ø¨ÙˆØª ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…Ù† (ØªÙŠÙƒ ØªÙˆÙƒØŒ Ø¥Ù†Ø³ØªØºØ±Ø§Ù…ØŒ ÙŠÙˆØªÙŠÙˆØ¨ØŒ ÙÙŠØ³Ø¨ÙˆÙƒ) Ù…Ø¬Ø§Ù†Ø§Ù‹.

**ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:**
1ï¸âƒ£ Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø£ÙŠ ØªØ·Ø¨ÙŠÙ‚ (ØªÙŠÙƒ ØªÙˆÙƒ Ù…Ø«Ù„Ø§Ù‹).
2ï¸âƒ£ Ø§Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯Ù‡.
3ï¸âƒ£ Ø£Ø±Ø³Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ù†Ø§ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©.
4ï¸âƒ£ Ø§Ù†ØªØ¸Ø± Ø«ÙˆØ§Ù†ÙŠ ÙˆØ³Ø£Ø¹Ø·ÙŠÙƒ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±.

Ø¬Ø±Ø¨ Ø§Ù„Ø¢Ù† Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø£ÙˆÙ„ Ø±Ø§Ø¨Ø·! ðŸ‘‡
    `;
    ctx.reply(welcomeMessage);
});

// --- 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ---
bot.on('text', async (ctx) => {
    const url = ctx.message.text;

    if (url.startsWith('http')) {
        // Ø±Ø³Ø§Ù„Ø© Ø¥Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
        const waitingMsg = await ctx.reply('â³ Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù†ØªØ¸Ø± Ù„Ø­Ø¸Ø©... Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆØªØ¬Ù‡ÙŠØ² Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ùƒ.');

        try {
            // Ù…Ø­Ø±Ùƒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· (ÙŠØ¹Ù…Ù„ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¯ÙˆÙ† Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø±Ø§Ù… Ø±ÙŠÙ†Ø¯Ø±)
            const downloadUrl = `https://pastedownload.com/21/?url=${encodeURIComponent(url)}`;

            // Ø­Ø°Ù Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
            await ctx.deleteMessage(waitingMsg.message_id).catch(() => {}); 
            
            return ctx.reply(
                `âœ… Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!\n\nÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ù‡Ø§ØªÙÙƒ Ø¹Ø¨Ø± Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡:`,
                Markup.inlineKeyboard([
                    [Markup.button.url('ðŸ“¥ Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±', downloadUrl)]
                ])
            );
        } catch (error) {
            ctx.reply('Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
        }
    } else {
        ctx.reply('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ ØµØ­ÙŠØ­ (Ù…Ø«Ù„ Ø±ÙˆØ§Ø¨Ø· ØªÙŠÙƒ ØªÙˆÙƒ Ø£Ùˆ ÙŠÙˆØªÙŠÙˆØ¨).');
    }
});

bot.launch().then(() => console.log("Bot is Online and Ready!"));
